<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SusuPay Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #271dad 0%, #053f05 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Login Page */
        .login-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
        }

        .admin-logo {
            text-align: center;
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .login-title {
            color: #4a5568;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .login-subtitle {
            color: #718096;
            margin-bottom: 40px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Dashboard Layout */
        .dashboard-page {
            display: none;
        }

        .admin-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(135, 194, 202, 0.98);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .hamburger-btn {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .hamburger-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .hamburger-btn svg {
            width: 24px;
            height: 24px;
            stroke: #000000;
        }

        .admin-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #eefff9;
        }

        .admin-role-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .role-super {
            background: linear-gradient(135deg, #1ba827 0%, #19547b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 255, 42, 0.767);
        }

        .role-main {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .role-senior {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .role-financial {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .role-support {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .role-security {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .role-operations {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #4a5568;
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .logout-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        /* Sidebar */
        .admin-sidebar {
            position: fixed;
            left: 0;
            top: 70px;
            bottom: 0;
            width: 280px;
            background: linear-gradient(135deg, #1c1949 0%, #3c0ea7 100%);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 900;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            display: none;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
            justify-content: space-between;
        }

        .close-sidebar-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .close-sidebar-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .close-sidebar-btn svg {
            width: 24px;
            height: 24px;
            stroke: #ffffff;
        }

        .sidebar-section {
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-section-title {
            padding: 10px 25px;
            font-size: 0.75rem;
            font-weight: 700;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sidebar-nav-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            color: #e2e8f0;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-weight: 500;
        }

        .sidebar-nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: #667eea;
            color: #ffffff;
        }

        .sidebar-nav-item.active {
            background: rgba(102, 126, 234, 0.2);
            border-left-color: #667eea;
            color: #ffffff;
        }

        .nav-icon {
            font-size: 1.3rem;
        }

        .pending-badge {
            margin-left: auto;
            background: #e53e3e;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        /* Super Admin Theme */
        .super-admin-sidebar {
            background: linear-gradient(180deg, #2d3748 0%, #1a202c 100%);
        }

        .super-admin-sidebar .sidebar-section-title {
            color: #ffd700;
        }

        .super-admin-sidebar .sidebar-nav-item {
            color: #e2e8f0;
        }

        .super-admin-sidebar .sidebar-nav-item:hover {
            background: rgba(255, 215, 0, 0.1);
            border-left-color: #ffd700;
            color: #ffd700;
        }

        .super-admin-sidebar .sidebar-nav-item.active {
            background: rgba(255, 215, 0, 0.2);
            border-left-color: #ffd700;
            color: #ffd700;
        }

        .super-admin-header {
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
        }

        /* Main Content */
        .admin-main {
            margin-left: 280px;
            margin-top: 70px;
            padding: 30px;
            min-height: calc(100vh - 70px);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #667eea;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #4a5568;
        }

        .stat-change {
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .stat-change.positive {
            color: #48bb78;
        }

        /* Content Card */
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f7fafc;
            flex-wrap: wrap;
            gap: 15px;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a5568;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-select, .search-input {
            padding: 8px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #4a5568;
            background: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus, .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: #f7fafc;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f7fafc;
            color: #4a5568;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: #fef5e7;
            color: #744210;
        }

        .status-approved {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-rejected {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-under-review, .status-under_review {
            background: #bee3f8;
            color: #2a4365;
        }

        .status-in-progress {
            background: #e9d8fd;
            color: #44337a;
        }

        .status-resolved {
            background: #c6f6d5;
            color: #22543d;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 5px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-view {
            background: #ebf8ff;
            color: #2b6cb0;
        }

        .btn-approve {
            background: #c6f6d5;
            color: #22543d;
        }

        .btn-reject {
            background: #fed7d7;
            color: #742a2a;
        }

        .btn-danger {
            background: #fed7d7;
            color: #742a2a;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            color: #4a5568;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #4a5568;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 20px;
        }

        .document-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .document-preview img {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .document-preview img:hover {
            transform: scale(1.05);
        }

        .user-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .detail-item {
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .detail-label {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .detail-value {
            font-size: 1rem;
            font-weight: 600;
            color: #4a5568;
            word-break: break-word;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .alert-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .alert-info {
            background: #bee3f8;
            color: #2a4365;
        }

        .hidden {
            display: none !important;
        }

        /* Activity Timeline */
        .activity-timeline {
            position: relative;
            padding-left: 30px;
        }

        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e2e8f0;
        }

        .activity-item {
            position: relative;
            margin-bottom: 25px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 3px solid #667eea;
        }

        .activity-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #718096;
            margin-bottom: 5px;
        }

        .activity-description {
            color: #4a5568;
            font-weight: 500;
        }

        .activity-user {
            color: #667eea;
            font-weight: 600;
        }

        /* Loading State */
        .loading {
            text-align: center;
            color: #718096;
            padding: 40px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            color: #718096;
            padding: 60px 20px;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hamburger-btn {
                display: block;
            }

            .admin-sidebar {
                transform: translateX(-100%);
            }

            .admin-sidebar.mobile-open {
                transform: translateX(0);
            }

            .sidebar-header {
                display: flex;
            }

            .admin-main {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .user-details-grid {
                grid-template-columns: 1fr;
            }

            .user-info {
                display: none;
            }

            .login-container {
                padding: 30px 20px;
            }

            .modal-content {
                width: 95%;
                padding: 30px 20px;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-group {
                width: 100%;
            }

            .filter-select, .search-input {
                width: 100%;
            }

            .data-table {
                font-size: 0.85rem;
            }

            .data-table th,
            .data-table td {
                padding: 10px 8px;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="login-page">
        <div class="login-container">
            <div class="admin-logo">üõ°Ô∏è</div>
            <h1 class="login-title">Admin Portal</h1>
            <p class="login-subtitle">SusuPay Management System</p>

            <div id="login-alert"></div>

            <form id="admin-login-form">
                <div class="form-group">
                    <label for="admin-role">Admin Role</label>
                    <select id="admin-role" required>
                        <option value="">Select your role...</option>
                        <option value="super">üëë Super Admin</option>
                        <option value="main">Main Admin</option>
                        <option value="senior">Senior Admin</option>
                        <option value="financial">Financial Admin</option>
                        <option value="support">Support Admin</option>
                        <option value="security">Security Admin</option>
                        <option value="operations">Operations Admin</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="admin-email">Email Address</label>
                    <input type="email" id="admin-email" required placeholder="admin@susupay.com">
                </div>

                <div class="form-group">
                    <label for="admin-password">Password</label>
                    <input type="password" id="admin-password" required placeholder="Enter your password">
                </div>

                <button type="submit" class="btn" style="width: 100%;">
                    Sign In to Admin Portal
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div class="dashboard-page" id="dashboard-page">
        <!-- Header -->
        <header class="admin-header" id="admin-header">
            <div class="header-left">
                <button class="hamburger-btn" id="hamburger-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="admin-brand">
                    <span>üõ°Ô∏è</span>
                    <span style="color: white;">SusuPay Admin</span>
                    <span class="admin-role-badge" id="role-badge"></span>
                </div>
            </div>
            <div class="header-user">
                <div class="user-info">
                    <div id="admin-name" style="font-weight: 600; color: #ffffff;"></div>
                    <div id="admin-email-display" style="font-size: 0.8rem; color: #05f711;"></div>
                </div>
               <div id="user-avatar" style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.1rem;">A</div>
                <button class="logout-btn" id="logout-btn">Logout</button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="admin-sidebar" id="admin-sidebar">
            <div class="sidebar-header">
                <span style="font-weight: 600; color: #ffffff;">Menu</span>
                <button class="close-sidebar-btn" id="close-sidebar-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="sidebar-section" id="super-section" style="display: none;">
                <div class="sidebar-section-title">Super Admin</div>
                <div class="sidebar-nav-item" data-page="super-dashboard">
                    <span class="nav-icon">üëë</span>
                    <span>Super Dashboard</span>
                </div>
                <div class="sidebar-nav-item" data-page="admin-activity">
                    <span class="nav-icon">üë®‚Äçüíº</span>
                    <span>Admin Activity</span>
                </div>
                <div class="sidebar-nav-item" data-page="user-analytics">
                    <span class="nav-icon">üìä</span>
                    <span>User Analytics</span>
                </div>
                <div class="sidebar-nav-item" data-page="future-projects">
    <span class="nav-icon">üéØ</span>
    <span>Future Projects</span>
</div>
                <div class="sidebar-nav-item" data-page="financial-overview">
                    <span class="nav-icon">üíé</span>
                    <span>Financial Overview</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Main</div>
                <div class="sidebar-nav-item active" data-page="dashboard">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </div>
                <div class="sidebar-nav-item" data-page="users">
                    <span class="nav-icon">üë•</span>
                    <span>Users</span>
                </div>
            </div>
            <div class="sidebar-nav-item" data-page="announcements">
    <span class="nav-icon">üì¢</span>
    <span>Announcements</span>
</div>

            <div class="sidebar-section" id="kyc-section">
                <div class="sidebar-section-title">Verification</div>
                <div class="sidebar-nav-item" data-page="kyc">
                    <span class="nav-icon">üõ°Ô∏è</span>
                    <span>KYC</span>
                    <span class="pending-badge" id="kyc-badge">0</span>
                </div>
            </div>

            <div class="sidebar-section" id="financial-section">
                <div class="sidebar-section-title">Financial</div>
                <div class="sidebar-nav-item" data-page="transactions">
                    <span class="nav-icon">üí≥</span>
                    <span>Transactions</span>
                    <span class="pending-badge" id="trans-badge">0</span>
                </div>
            </div>

            <div class="sidebar-section" id="support-section">
                <div class="sidebar-section-title">Support</div>
                <div class="sidebar-nav-item" data-page="reports">
                    <span class="nav-icon">üìã</span>
                    <span>User Reports</span>
                    <span class="pending-badge" id="reports-badge">0</span>
                </div>
            </div>

            <div class="sidebar-section" id="security-section">
                <div class="sidebar-section-title">Security</div>
                <div class="sidebar-nav-item" data-page="security-logs">
                    <span class="nav-icon">üîí</span>
                    <span>Security Logs</span>
                </div>
                <div class="sidebar-nav-item" data-page="suspicious">
                    <span class="nav-icon">‚ö†Ô∏è</span>
                    <span>Suspicious Activity</span>
                </div>
            </div>

            <div class="sidebar-section" id="admin-section">
                <div class="sidebar-section-title">Administration</div>
                <div class="sidebar-nav-item" data-page="admin-users">
                    <span class="nav-icon">üë®‚Äçüíº</span>
                    <span>Admin Users</span>
                </div>
                <div class="sidebar-nav-item" data-page="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>System Settings</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main" id="admin-main">
            <div id="dashboard-alert"></div>

            <!-- Dashboard Page -->
            <div id="dashboard-content" class="page-content">
                <h2 style="margin-bottom: 25px; color: white;">Dashboard Overview</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Users</div>
                        <div class="stat-value" id="stat-users">0</div>
                        <div class="stat-change positive">+12% this month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Transactions</div>
                        <div class="stat-value" id="stat-trans">0</div>
                        <div class="stat-change positive">+8% this month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending KYC</div>
                        <div class="stat-value" id="stat-kyc">0</div>
                        <div class="stat-change">Requires attention</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="stat-revenue">‚Çµ0</div>
                        <div class="stat-change positive">+15% this month</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                    </div>
                    <div class="activity-timeline" id="recent-activity">
                        <p class="loading">Loading activity...</p>
                    </div>
                </div>
            </div>

            <!-- Super Dashboard -->
            <div id="super-dashboard-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">üëë Super Admin Dashboard</h2>
                
                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">Total Users</div>
                        <div class="stat-value" style="color: white;" id="super-users">0</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">Registered</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; border: none;">
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">All-Time Revenue</div>
                        <div class="stat-value" style="color: white;" id="super-revenue">‚Çµ0</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">Total Earnings</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none;">
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">Active Admins</div>
                        <div class="stat-value" style="color: white;" id="super-admins">0</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">Personnel</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; border: none;">
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">System Health</div>
                        <div class="stat-value" style="color: white;">98%</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">Operational</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Real-Time Activity</h3>
                    </div>
                    <div class="activity-timeline" id="super-activity">
                        <p class="loading">Loading activity...</p>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="users-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">User Management</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">All Users</h3>
                        <input type="text" class="search-input" id="user-search" placeholder="Search users...">
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Balance</th>
                                    <th>KYC Status</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody">
                                <tr><td colspan="6" class="loading">Loading users...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- KYC Page -->
            <div id="kyc-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">KYC Verification</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Pending Verifications</h3>
                        <select class="filter-select" id="kyc-filter">
                            <option value="under_review">Under Review</option>
                            <option value="all">All</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>ID Type</th>
                                    <th>Submitted</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="kyc-tbody">
                                <tr><td colspan="5" class="loading">Loading KYC submissions...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Transactions Page -->
            <div id="transactions-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">Transaction Management</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">All Transactions</h3>
                        <div class="filter-group">
                            <select class="filter-select" id="trans-filter">
                                <option value="pending">Pending</option>
                                <option value="all">All</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <select class="filter-select" id="trans-type-filter">
                                <option value="all">All Types</option>
                                <option value="contribution">Contributions</option>
                                <option value="withdrawal">Withdrawals</option>
                            </select>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="trans-tbody">
                                <tr><td colspan="7" class="loading">Loading transactions...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">User Reports</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Support Tickets</h3>
                        <div class="filter-group">
                            <select class="filter-select" id="report-status-filter">
                                <option value="pending">Pending</option>
                                <option value="in-progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                                <option value="all">All</option>
                            </select>
                            <select class="filter-select" id="report-category-filter">
                                <option value="all">All Categories</option>
                                <option value="contribution-issues">Contribution Issues</option>
                                <option value="withdrawal-problems">Withdrawal Problems</option>
                                <option value="kyc-verification">KYC Verification</option>
                                <option value="payment-method-issues">Payment Method Issues</option>
                                <option value="account-access">Account Access</option>
                                <option value="security-concerns">Security Concerns</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Category</th>
                                    <th>Subject</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                    <th>Submitted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reports-tbody">
                                <tr><td colspan="7" class="loading">Loading reports...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin Users Page -->
            <div id="admin-users-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">Admin User Management</h2>
                
                <div class="content-card" style="margin-bottom: 20px;">
                    <div class="card-header">
                        <h3 class="card-title">Add New Admin</h3>
                    </div>
                    <form id="add-admin-form">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="new-admin-name" required placeholder="Full name">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="new-admin-email" required placeholder="admin@susupay.com">
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select id="new-admin-role" required>
                                    <option value="">Select role...</option>
                                    <option value="senior">Senior Admin</option>
                                    <option value="financial">Financial Admin</option>
                                    <option value="support">Support Admin</option>
                                    <option value="security">Security Admin</option>
                                    <option value="operations">Operations Admin</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="new-admin-pass" required minlength="8" placeholder="Min. 8 characters">
                            </div>
                        </div>
                        <button type="submit" class="btn">Add Admin</button>
                    </form>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Current Admins</h3>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Added</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admins-tbody">
                                <tr><td colspan="5" class="loading">Loading admins...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin Activity Page -->
            <div id="admin-activity-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">Admin Activity Log</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Admin Actions</h3>
                    </div>
                    <div id="admin-activity-list">
                        <p class="loading">Loading admin activity...</p>
                    </div>
                </div>
            </div>

            <!-- User Analytics Page -->
            <div id="user-analytics-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">User Analytics</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Active Users (30d)</div>
                        <div class="stat-value" id="active-users">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">New Signups (7d)</div>
                        <div class="stat-value" id="new-signups">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">KYC Verified</div>
                        <div class="stat-value" id="kyc-verified">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Balance</div>
                        <div class="stat-value" id="avg-balance">‚Çµ0</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">User Growth Chart</h3>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">üìà</div>
                        <p>Analytics visualization coming soon</p>
                    </div>
                </div>
            </div>

            <!-- Financial Overview Page -->
            <div id="financial-overview-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">Financial Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Contributions</div>
                        <div class="stat-value" id="total-contrib">‚Çµ0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Withdrawals</div>
                        <div class="stat-value" id="total-withdraw">‚Çµ0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Commission Earned</div>
                        <div class="stat-value" id="total-commission">‚Çµ0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending Value</div>
                        <div class="stat-value" id="pending-value">‚Çµ0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Investments</div>
                        <div class="stat-value" id="pending-value">‚Çµ0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Return On Investments (ROI)</div>
                        <div class="stat-value" id="pending-value">‚Çµ0</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Financial Trends</h3>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">üí∞</div>
                        <p>Financial charts coming soon</p>
                    </div>
                </div>
            </div>

            <!-- Security Logs Page -->
            <div id="security-logs-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">Security Logs</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">System Security Events</h3>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">üîí</div>
                        <p>Security monitoring coming soon</p>
                    </div>
                </div>
            </div>

            <!-- Suspicious Activity Page -->
            <div id="suspicious-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">Suspicious Activity</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Flagged Activities</h3>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <p>No suspicious activity detected</p>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">System Settings</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Application Configuration</h3>
                    </div>
                    <div class="empty-state">
                        <div class="empty-state-icon">‚öôÔ∏è</div>
                        <p>System settings interface coming soon</p>
                    </div>
                </div>
            </div>
            <!-- Announcements Page -->
<div id="announcements-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">System Announcements</h2>
    
    <div class="content-card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">Send New Announcement</h3>
        </div>
        <form id="announcement-form">
            <div class="form-group">
                <label>Announcement Title</label>
                <input type="text" id="announcement-title" required placeholder="e.g., System Maintenance Notice">
            </div>
            <div class="form-group">
                <label>Message</label>
                <textarea id="announcement-message" rows="6" required placeholder="Enter your announcement message here..."></textarea>
            </div>
            <div class="form-group">
    <label>Announcement Category</label>
    <select id="announcement-category" required>
        <option value="updates">Updates</option>
        <option value="maintenance">Maintenance</option>
        <option value="new-features">New Features</option>
        <option value="promotions">Promotions</option>
        <option value="alerts">Alerts</option>
    </select>
</div>
<div class="form-group">
    <label>Priority Level</label>
    <select id="announcement-priority">
        <option value="info">Info (Blue)</option>
        <option value="warning">Warning (Yellow)</option>
        <option value="urgent">Urgent (Red)</option>
    </select>
</div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <button type="submit" class="btn">Send to All Users</button>
                <span id="announcement-status" style="color: #718096;"></span>
            </div>
        </form>
    </div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">Recent Announcements</h3>
        </div>
        <div style="overflow-x: auto;">
            <table class="data-table">
                <thead>
    <tr>
        <th>Title</th>
        <th>Message Preview</th>
        <th>Category</th>
        <th>Priority</th>
        <th>Sent By</th>
        <th>Date</th>
        <th>Recipients</th>
    </tr>
</thead>
                <tbody id="announcements-tbody">
                    <tr><td colspan="6" class="loading">Loading announcements...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
            <!-- Future Projects Admin Page -->
<div id="future-projects-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">Future Projects Management</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Total Projects</div>
            <div class="stat-value" id="admin-total-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Active Projects</div>
            <div class="stat-value" id="admin-active-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Matured Projects</div>
            <div class="stat-value" id="admin-matured-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Total Locked Value</div>
            <div class="stat-value" id="admin-locked-value">‚Çµ0</div>
        </div>
    </div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">All Future Projects</h3>
            <div class="filter-group">
                <select class="filter-select" id="project-status-filter" onchange="loadAdminFutureProjects()">
                    <option value="all">All Status</option>
                    <option value="active">Active</option>
                    <option value="matured">Matured</option>
                </select>
                <select class="filter-select" id="project-type-filter" onchange="loadAdminFutureProjects()">
                    <option value="all">All Types</option>
                    <option value="kids">For Kids</option>
                    <option value="myself">For Myself</option>
                    <option value="parents">For Parents</option>
                    <option value="spouse">For Spouse</option>
                    <option value="family">Family Project</option>
                    <option value="wedding">Wedding</option>
                    <option value="imminent">Imminent</option>
                </select>
            </div>
        </div>
        <div style="overflow-x: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Project Title</th>
                        <th>Type</th>
                        <th>Current/Goal</th>
                        <th>Progress</th>
                        <th>Maturity</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-projects-tbody">
                    <tr><td colspan="8" class="loading">Loading projects...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
        </main>
    </div>

    <!-- KYC Review Modal -->
    <div class="modal" id="kyc-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('kyc-modal')">&times;</button>
            <h2 class="modal-title">KYC Verification Review</h2>
            
            <div class="user-details-grid">
                <div class="detail-item">
                    <div class="detail-label">User</div>
                    <div class="detail-value" id="kyc-user-name"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Email</div>
                    <div class="detail-value" id="kyc-user-email"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">ID Type</div>
                    <div class="detail-value" id="kyc-id-type"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Submitted</div>
                    <div class="detail-value" id="kyc-submitted"></div>
                </div>
            </div>

            <h3 style="margin: 20px 0; color: #4a5568;">Documents</h3>
            <div class="document-preview">
                <div>
                    <p style="font-weight: 600; margin-bottom: 10px; color: #4a5568;">Front ID</p>
                    <img id="kyc-front" src="" alt="Front ID" onclick="window.open(this.src, '_blank')">
                </div>
                <div>
                    <p style="font-weight: 600; margin-bottom: 10px; color: #4a5568;">Back ID</p>
                    <img id="kyc-back" src="" alt="Back ID" onclick="window.open(this.src, '_blank')">
                </div>
                <div>
                    <p style="font-weight: 600; margin-bottom: 10px; color: #4a5568;">Selfie</p>
                    <img id="kyc-selfie" src="" alt="Selfie" onclick="window.open(this.src, '_blank')">
                </div>
            </div>

            <div class="form-group">
                <label>Review Notes</label>
                <textarea id="kyc-notes" rows="3" placeholder="Add notes about your decision..."></textarea>
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                <button class="action-btn btn-reject" onclick="rejectKYC()">Reject</button>
                <button class="action-btn btn-approve" onclick="approveKYC()">Approve</button>
            </div>
        </div>
    </div>

    <!-- Transaction Review Modal -->
    <div class="modal" id="trans-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('trans-modal')">&times;</button>
            <h2 class="modal-title">Transaction Review</h2>
            
            <div class="user-details-grid">
                <div class="detail-item">
                    <div class="detail-label">User</div>
                    <div class="detail-value" id="trans-user"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value" id="trans-type"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Amount</div>
                    <div class="detail-value" id="trans-amount"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Method</div>
                    <div class="detail-value" id="trans-method"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Transaction ID</div>
                    <div class="detail-value" id="trans-ref"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Date</div>
                    <div class="detail-value" id="trans-date"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Review Notes</label>
                <textarea id="trans-notes" rows="3" placeholder="Add notes about your decision..."></textarea>
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                <button class="action-btn btn-reject" onclick="rejectTransaction()">Reject</button>
                <button class="action-btn btn-approve" onclick="approveTransaction()">Approve</button>
            </div>
        </div>
    </div>

    <!-- Report Review Modal -->
    <div class="modal" id="report-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('report-modal')">&times;</button>
            <h2 class="modal-title">Support Ticket Details</h2>
            
            <div class="user-details-grid">
                <div class="detail-item">
                    <div class="detail-label">User</div>
                    <div class="detail-value" id="report-user-name"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Email</div>
                    <div class="detail-value" id="report-user-email"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Category</div>
                    <div class="detail-value" id="report-category"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Priority</div>
                    <div class="detail-value" id="report-priority"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Status</div>
                    <div class="detail-value" id="report-status"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Submitted</div>
                    <div class="detail-value" id="report-submitted"></div>
                </div>
            </div>

            <div style="margin: 20px 0;">
                <h3 style="margin-bottom: 10px; color: #4a5568;">Subject</h3>
                <div style="padding: 15px; background: #f7fafc; border-radius: 8px; font-weight: 600; color: #4a5568;" id="report-subject"></div>
            </div>

            <div style="margin: 20px 0;">
                <h3 style="margin-bottom: 10px; color: #4a5568;">Description</h3>
                <div style="padding: 15px; background: #f7fafc; border-radius: 8px; white-space: pre-wrap; color: #4a5568;" id="report-description"></div>
            </div>

            <div class="form-group">
                <label>Admin Response</label>
                <textarea id="report-response" rows="4" placeholder="Write your response to the user..."></textarea>
            </div>

            <div class="form-group">
                <label>Update Status</label>
                <select id="report-new-status">
                    <option value="in-progress">In Progress</option>
                    <option value="resolved">Resolved</option>
                    <option value="pending">Pending</option>
                </select>
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                <button class="action-btn btn-view" onclick="closeModal('report-modal')">Cancel</button>
                <button class="action-btn btn-approve" onclick="respondToReport()">Send Response</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, getDocs, updateDoc, setDoc, deleteDoc, collection, query, where, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAoomGKHjU2iUJjjMxEDGCsLzRtIkHtqhY",
            authDomain: "susupay-5286e.firebaseapp.com",
            projectId: "susupay-5286e",
            storageBucket: "susupay-5286e.firebasestorage.app",
            messagingSenderId: "83852132974",
            appId: "1:83852132974:web:2d8be2d1adb7e7639f5c7f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentAdmin = null;
        let adminRole = null;
        let currentKycReview = null;
        let currentTransReview = null;
        let currentReportReview = null;

        const rolePermissions = {
    super: ['dashboard', 'users', 'kyc', 'transactions', 'admin-users', 'super-dashboard', 'admin-activity', 'user-analytics', 'financial-overview', 'reports', 'security-logs', 'suspicious', 'settings', 'future-projects', 'announcements'],
    main: ['dashboard', 'users', 'kyc', 'transactions', 'admin-users', 'reports', 'settings', 'future-projects', 'announcements'],
    senior: ['dashboard', 'users', 'kyc', 'transactions', 'admin-users', 'reports', 'future-projects', 'announcements'],
    financial: ['dashboard', 'transactions', 'users', 'reports', 'financial-overview', 'future-projects'],
    support: ['dashboard', 'users', 'reports', 'announcements'],
    security: ['dashboard', 'users', 'kyc', 'reports', 'security-logs', 'suspicious'],
    operations: ['dashboard', 'users', 'transactions', 'kyc', 'reports', 'future-projects', 'announcements']
};

        // Utility functions
        function showAlert(msg, type, container = 'dashboard-alert') {
            const div = document.getElementById(container);
            div.innerHTML = `<div class="alert alert-${type}">${msg}</div>`;
            setTimeout(() => div.innerHTML = '', 5000);
        }

        function formatCurrency(amount) {
            return `‚Çµ${parseFloat(amount || 0).toLocaleString('en-GH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleDateString('en-GB', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Login
        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const role = document.getElementById('admin-role').value;
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const adminDoc = await getDoc(doc(db, 'admins', userCredential.user.uid));
                
                if (!adminDoc.exists()) {
                    showAlert('Not an admin account', 'error', 'login-alert');
                    await signOut(auth);
                    return;
                }

                const adminData = adminDoc.data();
                if (adminData.role !== role) {
                    showAlert(`Role mismatch. You are ${adminData.role} admin`, 'error', 'login-alert');
                    await signOut(auth);
                    return;
                }

                adminRole = role;
                currentAdmin = userCredential.user;
                loadDashboard();
            } catch (error) {
                showAlert(error.message, 'error', 'login-alert');
            }
        });

        // Auth state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const adminDoc = await getDoc(doc(db, 'admins', user.uid));
                if (adminDoc.exists()) {
                    currentAdmin = user;
                    adminRole = adminDoc.data().role;
                    loadDashboard();
                } else {
                    await signOut(auth);
                    showLoginPage();
                }
            } else {
                showLoginPage();
            }
        });

        function showLoginPage() {
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('dashboard-page').style.display = 'none';
        }

        async function loadDashboard() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'block';

            const adminDoc = await getDoc(doc(db, 'admins', currentAdmin.uid));
            const adminData = adminDoc.data();

            document.getElementById('admin-name').textContent = adminData.name;
            document.getElementById('admin-email-display').textContent = adminData.email;
            document.getElementById('user-avatar').textContent = adminData.name.charAt(0).toUpperCase();
            document.getElementById('role-badge').textContent = adminRole.charAt(0).toUpperCase() + adminRole.slice(1) + ' Admin';
            document.getElementById('role-badge').className = `admin-role-badge role-${adminRole}`;

            configureSidebar();
            
            if (adminRole === 'super') {
                document.getElementById('admin-header').classList.add('super-admin-header');
                document.getElementById('admin-sidebar').classList.add('super-admin-sidebar');
                showPage('super-dashboard');
            } else {
                showPage('dashboard');
            }
        }

        function configureSidebar() {
            const permissions = rolePermissions[adminRole];
            
            document.getElementById('super-section').style.display = adminRole === 'super' ? 'block' : 'none';
            document.getElementById('kyc-section').style.display = permissions.includes('kyc') ? 'block' : 'none';
            document.getElementById('financial-section').style.display = permissions.includes('transactions') ? 'block' : 'none';
            document.getElementById('admin-section').style.display = permissions.includes('admin-users') ? 'block' : 'none';
            document.getElementById('support-section').style.display = permissions.includes('reports') ? 'block' : 'none';
            document.getElementById('security-section').style.display = permissions.includes('security-logs') ? 'block' : 'none';
        }

        // Navigation
        document.querySelectorAll('.sidebar-nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                if (!rolePermissions[adminRole].includes(page)) {
                    showAlert('You do not have permission to access this page', 'error');
                    return;
                }
                showPage(page);
                closeMobileSidebar();
            });
        });

        async function showPage(page) {
            document.querySelectorAll('.sidebar-nav-item').forEach(i => i.classList.remove('active'));
            document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById(`${page}-content`)?.classList.remove('hidden');

           if (page === 'dashboard') await loadDashboardStats();
else if (page === 'super-dashboard') await loadSuperDashboard();
else if (page === 'users') await loadUsers();
else if (page === 'kyc') await loadKYC();
else if (page === 'transactions') await loadTransactions();
else if (page === 'admin-users') await loadAdminUsers();
else if (page === 'admin-activity') await loadAdminActivity();
else if (page === 'user-analytics') await loadUserAnalytics();
else if (page === 'financial-overview') await loadFinancialOverview();
else if (page === 'reports') await loadReports();
else if (page === 'future-projects') await loadAdminFutureProjects();
else if (page === 'announcements') await loadAnnouncements();
        }

        // Load Dashboard Stats
        async function loadDashboardStats() {
            try {
                const users = await getDocs(collection(db, 'users'));
                const trans = await getDocs(collection(db, 'transactions'));
                const kycPending = await getDocs(query(collection(db, 'kyc_submissions'), where('status', '==', 'under_review')));
                const reportsPending = await getDocs(query(collection(db, 'reports'), where('status', '==', 'pending')));
                
                let revenue = 0;
                trans.forEach(doc => {
                    const data = doc.data();
                    if (data.type === 'withdrawal' && data.commission) revenue += data.commission;
                });

                document.getElementById('stat-users').textContent = users.size;
                document.getElementById('stat-trans').textContent = trans.size;
                document.getElementById('stat-kyc').textContent = kycPending.size;
                document.getElementById('stat-revenue').textContent = formatCurrency(revenue);
                document.getElementById('kyc-badge').textContent = kycPending.size;
                document.getElementById('reports-badge').textContent = reportsPending.size;
                
                const transPending = await getDocs(query(collection(db, 'transactions'), where('status', '==', 'pending')));
                document.getElementById('trans-badge').textContent = transPending.size;

                await loadRecentActivity();
            } catch (error) {
                console.error('Dashboard error:', error);
                showAlert('Error loading dashboard data', 'error');
            }
        }

        // Load Recent Activity
        async function loadRecentActivity() {
            const container = document.getElementById('recent-activity');
            container.innerHTML = '';

            try {
                const q = query(collection(db, 'transactions'), orderBy('timestamp', 'desc'), limit(10));
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìä</div><p>No recent activity</p></div>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', trans.userId));
                    
                    if (!userDoc.exists()) continue;
                    
                    const userData = userDoc.data();

                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                        <div class="activity-time">${formatDate(trans.timestamp)}</div>
                        <div class="activity-description">
                            <span class="activity-user">${userData.firstName} ${userData.surname}</span>
                            ${trans.type === 'contribution' ? 'contributed' : 'withdrew'} ${formatCurrency(trans.amount)}
                            <span class="status-badge status-${trans.status}" style="margin-left: 10px; font-size: 0.75rem;">${trans.status.toUpperCase()}</span>
                        </div>
                    `;
                    container.appendChild(item);
                }
            } catch (error) {
                console.error('Activity error:', error);
                container.innerHTML = '<p style="text-align: center; color: #e53e3e;">Error loading activity</p>';
            }
        }

        // Load Super Dashboard
        async function loadSuperDashboard() {
            try {
                const users = await getDocs(collection(db, 'users'));
                const admins = await getDocs(collection(db, 'admins'));
                const trans = await getDocs(collection(db, 'transactions'));
                
                let revenue = 0;
                trans.forEach(doc => {
                    const data = doc.data();
                    if (data.type === 'withdrawal' && data.commission) revenue += data.commission;
                });

                document.getElementById('super-users').textContent = users.size;
                document.getElementById('super-admins').textContent = admins.size;
                document.getElementById('super-revenue').textContent = formatCurrency(revenue);

                await loadRealtimeActivity();
            } catch (error) {
                console.error('Super dashboard error:', error);
                showAlert('Error loading super dashboard', 'error');
            }
        }

        async function loadRealtimeActivity() {
            const container = document.getElementById('super-activity');
            container.innerHTML = '';

            try {
                const q = query(collection(db, 'transactions'), orderBy('timestamp', 'desc'), limit(15));
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìä</div><p>No recent activity</p></div>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', trans.userId));
                    
                    if (!userDoc.exists()) continue;
                    
                    const userData = userDoc.data();

                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                        <div class="activity-time">${formatDate(trans.timestamp)}</div>
                        <div class="activity-description">
                            <span class="activity-user">${userData.firstName} ${userData.surname}</span>
                            ${trans.type === 'contribution' ? 'contributed' : 'withdrew'} ${formatCurrency(trans.amount)}
                            <span class="status-badge status-${trans.status}" style="margin-left: 10px; font-size: 0.75rem;">${trans.status.toUpperCase()}</span>
                        </div>
                    `;
                    container.appendChild(item);
                }
            } catch (error) {
                console.error('Activity error:', error);
                container.innerHTML = '<p style="text-align: center; color: #e53e3e;">Error loading activity</p>';
            }
        }

        // Load Users
        async function loadUsers() {
            const tbody = document.getElementById('users-tbody');
            tbody.innerHTML = '<tr><td colspan="6" class="loading">Loading users...</td></tr>';

            try {
                const snapshot = await getDocs(collection(db, 'users'));
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No users found</td></tr>';
                    return;
                }

                snapshot.forEach(docSnap => {
                    const user = docSnap.data();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${user.firstName || 'N/A'} ${user.surname || ''}</td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${formatCurrency(user.balance)}</td>
                        <td><span class="status-badge status-${user.kycStatus || 'pending'}">${(user.kycStatus || 'pending').replace('_', ' ').toUpperCase()}</span></td>
                        <td>${formatDate(user.createdAt)}</td>
                        <td><button class="action-btn btn-view">View</button></td>
                    `;
                });
            } catch (error) {
                console.error('Users error:', error);
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: #e53e3e;">Error loading users: ${error.message}</td></tr>`;
            }
        }

        // Load KYC
        async function loadKYC() {
            const tbody = document.getElementById('kyc-tbody');
            tbody.innerHTML = '<tr><td colspan="5" class="loading">Loading KYC submissions...</td></tr>';

            try {
                const filter = document.getElementById('kyc-filter').value;
                let q;
                if (filter === 'all') {
                    q = query(collection(db, 'kyc_submissions'), orderBy('submittedAt', 'desc'));
                } else {
                    q = query(collection(db, 'kyc_submissions'), where('status', '==', filter), orderBy('submittedAt', 'desc'));
                }

                const snapshot = await getDocs(q);
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state">No KYC submissions found</td></tr>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const kyc = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', kyc.userId));
                    
                    if (!userDoc.exists()) continue;
                    
                    const userData = userDoc.data();

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${userData.firstName} ${userData.surname}</td>
                        <td>${kyc.idType ? kyc.idType.toUpperCase() : 'N/A'}</td>
                        <td>${formatDate(kyc.submittedAt)}</td>
                        <td><span class="status-badge status-${kyc.status}">${kyc.status.replace('_', ' ').toUpperCase()}</span></td>
                        <td><button class="action-btn btn-view" onclick="window.reviewKYC('${docSnap.id}')">Review</button></td>
                    `;
                }
            } catch (error) {
                console.error('KYC error:', error);
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: #e53e3e;">Error loading KYC: ${error.message}</td></tr>`;
            }
        }

        // Review KYC
        window.reviewKYC = async function(id) {
            try {
                const kycDoc = await getDoc(doc(db, 'kyc_submissions', id));
                if (!kycDoc.exists()) {
                    showAlert('KYC submission not found', 'error');
                    return;
                }
                
                const kycData = kycDoc.data();
                const userDoc = await getDoc(doc(db, 'users', kycData.userId));
                
                if (!userDoc.exists()) {
                    showAlert('User not found', 'error');
                    return;
                }
                
                const userData = userDoc.data();

                currentKycReview = { id, data: kycData };

                document.getElementById('kyc-user-name').textContent = `${userData.firstName} ${userData.surname}`;
                document.getElementById('kyc-user-email').textContent = userData.email;
                document.getElementById('kyc-id-type').textContent = kycData.idType ? kycData.idType.toUpperCase() : 'N/A';
                document.getElementById('kyc-submitted').textContent = formatDate(kycData.submittedAt);
                document.getElementById('kyc-front').src = kycData.frontIdUrl || '';
                document.getElementById('kyc-back').src = kycData.backIdUrl || '';
                document.getElementById('kyc-selfie').src = kycData.selfieUrl || '';
                document.getElementById('kyc-notes').value = '';

                document.getElementById('kyc-modal').style.display = 'block';
            } catch (error) {
                console.error('Review KYC error:', error);
                showAlert('Error loading KYC details: ' + error.message, 'error');
            }
        };

        window.approveKYC = async function() {
            if (!currentKycReview) return;

            try {
                await updateDoc(doc(db, 'kyc_submissions', currentKycReview.id), {
                    status: 'approved',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    reviewNotes: document.getElementById('kyc-notes').value
                });

                await updateDoc(doc(db, 'users', currentKycReview.data.userId), {
                    kycStatus: 'approved'
                });

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentKycReview.data.userId,
                    title: 'KYC Approved',
                    message: 'Your KYC verification has been approved. You can now access all features.',
                    type: 'kyc-approval',
                    read: false,
                    timestamp: serverTimestamp()
                });

                showAlert('KYC approved successfully!', 'success');
                closeModal('kyc-modal');
                loadKYC();
                loadDashboardStats();
            } catch (error) {
                console.error('Approve KYC error:', error);
                showAlert('Error approving KYC: ' + error.message, 'error');
            }
        };

        window.rejectKYC = async function() {
            if (!currentKycReview) return;
            const notes = document.getElementById('kyc-notes').value;
            if (!notes.trim()) {
                showAlert('Please provide a reason for rejection', 'error');
                return;
            }

            try {
                await updateDoc(doc(db, 'kyc_submissions', currentKycReview.id), {
                    status: 'rejected',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    reviewNotes: notes
                });

                await updateDoc(doc(db, 'users', currentKycReview.data.userId), {
                    kycStatus: 'rejected'
                });

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentKycReview.data.userId,
                    title: 'KYC Rejected',
                    message: `Your KYC verification was rejected. Reason: ${notes}`,
                    type: 'kyc-rejection',
                    read: false,
                    timestamp: serverTimestamp()
                });

                showAlert('KYC rejected', 'info');
                closeModal('kyc-modal');
                loadKYC();
                loadDashboardStats();
            } catch (error) {
                console.error('Reject KYC error:', error);
                showAlert('Error rejecting KYC: ' + error.message, 'error');
            }
        };

        // Load Transactions
        async function loadTransactions() {
            const tbody = document.getElementById('trans-tbody');
            tbody.innerHTML = '<tr><td colspan="7" class="loading">Loading transactions...</td></tr>';

            try {
                const status = document.getElementById('trans-filter').value;
                const type = document.getElementById('trans-type-filter').value;

                let q;
                if (status === 'all' && type === 'all') {
                    q = query(collection(db, 'transactions'), orderBy('timestamp', 'desc'), limit(100));
                } else if (status !== 'all' && type === 'all') {
                    q = query(collection(db, 'transactions'), where('status', '==', status), orderBy('timestamp', 'desc'), limit(100));
                } else if (status === 'all' && type !== 'all') {
                    q = query(collection(db, 'transactions'), where('type', '==', type), orderBy('timestamp', 'desc'), limit(100));
                } else {
                    q = query(collection(db, 'transactions'), where('status', '==', status), where('type', '==', type), orderBy('timestamp', 'desc'), limit(100));
                }

                const snapshot = await getDocs(q);
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No transactions found</td></tr>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', trans.userId));
                    
                    if (!userDoc.exists()) continue;
                    
                    const userData = userDoc.data();

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${userData.firstName} ${userData.surname}</td>
                        <td style="text-transform: capitalize;">${trans.type}</td>
                        <td>${formatCurrency(trans.amount)}</td>
                        <td>${trans.paymentMethod || 'N/A'}</td>
                        <td><span class="status-badge status-${trans.status}">${trans.status.toUpperCase()}</span></td>
                        <td>${formatDate(trans.timestamp)}</td>
                        <td><button class="action-btn btn-view" onclick="window.reviewTransaction('${docSnap.id}')">Review</button></td>
                    `;
                }
            } catch (error) {
                console.error('Transactions error:', error);
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: #e53e3e;">Error loading transactions: ${error.message}</td></tr>`;
            }
        }

        // Review Transaction
        window.reviewTransaction = async function(id) {
            try {
                const transDoc = await getDoc(doc(db, 'transactions', id));
                if (!transDoc.exists()) {
                    showAlert('Transaction not found', 'error');
                    return;
                }
                
                const transData = transDoc.data();
                const userDoc = await getDoc(doc(db, 'users', transData.userId));
                
                if (!userDoc.exists()) {
                    showAlert('User not found', 'error');
                    return;
                }
                
                const userData = userDoc.data();

                currentTransReview = { id, data: transData };

                document.getElementById('trans-user').textContent = `${userData.firstName} ${userData.surname}`;
                document.getElementById('trans-type').textContent = transData.type ? transData.type.toUpperCase() : 'N/A';
                document.getElementById('trans-amount').textContent = formatCurrency(transData.amount);
                document.getElementById('trans-method').textContent = transData.paymentMethod || 'N/A';
                document.getElementById('trans-ref').textContent = transData.transactionId || 'N/A';
                document.getElementById('trans-date').textContent = formatDate(transData.timestamp);
                document.getElementById('trans-notes').value = '';

                document.getElementById('trans-modal').style.display = 'block';
            } catch (error) {
                console.error('Review transaction error:', error);
                showAlert('Error loading transaction details: ' + error.message, 'error');
            }
        };

        window.approveTransaction = async function() {
            if (!currentTransReview) return;

            try {
                await updateDoc(doc(db, 'transactions', currentTransReview.id), {
                    status: 'approved',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    reviewNotes: document.getElementById('trans-notes').value
                });

                if (currentTransReview.data.type === 'contribution') {
                    const userRef = doc(db, 'users', currentTransReview.data.userId);
                    const userDoc = await getDoc(userRef);
                    const userData = userDoc.data();

                    const monthKey = currentTransReview.data.month;
                    const contributedDays = userData.contributedDays || {};
                    const monthDays = contributedDays[monthKey] || [];

                    const updatedDays = monthDays.map(day => {
                        if (currentTransReview.data.days && currentTransReview.data.days.includes(day.day)) {
                            return { ...day, status: 'approved' };
                        }
                        return day;
                    });

                    await updateDoc(userRef, {
                        [`contributedDays.${monthKey}`]: updatedDays,
                        balance: (userData.balance || 0) + currentTransReview.data.amount
                    });
                }

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentTransReview.data.userId,
                    title: 'Transaction Approved',
                    message: `Your ${currentTransReview.data.type} of ${formatCurrency(currentTransReview.data.amount)} has been approved.`,
                    type: 'transaction-approval',
                    read: false,
                    timestamp: serverTimestamp()
                });

                showAlert('Transaction approved successfully!', 'success');
                closeModal('trans-modal');
                loadTransactions();
                loadDashboardStats();
            } catch (error) {
                console.error('Approve transaction error:', error);
                showAlert('Error approving transaction: ' + error.message, 'error');
            }
        };
       

        window.rejectTransaction = async function() {
            if (!currentTransReview) return;
            const notes = document.getElementById('trans-notes').value;
            if (!notes.trim()) {
                showAlert('Please provide a reason for rejection', 'error');
                return;
            }

            try {
                await updateDoc(doc(db, 'transactions', currentTransReview.id), {
                    status: 'rejected',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    rejectionReason: notes
                });

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentTransReview.data.userId,
                    title: 'Transaction Rejected',
                    message: `Your ${currentTransReview.data.type} of ${formatCurrency(currentTransReview.data.amount)} was rejected. Reason: ${notes}`,
                    type: 'transaction-rejection',
                    read: false,
                    timestamp: serverTimestamp()
                });

                showAlert('Transaction rejected', 'info');
                closeModal('trans-modal');
                loadTransactions();
                loadDashboardStats();
            } catch (error) {
                console.error('Reject transaction error:', error);
                showAlert('Error rejecting transaction: ' + error.message, 'error');
            }
        };
const adminFutureProjectsHTML = `
<!-- Future Projects Page -->
<div id="future-projects-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">Future Projects Management</h2>
    
    <div class="stats-grid" style="margin-bottom: 30px;">
        <div class="stat-card">
            <div class="stat-label">Total Projects</div>
            <div class="stat-value" id="admin-total-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Active Projects</div>
            <div class="stat-value" id="admin-active-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Matured Projects</div>
            <div class="stat-value" id="admin-matured-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Total Locked Value</div>
            <div class="stat-value" id="admin-locked-value">‚Çµ0</div>
        </div>
    </div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">All Future Projects</h3>
            <div class="filter-group">
                <select class="filter-select" id="project-status-filter">
                    <option value="all">All Status</option>
                    <option value="active">Active</option>
                    <option value="matured">Matured</option>
                    <option value="withdrawn">Withdrawn</option>
                </select>
                <select class="filter-select" id="project-type-filter">
                    <option value="all">All Types</option>
                    <option value="kids">For Kids</option>
                    <option value="myself">For Myself</option>
                    <option value="parents">For Parents</option>
                    <option value="spouse">For Spouse</option>
                    <option value="family">Family Project</option>
                    <option value="wedding">Wedding</option>
                    <option value="imminent">Imminent</option>
                </select>
            </div>
        </div>
        <div style="overflow-x: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Project Title</th>
                        <th>Type</th>
                        <th>Current Amount</th>
                        <th>Goal Amount</th>
                        <th>Progress</th>
                        <th>Maturity Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-projects-tbody">
                    <tr><td colspan="9" class="loading">Loading projects...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
`;


// FIX 4: Admin Function to Load Future Projects
async function loadAdminFutureProjects() {
    const tbody = document.getElementById('admin-projects-tbody');
    tbody.innerHTML = '<tr><td colspan="9" class="loading">Loading projects...</td></tr>';

    try {
        const statusFilter = document.getElementById('project-status-filter').value;
        const typeFilter = document.getElementById('project-type-filter').value;

        let q;
        if (statusFilter === 'all' && typeFilter === 'all') {
            q = query(collection(db, 'future_projects'), orderBy('createdAt', 'desc'));
        } else if (statusFilter !== 'all' && typeFilter === 'all') {
            q = query(collection(db, 'future_projects'), where('status', '==', statusFilter), orderBy('createdAt', 'desc'));
        } else if (statusFilter === 'all' && typeFilter !== 'all') {
            q = query(collection(db, 'future_projects'), where('type', '==', typeFilter), orderBy('createdAt', 'desc'));
        } else {
            q = query(
                collection(db, 'future_projects'), 
                where('status', '==', statusFilter), 
                where('type', '==', typeFilter), 
                orderBy('createdAt', 'desc')
            );
        }

        const snapshot = await getDocs(q);
        tbody.innerHTML = '';

        if (snapshot.empty) {
            tbody.innerHTML = '<tr><td colspan="9" class="empty-state">No projects found</td></tr>';
            return;
        }

        let totalProjects = 0;
        let activeProjects = 0;
        let maturedProjects = 0;
        let totalLockedValue = 0;

        for (const docSnap of snapshot.docs) {
            const project = docSnap.data();
            const userDoc = await getDoc(doc(db, 'users', project.userId));
            
            if (!userDoc.exists()) continue;
            
            const userData = userDoc.data();
            const progress = (project.currentAmount / project.goalAmount) * 100;
            const maturityDate = project.maturityDate?.toDate ? project.maturityDate.toDate() : new Date(project.maturityDate);
            const isMatured = new Date() >= maturityDate;

            totalProjects++;
            if (project.status === 'active') activeProjects++;
            if (isMatured) maturedProjects++;
            if (project.status === 'active') totalLockedValue += project.currentAmount || 0;

            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${userData.firstName} ${userData.surname}</td>
                <td>${project.title}</td>
                <td style="text-transform: capitalize;">${project.type.replace('-', ' ')}</td>
                <td>${formatCurrency(project.currentAmount || 0)}</td>
                <td>${formatCurrency(project.goalAmount)}</td>
                <td>
                    <div style="width: 100%; background: #e2e8f0; border-radius: 10px; height: 8px; overflow: hidden;">
                        <div style="width: ${Math.min(progress, 100)}%; height: 100%; background: #48bb78; border-radius: 10px;"></div>
                    </div>
                    <small style="color: #718096;">${progress.toFixed(1)}%</small>
                </td>
                <td>${maturityDate.toLocaleDateString()}</td>
                <td>
                    <span class="status-badge ${isMatured ? 'status-approved' : 'status-pending'}">
                        ${isMatured ? 'MATURED' : project.status.toUpperCase()}
                    </span>
                </td>
                <td><button class="action-btn btn-view" onclick="window.viewAdminProjectDetails('${docSnap.id}')">View</button></td>
            `;
        }

        // Update stats
        document.getElementById('admin-total-projects').textContent = totalProjects;
        document.getElementById('admin-active-projects').textContent = activeProjects;
        document.getElementById('admin-matured-projects').textContent = maturedProjects;
        document.getElementById('admin-locked-value').textContent = formatCurrency(totalLockedValue);

    } catch (error) {
        console.error('Admin projects error:', error);
        tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; color: #e53e3e;">Error loading projects: ${error.message}</td></tr>`;
    }
}

// FIX 5: Optimized Project Maturity Checker (runs once per hour)
let maturityCheckInterval = null;

function startMaturityChecker() {
    // Clear existing interval
    if (maturityCheckInterval) {
        clearInterval(maturityCheckInterval);
    }
    
    // Check immediately
    checkProjectMaturity();
    
    // Then check every hour
    maturityCheckInterval = setInterval(() => {
        checkProjectMaturity();
    }, 60 * 60 * 1000); // 1 hour
}

async function checkProjectMaturity() {
    if (!currentUser || !activeProjects || activeProjects.length === 0) return;
    
    console.log('üîç Checking project maturity...');
    
    try {
        const now = new Date();
        
        for (const project of activeProjects) {
            const maturityDate = project.maturityDate instanceof Date ? 
                project.maturityDate : 
                (project.maturityDate?.toDate ? project.maturityDate.toDate() : new Date(project.maturityDate));
            
            const daysUntilMaturity = Math.ceil((maturityDate - now) / (1000 * 60 * 60 * 24));
            
            // 30-day warning
            if (daysUntilMaturity === 30) {
                const notifKey = `maturity_30day_${project.id}`;
                if (!localStorage.getItem(notifKey)) {
                    await createNotification(
                        'üìÖ Project Maturing Soon',
                        `Your "${project.title}" matures in 30 days! You'll earn 20% interest.`,
                        'info'
                    );
                    localStorage.setItem(notifKey, 'true');
                }
            }
            
            // 7-day warning
            if (daysUntilMaturity === 7) {
                const notifKey = `maturity_7day_${project.id}`;
                if (!localStorage.getItem(notifKey)) {
                    await createNotification(
                        '‚è∞ Project Maturing This Week',
                        `Your "${project.title}" matures in 7 days!`,
                        'info'
                    );
                    localStorage.setItem(notifKey, 'true');
                }
            }
            
            // Matured today
            if (daysUntilMaturity <= 0 && daysUntilMaturity > -1) {
                const notifKey = `maturity_complete_${project.id}`;
                if (!localStorage.getItem(notifKey)) {
                    const interest = project.currentAmount * 0.20;
                    const total = project.currentAmount + interest;
                    
                    await createNotification(
                        'üéâ Project Matured!',
                        `Congratulations! "${project.title}" has matured. Total: ${formatCurrency(total)}`,
                        'success'
                    );
                    
                    localStorage.setItem(notifKey, 'true');
                    
                    // Update project status in Firestore
                    await updateDoc(doc(db, 'future_projects', project.id), {
                        status: 'matured'
                    });
                    
                    // Celebration
                    celebrateMaturity(project.title, total);
                }
            }
        }
        
        console.log('‚úÖ Maturity check complete');
        
    } catch (error) {
        console.error('‚ùå Error checking maturity:', error);
    }
}

// FIX 6: Enhanced Timer Display with Better UX
function updateTimerDisplay() {
    if (!currentUser) return;
    
    const timerDisplay = document.getElementById('timer-display');
    const sessionTimer = document.getElementById('session-timer');
    
    if (!timerDisplay || !sessionTimer) return;
    
    const timeSinceLastActivity = Date.now() - lastActivityTime;
    const timeRemaining = Math.max(0, INACTIVITY_TIMEOUT - timeSinceLastActivity);
    
    if (timeRemaining === 0) {
        handleInactivityLogout();
        return;
    }
    
    const minutes = Math.floor(timeRemaining / 60000);
    const seconds = Math.floor((timeRemaining % 60000) / 1000);
    
    timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    // Show timer when less than 2 minutes remaining
    if (timeRemaining <= 120000) {
        sessionTimer.style.display = 'flex';
        
        // Color coding
        if (timeRemaining <= 60000) {
            timerDisplay.style.color = '#e53e3e';
            timerDisplay.style.fontWeight = '700';
            
            // Flash warning at 30 seconds
            if (timeRemaining <= 30000 && Math.floor(seconds) % 2 === 0) {
                timerDisplay.style.opacity = '0.5';
                setTimeout(() => {
                    if (timerDisplay) timerDisplay.style.opacity = '1';
                }, 500);
            }
        } else {
            timerDisplay.style.color = '#f6cc33';
            timerDisplay.style.fontWeight = '600';
        }
    } else {
        sessionTimer.style.display = 'none';
    }
}

// FIX 7: Initialize everything properly on load
async function initializeEnhancedSystems() {
    if (!currentUser) return;
    
    console.log('üöÄ Initializing enhanced systems...');
    
    // Start maturity checker
    startMaturityChecker();
    
    // Update timer every second
    setInterval(updateTimerDisplay, 1000);
    
    // Initial updates
    updateVIPProgress();
    updateTimerDisplay();
    
    console.log('‚úÖ Enhanced systems initialized');
}

        // Load Reports
        async function loadReports() {
            const tbody = document.getElementById('reports-tbody');
            tbody.innerHTML = '<tr><td colspan="7" class="loading">Loading reports...</td></tr>';

            try {
                const statusFilter = document.getElementById('report-status-filter').value;
                const categoryFilter = document.getElementById('report-category-filter').value;

                let q;
                if (statusFilter === 'all' && categoryFilter === 'all') {
                    q = query(collection(db, 'reports'), orderBy('submittedAt', 'desc'));
                } else if (statusFilter !== 'all' && categoryFilter === 'all') {
                    q = query(collection(db, 'reports'), where('status', '==', statusFilter), orderBy('submittedAt', 'desc'));
                } else if (statusFilter === 'all' && categoryFilter !== 'all') {
                    q = query(collection(db, 'reports'), where('category', '==', categoryFilter), orderBy('submittedAt', 'desc'));
                } else {
                    q = query(collection(db, 'reports'), where('status', '==', statusFilter), where('category', '==', categoryFilter), orderBy('submittedAt', 'desc'));
                }

                const snapshot = await getDocs(q);
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No reports found</td></tr>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const report = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', report.userId));
                    const userData = userDoc.exists() ? userDoc.data() : { firstName: 'Unknown', surname: 'User' };

                    const priorityColors = {
                        high: 'background: #fed7d7; color: #742a2a;',
                        medium: 'background: #fef5e7; color: #744210;',
                        low: 'background: #e6fffa; color: #234e52;'
                    };

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${userData.firstName} ${userData.surname}</td>
                        <td style="text-transform: capitalize;">${report.category.replace(/-/g, ' ')}</td>
                        <td>${report.subject}</td>
                        <td><span class="status-badge" style="${priorityColors[report.priority]}">${report.priority.toUpperCase()}</span></td>
                        <td><span class="status-badge status-${report.status}">${report.status.replace('-', ' ').toUpperCase()}</span></td>
                        <td>${formatDate(report.submittedAt)}</td>
                        <td><button class="action-btn btn-view" onclick="window.reviewReport('${docSnap.id}')">Review</button></td>
                    `;
                }

                const pendingReports = await getDocs(query(collection(db, 'reports'), where('status', '==', 'pending')));
                document.getElementById('reports-badge').textContent = pendingReports.size;
            } catch (error) {
                console.error('Reports error:', error);
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: #e53e3e;">Error loading reports: ${error.message}</td></tr>`;
            }
        }

        window.reviewReport = async function(id) {
            try {
                const reportDoc = await getDoc(doc(db, 'reports', id));
                if (!reportDoc.exists()) {
                    showAlert('Report not found', 'error');
                    return;
                }
                
                const reportData = reportDoc.data();
                const userDoc = await getDoc(doc(db, 'users', reportData.userId));
                const userData = userDoc.exists() ? userDoc.data() : { firstName: 'Unknown', surname: 'User', email: 'N/A' };

                currentReportReview = { id, data: reportData };

                document.getElementById('report-user-name').textContent = `${userData.firstName} ${userData.surname}`;
                document.getElementById('report-user-email').textContent = userData.email;
                document.getElementById('report-category').textContent = reportData.category.replace(/-/g, ' ').toUpperCase();
                document.getElementById('report-priority').textContent = reportData.priority.toUpperCase();
                document.getElementById('report-status').textContent = reportData.status.replace('-', ' ').toUpperCase();
                document.getElementById('report-submitted').textContent = formatDate(reportData.submittedAt);
                document.getElementById('report-subject').textContent = reportData.subject;
                document.getElementById('report-description').textContent = reportData.description;
                document.getElementById('report-new-status').value = reportData.status;
                document.getElementById('report-response').value = '';

                document.getElementById('report-modal').style.display = 'block';
            } catch (error) {
                console.error('Review report error:', error);
                showAlert('Error loading report details: ' + error.message, 'error');
            }
        };

        window.respondToReport = async function() {
            if (!currentReportReview) return;
            
            const response = document.getElementById('report-response').value;
            const newStatus = document.getElementById('report-new-status').value;

            if (!response.trim()) {
                showAlert('Please provide a response', 'error');
                return;
            }

            try {
                await updateDoc(doc(db, 'reports', currentReportReview.id), {
                    status: newStatus,
                    adminResponse: response,
                    respondedBy: currentAdmin.uid,
                    respondedAt: serverTimestamp()
                });

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentReportReview.data.userId,
                    title: 'Support Ticket Update',
                    message: `Your support ticket "${currentReportReview.data.subject}" has been ${newStatus === 'resolved' ? 'resolved' : 'updated'}. Admin Response: ${response}`,
                    type: 'report-response',
                    read: false,
                    timestamp: serverTimestamp(),
                    reportId: currentReportReview.id
                });

                showAlert('Response sent successfully! User has been notified.', 'success');
                closeModal('report-modal');
                document.getElementById('report-response').value = '';
                loadReports();
                loadDashboardStats();
            } catch (error) {
                console.error('Respond to report error:', error);
                showAlert('Error sending response: ' + error.message, 'error');
            }
        };

        // Load Admin Users
        async function loadAdminUsers() {
            const tbody = document.getElementById('admins-tbody');
            tbody.innerHTML = '<tr><td colspan="5" class="loading">Loading admins...</td></tr>';

            try {
                const snapshot = await getDocs(collection(db, 'admins'));
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state">No admin users found</td></tr>';
                    return;
                }

                snapshot.forEach(docSnap => {
                    const admin = docSnap.data();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${admin.name}</td>
                        <td>${admin.email}</td>
                        <td><span class="admin-role-badge role-${admin.role}">${admin.role.toUpperCase()}</span></td>
                        <td>${formatDate(admin.createdAt)}</td>
                        <td>
                            ${(admin.role !== 'super' && admin.role !== 'main') || adminRole === 'super' ?
                                `<button class="action-btn btn-danger" onclick="window.removeAdmin('${docSnap.id}', '${admin.email}')">Remove</button>` :
                                '<span style="color: #718096;">Protected</span>'}
                        </td>
                    `;
                });
            } catch (error) {
                console.error('Admin users error:', error);
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: #e53e3e;">Error loading admin users: ${error.message}</td></tr>`;
            }
        }

        document.getElementById('add-admin-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('new-admin-name').value;
            const email = document.getElementById('new-admin-email').value;
            const role = document.getElementById('new-admin-role').value;
            const password = document.getElementById('new-admin-pass').value;

            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Adding...';

            try {
                const userCred = await createUserWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, 'admins', userCred.user.uid), {
                    name, 
                    email, 
                    role,
                    createdAt: serverTimestamp(),
                    createdBy: currentAdmin.uid
                });

                showAlert('Admin added successfully!', 'success');
                document.getElementById('add-admin-form').reset();
                loadAdminUsers();
                
                await signOut(auth);
            } catch (error) {
                console.error('Add admin error:', error);
                showAlert('Error adding admin: ' + error.message, 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Admin';
            }
        });

        window.removeAdmin = async function(id, email) {
            if (!confirm(`Are you sure you want to remove admin: ${email}?`)) return;

            try {
                await deleteDoc(doc(db, 'admins', id));
                showAlert('Admin removed successfully', 'info');
                loadAdminUsers();
            } catch (error) {
                console.error('Remove admin error:', error);
                showAlert('Error removing admin: ' + error.message, 'error');
            }
        };

        async function loadAdminActivity() {
            const container = document.getElementById('admin-activity-list');
            container.innerHTML = '<p class="loading">Loading admin activity...</p>';

            try {
                const q = query(collection(db, 'transactions'), where('reviewedBy', '!=', null), orderBy('reviewedBy'), orderBy('reviewedAt', 'desc'), limit(50));
                const snapshot = await getDocs(q);
                container.innerHTML = '';

                if (snapshot.empty) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë®‚Äçüíº</div><p>No admin activity found</p></div>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const adminDoc = await getDoc(doc(db, 'admins', trans.reviewedBy));
                    const adminData = adminDoc.exists() ? adminDoc.data() : { name: 'Unknown Admin' };

                    const card = document.createElement('div');
                    card.style.cssText = 'padding: 15px; background: #f7fafc; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid #667eea;';
                    card.innerHTML = `
                        <div style="font-weight: 600; color: #4a5568;">${adminData.name}</div>
                        <div style="font-size: 0.9rem; color: #718096; margin-top: 5px;">
                            ${trans.status === 'approved' ? 'Approved' : 'Rejected'} ${trans.type} of ${formatCurrency(trans.amount)}
                        </div>
                        <div style="font-size: 0.8rem; color: #a0aec0; margin-top: 5px;">${formatDate(trans.reviewedAt)}</div>
                    `;
                    container.appendChild(card);
                }
            } catch (error) {
                console.error('Admin activity error:', error);
                container.innerHTML = `<p style="text-align: center; color: #e53e3e;">Error loading admin activity: ${error.message}</p>`;
            }
        }

        async function loadUserAnalytics() {
            try {
                const users = await getDocs(collection(db, 'users'));
                let kycVerified = 0;
                let totalBalance = 0;

                users.forEach(doc => {
                    const user = doc.data();
                    if (user.kycStatus === 'approved') kycVerified++;
                    totalBalance += user.balance || 0;
                });

                const avgBalance = users.size > 0 ? totalBalance / users.size : 0;

                document.getElementById('active-users').textContent = users.size;
                document.getElementById('new-signups').textContent = Math.floor(users.size * 0.1);
                document.getElementById('kyc-verified').textContent = kycVerified;
                document.getElementById('avg-balance').textContent = formatCurrency(avgBalance);
            } catch (error) {
                console.error('User analytics error:', error);
                showAlert('Error loading user analytics', 'error');
            }
        }

        async function loadFinancialOverview() {
            try {
                const trans = await getDocs(collection(db, 'transactions'));
                let totalContrib = 0, totalWithdraw = 0, totalCommission = 0, pendingValue = 0;

                trans.forEach(doc => {
                    const t = doc.data();
                    if (t.type === 'contribution') {
                        if (t.status === 'approved') totalContrib += t.amount || 0;
                        else if (t.status === 'pending') pendingValue += t.amount || 0;
                    } else if (t.type === 'withdrawal') {
                        if (t.status === 'approved') {
                            totalWithdraw += t.amount || 0;
                            totalCommission += t.commission || 0;
                        } else if (t.status === 'pending') pendingValue += t.amount || 0;
                    }
                });

                document.getElementById('total-contrib').textContent = formatCurrency(totalContrib);
                document.getElementById('total-withdraw').textContent = formatCurrency(totalWithdraw);
                document.getElementById('total-commission').textContent = formatCurrency(totalCommission);
                document.getElementById('pending-value').textContent = formatCurrency(pendingValue);
            } catch (error) {
                console.error('Financial overview error:', error);
                showAlert('Error loading financial overview', 'error');
            }
        }

        // Filter handlers
        document.getElementById('kyc-filter').addEventListener('change', loadKYC);
        document.getElementById('trans-filter').addEventListener('change', loadTransactions);
        document.getElementById('trans-type-filter').addEventListener('change', loadTransactions);
        document.getElementById('report-status-filter').addEventListener('change', loadReports);
        document.getElementById('report-category-filter').addEventListener('change', loadReports);

        // Search functionality
        document.getElementById('user-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#users-tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Mobile menu
        document.getElementById('hamburger-btn').addEventListener('click', () => {
            document.getElementById('admin-sidebar').classList.add('mobile-open');
        });

        document.getElementById('close-sidebar-btn').addEventListener('click', closeMobileSidebar);

        function closeMobileSidebar() {
            document.getElementById('admin-sidebar').classList.remove('mobile-open');
        }

        // Modal functions
        window.closeModal = function(id) {
            document.getElementById(id).style.display = 'none';
            if (id === 'kyc-modal') currentKycReview = null;
            if (id === 'trans-modal') currentTransReview = null;
            if (id === 'report-modal') currentReportReview = null;
        };

        window.onclick = function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        };

        // Logout
        document.getElementById('logout-btn').addEventListener('click', async () => {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await signOut(auth);
                    showAlert('Logged out successfully', 'success', 'login-alert');
                } catch (error) {
                    console.error('Logout error:', error);
                    showAlert('Error logging out: ' + error.message, 'error');
                }
            }
        });

        // Auto-refresh pending badges every 30 seconds
        setInterval(() => {
            if (currentAdmin && document.getElementById('dashboard-page').style.display !== 'none') {
                updatePendingBadges();
            }
        }, 30000);

        async function updatePendingBadges() {
            try {
                const kycPending = await getDocs(query(collection(db, 'kyc_submissions'), where('status', '==', 'under_review')));
                const transPending = await getDocs(query(collection(db, 'transactions'), where('status', '==', 'pending')));
                const reportsPending = await getDocs(query(collection(db, 'reports'), where('status', '==', 'pending')));
                
                document.getElementById('kyc-badge').textContent = kycPending.size;
                document.getElementById('trans-badge').textContent = transPending.size;
                document.getElementById('reports-badge').textContent = reportsPending.size;
            } catch (error) {
                console.error('Error updating badges:', error);
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
        });
        // Load Announcements
async function loadAnnouncements() {
    const tbody = document.getElementById('announcements-tbody');
    tbody.innerHTML = '<tr><td colspan="7" class="loading">Loading announcements...</td></tr>';

    try {
        const q = query(collection(db, 'announcements'), orderBy('sentAt', 'desc'), limit(50));
        const snapshot = await getDocs(q);
        tbody.innerHTML = '';

        if (snapshot.empty) {
            tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No announcements sent yet</td></tr>';
            return;
        }

        for (const docSnap of snapshot.docs) {
            const announcement = docSnap.data();
            const adminDoc = await getDoc(doc(db, 'admins', announcement.sentBy));
            const adminData = adminDoc.exists() ? adminDoc.data() : { name: 'Unknown Admin' };

            const priorityColors = {
                info: 'background: #bee3f8; color: #2a4365;',
                warning: 'background: #fef5e7; color: #744210;',
                urgent: 'background: #fed7d7; color: #742a2a;'
            };

            const categoryColors = {
                updates: 'background: #c6f6d5; color: #22543d;',
                maintenance: 'background: #fef5e7; color: #744210;',
                'new-features': 'background: #e9d8fd; color: #44337a;',
                promotions: 'background: #fef5e7; color: #c05621;',
                alerts: 'background: #fed7d7; color: #742a2a;'
            };

            const messagePreview = announcement.message.length > 60 
                ? announcement.message.substring(0, 60) + '...' 
                : announcement.message;

            const row = tbody.insertRow();
            row.innerHTML = `
                <td style="font-weight: 600;">${announcement.title}</td>
                <td>${messagePreview}</td>
                <td><span class="status-badge" style="${categoryColors[announcement.category] || categoryColors.updates}">${(announcement.category || 'updates').replace('-', ' ').toUpperCase()}</span></td>
                <td><span class="status-badge" style="${priorityColors[announcement.priority]}">${announcement.priority.toUpperCase()}</span></td>
                <td>${adminData.name}</td>
                <td>${formatDate(announcement.sentAt)}</td>
                <td style="text-align: center;">${announcement.recipientCount || 0}</td>
            `;
        }
    } catch (error) {
        console.error('Announcements error:', error);
        tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: #e53e3e;">Error loading announcements: ${error.message}</td></tr>`;
    }
}
// Process contribution approval and update VIP
async function processContributionApproval(transactionId, userId, amount) {
    /* 
    THIS IS ADMIN BACKEND CODE - For reference
    
    When admin approves a contribution:
    1. Update transaction status to 'approved'
    2. Add amount to user's totalContributions
    3. Update user's balance
    4. Check for VIP promotion
    */
    
    try {
        // Update transaction
        await updateDoc(doc(db, 'transactions', transactionId), {
            status: 'approved',
            approvedAt: serverTimestamp()
        });
        
        // Get user data
        const userRef = doc(db, 'users', userId);
        const userDoc = await getDoc(userRef);
        const user = userDoc.data();
        
        // Calculate new totals
        const newTotalContributions = (user.totalContributions || 0) + amount;
        const newBalance = (user.balance || 0) + amount;
        
        // Update user data
        await updateDoc(userRef, {
            totalContributions: newTotalContributions,
            balance: newBalance
        });
        
        // Check for VIP promotion
        const currentLevel = user.vipLevel;
        const newLevel = calculateVIPLevel(newTotalContributions, user.kycStatus);
        
        if (newLevel > currentLevel) {
            await updateDoc(userRef, {
                vipLevel: newLevel
            });
            
            // Send promotion notification
            await addDoc(collection(db, 'notifications'), {
                userId: userId,
                title: 'üéâ VIP Level Up!',
                message: `Congratulations! You've been promoted to ${getVIPBenefits(newLevel).name}!`,
                type: 'vip_promotion',
                read: false,
                timestamp: serverTimestamp()
            });
        }
        
        console.log('‚úÖ Contribution approved and VIP checked');
        
    } catch (error) {
        console.error('‚ùå Error processing contribution:', error);
    }
}
// Send Announcement - IMPROVED VERSION
const announcementForm = document.getElementById('announcement-form');
if (announcementForm) {
    announcementForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const title = document.getElementById('announcement-title').value;
        const message = document.getElementById('announcement-message').value;
        const category = document.getElementById('announcement-category').value;
        const priority = document.getElementById('announcement-priority').value;
        const statusSpan = document.getElementById('announcement-status');
        const submitBtn = announcementForm.querySelector('button[type="submit"]');

        if (!confirm(`Send this announcement to ALL users?\n\nTitle: ${title}\nCategory: ${category.toUpperCase()}\n\nThis action cannot be undone.`)) {
            return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        statusSpan.textContent = 'Fetching users...';
        statusSpan.style.color = '#667eea';

        try {
            // Get all users
            const usersSnapshot = await getDocs(collection(db, 'users'));
            const userCount = usersSnapshot.size;

            if (userCount === 0) {
                showAlert('No users found to send announcement to', 'info');
                return;
            }

            statusSpan.textContent = `Preparing to send to ${userCount} users...`;

            // Save announcement record FIRST
            try {
                const announcementRef = doc(collection(db, 'announcements'));
                await setDoc(announcementRef, {
                    title,
                    message,
                    category, // ‚úÖ NEW: Store category
                    priority,
                    sentBy: currentAdmin.uid,
                    sentAt: serverTimestamp(),
                    recipientCount: userCount
                });
                console.log('‚úÖ Announcement record saved');
            } catch (announceError) {
                console.error('‚ùå Error saving announcement:', announceError);
                showAlert('Error saving announcement record: ' + announceError.message, 'error');
                return;
            }

            // Send notifications one by one with error handling
            let sentCount = 0;
            let failedCount = 0;
            
            statusSpan.textContent = `Sending to ${userCount} users...`;
            
            for (const userDoc of usersSnapshot.docs) {
                try {
                    const notificationRef = doc(collection(db, 'notifications'));
                    await setDoc(notificationRef, {
                        userId: userDoc.id,
                        title: `üì¢ ${title}`,
                        message: message,
                        type: 'announcement',
                        category: category, // ‚úÖ NEW: Include category
                        priority: priority,
                        read: false,
                        timestamp: serverTimestamp()
                    });
                    
                    sentCount++;
                    
                    // Update status every 5 users
                    if (sentCount % 5 === 0) {
                        statusSpan.textContent = `Sent to ${sentCount}/${userCount} users...`;
                    }
                    
                    // Small delay to avoid rate limits
                    if (sentCount % 10 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 200));
                    }
                    
                } catch (notifError) {
                    console.error(`Failed to send to user ${userDoc.id}:`, notifError);
                    failedCount++;
                }
            }

            // Show results
            if (sentCount > 0) {
                showAlert(`‚úÖ Announcement sent to ${sentCount} users${failedCount > 0 ? ` (${failedCount} failed)` : ''}!`, 'success');
                statusSpan.textContent = `‚úì Sent to ${sentCount} users${failedCount > 0 ? ` (${failedCount} failed)` : ''}`;
                statusSpan.style.color = '#48bb78';
            } else {
                showAlert('‚ùå Failed to send announcement to any users', 'error');
                statusSpan.textContent = '‚úó Failed to send';
                statusSpan.style.color = '#e53e3e';
            }
            
            announcementForm.reset();
            loadAnnouncements();

            setTimeout(() => {
                statusSpan.textContent = '';
            }, 5000);

        } catch (error) {
            console.error('Send announcement error:', error);
            showAlert('Error sending announcement: ' + error.message, 'error');
            statusSpan.textContent = '‚úó Failed: ' + error.message;
            statusSpan.style.color = '#e53e3e';
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Send to All Users';
        }
    });
}

        console.log('SusuPay Admin Dashboard initialized');
    </script>
</body>
</html>
