<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SusuPay Admin Dashboard</title>
     <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #271dad 0%, #053f05 100%);
            min-height: 100vh;
            color: #333;
        }
/* ============================================
           PROFESSIONAL LOADER STYLES - COPY THESE
           ============================================ */

        /* Full Page Loader */
        .page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
            transition: opacity 0.5s ease;
        }

        .loader-content {
            text-align: center;
            color: white;
        }

        /* Spinning Ring Loader */
        .spinner-ring {
            display: inline-block;
            width: 80px;
            height: 80px;
            position: relative;
        }

        .spinner-ring div {
            box-sizing: border-box;
            display: block;
            position: absolute;
            width: 64px;
            height: 64px;
            margin: 8px;
            border: 6px solid #fff;
            border-radius: 50%;
            animation: spinner-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
            border-color: #fff transparent transparent transparent;
        }

        .spinner-ring div:nth-child(1) {
            animation-delay: -0.45s;
        }

        .spinner-ring div:nth-child(2) {
            animation-delay: -0.3s;
        }

        .spinner-ring div:nth-child(3) {
            animation-delay: -0.15s;
        }

        @keyframes spinner-ring {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .loader-logo {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s ease-in-out infinite;
        }

        .loader-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-top: 25px;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .loader-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px auto 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #fff 0%, #ffd700 50%, #fff 100%);
            background-size: 200% 100%;
            animation: progress-slide 2s ease-in-out infinite;
            border-radius: 10px;
        }

        @keyframes progress-slide {
            0% {
                width: 20%;
                background-position: 0% 50%;
            }
            50% {
                width: 60%;
                background-position: 100% 50%;
            }
            100% {
                width: 100%;
                background-position: 0% 50%;
            }
        }

        /* Dots Loader */
        .dots-loader {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .dot {
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            animation: dot-bounce 1.4s ease-in-out infinite;
        }

        .dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes dot-bounce {
            0%, 80%, 100% {
                transform: scale(0.6);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Mini Loader for buttons/cards */
        .mini-loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Skeleton Loader for tables */
        .skeleton-row {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            height: 60px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        @keyframes skeleton-loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        /* ============================================
   MODAL STYLES - ADD THIS SECTION
   ============================================ */

/* Modal Overlay */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 10001;
    overflow-y: auto;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Modal Content Box */
.modal-content {
    position: relative;
    background: white;
    margin: 50px auto;
    padding: 40px;
    border-radius: 20px;
    max-width: 900px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Modal Header */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f7fafc;
}

.modal-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: #4a5568;
}

/* Close Button */
.close-modal-btn {
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: #718096;
    transition: all 0.3s ease;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.close-modal-btn:hover {
    background: #f7fafc;
    color: #4a5568;
    transform: rotate(90deg);
}

/* Details Grid */
.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.detail-card {
    background: #f7fafc;
    padding: 20px;
    border-radius: 12px;
    border-left: 4px solid #667eea;
}

.detail-label {
    font-size: 0.85rem;
    color: #718096;
    font-weight: 600;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.detail-value {
    font-size: 1.1rem;
    font-weight: 600;
    color: #4a5568;
    word-break: break-word;
}

/* Modal Sections */
.modal-section {
    margin-bottom: 30px;
}

.modal-section-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #4a5568;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Progress Bar in Modal */
.progress-container {
    width: 100%;
    background: #e2e8f0;
    height: 30px;
    border-radius: 15px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 0.9rem;
}

/* Status Badges for Modal */
.status-active {
    background: #c6f6d5;
    color: #22543d;
}

.status-matured {
    background: #fef5e7;
    color: #744210;
}

.status-withdrawn {
    background: #e6fffa;
    color: #234e52;
}

.status-verified {
    background: #c6f6d5;
    color: #22543d;
}

/* ============================================
   END OF MODAL STYLES
   ============================================ */

        /* Super Admin Loader Theme */
        .super-admin-loader {
            background: linear-gradient(135deg, rgba(45, 55, 72, 0.98) 0%, rgba(26, 32, 44, 0.98) 100%);
        }

        .super-admin-loader .spinner-ring div {
            border-color: #ffd700 transparent transparent transparent;
        }

        .super-admin-loader .progress-bar {
            background: linear-gradient(90deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
        }

        .super-admin-loader .dot {
            background: #ffd700;
        }

        /* ============================================
           END OF LOADER STYLES
           ============================================ */

        /* Login Page */
        .login-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
        }

        .admin-logo {
            text-align: center;
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .login-title {
            color: #4a5568;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .login-subtitle {
            color: #718096;
            margin-bottom: 40px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Dashboard Layout */
        .dashboard-page {
            display: none;
        }

        .admin-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(135, 194, 202, 0.98);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .admin-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #eefff9;
        }

        .admin-role-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .role-super {
            background: linear-gradient(135deg, #1ba827 0%, #19547b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 255, 42, 0.767);
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        .admin-main {
            margin-top: 70px;
            padding: 30px;
            min-height: calc(100vh - 70px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #667eea;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #4a5568;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            color: #4a5568;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .alert-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .hidden {
            display: none !important;
        }
        /* Login Page */
        .login-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
        }

        .admin-logo {
            text-align: center;
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .login-title {
            color: #4a5568;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .login-subtitle {
            color: #718096;
            margin-bottom: 40px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Dashboard Layout */
        .dashboard-page {
            display: none;
        }

        .admin-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(135, 194, 202, 0.98);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .hamburger-btn {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .hamburger-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .hamburger-btn svg {
            width: 24px;
            height: 24px;
            stroke: #000000;
        }

        .admin-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #eefff9;
        }

        .admin-role-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .role-super {
            background: linear-gradient(135deg, #1ba827 0%, #19547b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 255, 42, 0.767);
        }

        .role-main {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .role-senior {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .role-financial {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .role-support {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .role-security {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .role-operations {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #4a5568;
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .logout-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        /* Sidebar */
        .admin-sidebar {
            position: fixed;
            left: 0;
            top: 70px;
            bottom: 0;
            width: 280px;
            background: linear-gradient(135deg, #1c1949 0%, #3c0ea7 100%);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 900;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            display: none;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
            justify-content: space-between;
        }

        .close-sidebar-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .close-sidebar-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .close-sidebar-btn svg {
            width: 24px;
            height: 24px;
            stroke: #ffffff;
        }

        .sidebar-section {
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-section-title {
            padding: 10px 25px;
            font-size: 0.75rem;
            font-weight: 700;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sidebar-nav-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            color: #e2e8f0;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-weight: 500;
        }

        .sidebar-nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: #667eea;
            color: #ffffff;
        }

        .sidebar-nav-item.active {
            background: rgba(102, 126, 234, 0.2);
            border-left-color: #667eea;
            color: #ffffff;
        }

        .nav-icon {
            font-size: 1.3rem;
        }

        .pending-badge {
            margin-left: auto;
            background: #e53e3e;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        /* Super Admin Theme */
        .super-admin-sidebar {
            background: linear-gradient(180deg, #2d3748 0%, #1a202c 100%);
        }

        .super-admin-sidebar .sidebar-section-title {
            color: #ffd700;
        }

        .super-admin-sidebar .sidebar-nav-item {
            color: #e2e8f0;
        }

        .super-admin-sidebar .sidebar-nav-item:hover {
            background: rgba(255, 215, 0, 0.1);
            border-left-color: #ffd700;
            color: #ffd700;
        }

        .super-admin-sidebar .sidebar-nav-item.active {
            background: rgba(255, 215, 0, 0.2);
            border-left-color: #ffd700;
            color: #ffd700;
        }

        .super-admin-header {
            background: linear-gradient(135deg, #2d1b69 0%, #11998e 100%);
        }

        /* Main Content */
        .admin-main {
            margin-left: 280px;
            margin-top: 70px;
            padding: 30px;
            min-height: calc(100vh - 70px);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #667eea;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #4a5568;
        }

        .stat-change {
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .stat-change.positive {
            color: #48bb78;
        }

        /* Content Card */
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f7fafc;
            flex-wrap: wrap;
            gap: 15px;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a5568;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-select, .search-input {
            padding: 8px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #4a5568;
            background: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus, .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: #f7fafc;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f7fafc;
            color: #4a5568;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: #fef5e7;
            color: #744210;
        }

        .status-approved {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-rejected {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-under-review, .status-under_review {
            background: #bee3f8;
            color: #2a4365;
        }

        .status-in-progress {
            background: #e9d8fd;
            color: #44337a;
        }

        .status-resolved {
            background: #c6f6d5;
            color: #22543d;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 5px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-view {
            background: #ebf8ff;
            color: #2b6cb0;
        }

        .btn-approve {
            background: #c6f6d5;
            color: #22543d;
        }

        .btn-reject {
            background: #fed7d7;
            color: #742a2a;
        }

        .btn-danger {
            background: #fed7d7;
            color: #742a2a;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            color: #4a5568;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #4a5568;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 20px;
        }

        .document-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .document-preview img {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .document-preview img:hover {
            transform: scale(1.05);
        }

        .user-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .detail-item {
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .detail-label {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .detail-value {
            font-size: 1rem;
            font-weight: 600;
            color: #4a5568;
            word-break: break-word;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .alert-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .alert-info {
            background: #bee3f8;
            color: #2a4365;
        }

        .hidden {
            display: none !important;
        }

        /* Activity Timeline */
        .activity-timeline {
            position: relative;
            padding-left: 30px;
        }

        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e2e8f0;
        }

        .activity-item {
            position: relative;
            margin-bottom: 25px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 3px solid #667eea;
        }

        .activity-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #718096;
            margin-bottom: 5px;
        }

        .activity-description {
            color: #4a5568;
            font-weight: 500;
        }

        .activity-user {
            color: #667eea;
            font-weight: 600;
        }

        /* Loading State */
        .loading {
            text-align: center;
            color: #718096;
            padding: 40px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            color: #718096;
            padding: 60px 20px;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hamburger-btn {
                display: block;
            }

            .admin-sidebar {
                transform: translateX(-100%);
            }

            .admin-sidebar.mobile-open {
                transform: translateX(0);
            }

            .sidebar-header {
                display: flex;
            }

            .admin-main {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .user-details-grid {
                grid-template-columns: 1fr;
            }

            .user-info {
                display: none;
            }

            .login-container {
                padding: 30px 20px;
            }

            .modal-content {
                width: 95%;
                padding: 30px 20px;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-group {
                width: 100%;
            }

            .filter-select, .search-input {
                width: 100%;
            }

            .data-table {
                font-size: 0.85rem;
            }

            .data-table th,
            .data-table td {
                padding: 10px 8px;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
    </style>
</head>
<body>
      <!-- ============================================
         FULL PAGE LOADER - COPY THIS SECTION
         ============================================ -->
    <div class="page-loader" id="page-loader">
        <div class="loader-content">
            <div class="loader-logo">🛡️</div>
            <div class="spinner-ring">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="loader-title" id="loader-title">Loading Admin Portal</div>
            <div class="loader-subtitle" id="loader-subtitle">Initializing secure connection...</div>
            <div class="progress-bar-container">
                <div class="progress-bar"></div>
            </div>
            <div class="dots-loader">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>
    <!-- ============================================
         END OF LOADER SECTION
         ============================================ -->
    <!-- Login Page -->
    <div class="login-page" id="login-page">
        <div class="login-container">
            <div class="admin-logo">🛡️</div>
            <h1 class="login-title">Admin Portal</h1>
            <p class="login-subtitle">SusuPay Management System</p>

            <div id="login-alert"></div>

            <form id="admin-login-form">
                <div class="form-group">
                    <label for="admin-role">Admin Role</label>
                    <select id="admin-role" required>
                        <option value="">Select your role...</option>
                        <option value="super">👑 Super Admin</option>
                        <option value="main">Main Admin</option>
                        <option value="senior">Senior Admin</option>
                        <option value="financial">Financial Admin</option>
                        <option value="support">Support Admin</option>
                        <option value="security">Security Admin</option>
                        <option value="operations">Operations Admin</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="admin-email">Email Address</label>
                    <input type="email" id="admin-email" required placeholder="admin@susupay.com">
                </div>

                <div class="form-group">
                    <label for="admin-password">Password</label>
                    <input type="password" id="admin-password" required placeholder="Enter your password">
                </div>

                <button type="submit" class="btn" style="width: 100%;">
                    Sign In to Admin Portal
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div class="dashboard-page" id="dashboard-page">
        <!-- Header -->
        <header class="admin-header" id="admin-header">
            <div class="header-left">
                <button class="hamburger-btn" id="hamburger-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="admin-brand">
                    <span>🛡️</span>
                    <span style="color: white;">SusuPay Admin</span>
                    <span class="admin-role-badge" id="role-badge"></span>
                </div>
            </div>
            <div class="header-user">
                <div class="user-info">
                    <div id="admin-name" style="font-weight: 600; color: #ffffff;"></div>
                    <div id="admin-email-display" style="font-size: 0.8rem; color: #05f711;"></div>
                </div>
               <div id="user-avatar" style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.1rem;">A</div>
                <button class="logout-btn" id="logout-btn">Logout</button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="admin-sidebar" id="admin-sidebar">
            <div class="sidebar-header">
                <span style="font-weight: 600; color: #ffffff;">Menu</span>
                <button class="close-sidebar-btn" id="close-sidebar-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="sidebar-section" id="super-section" style="display: none;">
                <div class="sidebar-section-title">Super Admin</div>
                <div class="sidebar-nav-item" data-page="super-dashboard">
                    <span class="nav-icon">👑</span>
                    <span>Super Dashboard</span>
                </div>
                <div class="sidebar-nav-item" data-page="admin-activity">
                    <span class="nav-icon">👨‍💼</span>
                    <span>Admin Activity</span>
                </div>
                <div class="sidebar-nav-item" data-page="user-analytics">
                    <span class="nav-icon">📊</span>
                    <span>User Analytics</span>
                </div>
                <div class="sidebar-nav-item" data-page="future-projects">
    <span class="nav-icon">🎯</span>
    <span>Future Projects</span>
</div>
                <div class="sidebar-nav-item" data-page="financial-overview">
                    <span class="nav-icon">💎</span>
                    <span>Financial Overview</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Main</div>
                <div class="sidebar-nav-item active" data-page="dashboard">
                    <span class="nav-icon">📊</span>
                    <span>Dashboard</span>
                </div>
                <div class="sidebar-nav-item" data-page="users">
                    <span class="nav-icon">👥</span>
                    <span>Users</span>
                </div>
            </div>
            <div class="sidebar-nav-item" data-page="announcements">
    <span class="nav-icon">📢</span>
    <span>Announcements</span>
</div>

            <div class="sidebar-section" id="kyc-section">
                <div class="sidebar-section-title">Verification</div>
                <div class="sidebar-nav-item" data-page="kyc">
                    <span class="nav-icon">🛡️</span>
                    <span>KYC</span>
                    <span class="pending-badge" id="kyc-badge">0</span>
                </div>
            </div>

            <div class="sidebar-section" id="financial-section">
                <div class="sidebar-section-title">Financial</div>
                <div class="sidebar-nav-item" data-page="transactions">
                    <span class="nav-icon">💳</span>
                    <span>Transactions</span>
                    <span class="pending-badge" id="trans-badge">0</span>
                </div>
            </div>

            <div class="sidebar-section" id="support-section">
                <div class="sidebar-section-title">Support</div>
                <div class="sidebar-nav-item" data-page="reports">
                    <span class="nav-icon">📋</span>
                    <span>User Reports</span>
                    <span class="pending-badge" id="reports-badge">0</span>
                </div>
            </div>

        <div class="sidebar-section" id="security-section">
    <div class="sidebar-section-title">Security</div>
    <div class="sidebar-nav-item" data-page="security-logs">
        <span class="nav-icon">🔒</span>
        <span>Security Logs</span>
    </div>
    <div class="sidebar-nav-item" data-page="suspicious">
        <span class="nav-icon">⚠️</span>
        <span>Suspicious Activity</span>
    </div>
</div>

<div class="sidebar-section" id="admin-section">
    <div class="sidebar-section-title">Administration</div>
    <div class="sidebar-nav-item" data-page="admin-users">
        <span class="nav-icon">👨‍💼</span>
        <span>Admin Users</span>
    </div>
    <div class="sidebar-nav-item" data-page="settings">
        <span class="nav-icon">⚙️</span>
        <span>System Settings</span>
    </div>
</div>
        </aside>
        <!-- Main Content -->
        <main class="admin-main" id="admin-main">
            <div id="dashboard-alert"></div>

            <!-- Dashboard Page -->
            <div id="dashboard-content" class="page-content">
                <h2 style="margin-bottom: 25px; color: white;">Dashboard Overview</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Users</div>
                        <div class="stat-value" id="stat-users">0</div>
                        <div class="stat-change positive">+12% this month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Transactions</div>
                        <div class="stat-value" id="stat-trans">0</div>
                        <div class="stat-change positive">+8% this month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending KYC</div>
                        <div class="stat-value" id="stat-kyc">0</div>
                        <div class="stat-change">Requires attention</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="stat-revenue">₵0</div>
                        <div class="stat-change positive">+15% this month</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                    </div>
                    <div class="activity-timeline" id="recent-activity">
                        <p class="loading">Loading activity...</p>
                    </div>
                </div>
            </div>

            <!-- Super Dashboard -->
            <div id="super-dashboard-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">👑 Super Admin Dashboard</h2>
                
                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">Total Users</div>
                        <div class="stat-value" style="color: white;" id="super-users">0</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">Registered</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; border: none;">
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">All-Time Revenue</div>
                        <div class="stat-value" style="color: white;" id="super-revenue">₵0</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">Total Earnings</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none;">
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">Active Admins</div>
                        <div class="stat-value" style="color: white;" id="super-admins">0</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">Personnel</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; border: none;">
                        <div class="stat-label" style="color: rgba(255,255,255,0.9);">System Health</div>
                        <div class="stat-value" style="color: white;">98%</div>
                        <div class="stat-change" style="color: rgba(255,255,255,0.8);">Operational</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Real-Time Activity</h3>
                    </div>
                    <div class="activity-timeline" id="super-activity">
                        <p class="loading">Loading activity...</p>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="users-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">User Management</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">All Users</h3>
                        <input type="text" class="search-input" id="user-search" placeholder="Search users...">
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Balance</th>
                                    <th>KYC Status</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody">
                                <tr><td colspan="6" class="loading">Loading users...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- KYC Page -->
            <div id="kyc-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">KYC Verification</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Pending Verifications</h3>
                        <select class="filter-select" id="kyc-filter">
                            <option value="under_review">Under Review</option>
                            <option value="all">All</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>ID Type</th>
                                    <th>Submitted</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="kyc-tbody">
                                <tr><td colspan="5" class="loading">Loading KYC submissions...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Transactions Page -->
            <div id="transactions-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">Transaction Management</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">All Transactions</h3>
                        <div class="filter-group">
                            <select class="filter-select" id="trans-filter">
                                <option value="pending">Pending</option>
                                <option value="all">All</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <select class="filter-select" id="trans-type-filter">
                                <option value="all">All Types</option>
                                <option value="contribution">Contributions</option>
                                <option value="withdrawal">Withdrawals</option>
                            </select>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="trans-tbody">
                                <tr><td colspan="7" class="loading">Loading transactions...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">User Reports</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Support Tickets</h3>
                        <div class="filter-group">
                            <select class="filter-select" id="report-status-filter">
                                <option value="pending">Pending</option>
                                <option value="in-progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                                <option value="all">All</option>
                            </select>
                            <select class="filter-select" id="report-category-filter">
                                <option value="all">All Categories</option>
                                <option value="contribution-issues">Contribution Issues</option>
                                <option value="withdrawal-problems">Withdrawal Problems</option>
                                <option value="kyc-verification">KYC Verification</option>
                                <option value="payment-method-issues">Payment Method Issues</option>
                                <option value="account-access">Account Access</option>
                                <option value="security-concerns">Security Concerns</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Category</th>
                                    <th>Subject</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                    <th>Submitted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reports-tbody">
                                <tr><td colspan="7" class="loading">Loading reports...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin Users Page -->
            <div id="admin-users-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">Admin User Management</h2>
                
                <div class="content-card" style="margin-bottom: 20px;">
                    <div class="card-header">
                        <h3 class="card-title">Add New Admin</h3>
                    </div>
                    <form id="add-admin-form">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="new-admin-name" required placeholder="Full name">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="new-admin-email" required placeholder="admin@susupay.com">
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select id="new-admin-role" required>
                                    <option value="">Select role...</option>
                                    <option value="senior">Senior Admin</option>
                                    <option value="financial">Financial Admin</option>
                                    <option value="support">Support Admin</option>
                                    <option value="security">Security Admin</option>
                                    <option value="operations">Operations Admin</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="new-admin-pass" required minlength="8" placeholder="Min. 8 characters">
                            </div>
                        </div>
                        <button type="submit" class="btn">Add Admin</button>
                    </form>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Current Admins</h3>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Added</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admins-tbody">
                                <tr><td colspan="5" class="loading">Loading admins...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Admin Activity Page -->
            <div id="admin-activity-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: white;">Admin Activity Log</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Admin Actions</h3>
                    </div>
                    <div id="admin-activity-list">
                        <p class="loading">Loading admin activity...</p>
                    </div>
                </div>
            </div>

           <!-- User Analytics Page -->
<div id="user-analytics-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">📊 User Analytics</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Total Users</div>
            <div class="stat-value" id="analytics-total-users">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Active Users (30d)</div>
            <div class="stat-value" id="active-users">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">New Signups (7d)</div>
            <div class="stat-value" id="new-signups">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">KYC Verified</div>
            <div class="stat-value" id="kyc-verified">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Average Balance</div>
            <div class="stat-value" id="avg-balance">₵0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Total Balance Pool</div>
            <div class="stat-value" id="total-balance-pool">₵0</div>
        </div>
    </div>

    <!-- User Growth Chart -->
    <div class="content-card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">📈 User Growth Trend</h3>
            <div class="filter-group">
                <select class="filter-select" id="analytics-period-filter" onchange="loadUserAnalytics()">
                    <option value="6">Last 6 Months</option>
                    <option value="12">Last 12 Months</option>
                    <option value="3">Last 3 Months</option>
                </select>
                <button class="action-btn btn-view" onclick="loadUserAnalytics()" style="padding: 8px 16px;">
                    🔄 Refresh
                </button>
            </div>
        </div>
        
        <div style="position: relative; height: 400px; margin-bottom: 30px;">
            <canvas id="user-growth-chart"></canvas>
            <div id="analytics-chart-error" style="display: none; text-align: center; color: #e53e3e; padding: 20px;"></div>
        </div>

        <!-- Growth Stats -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
            <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #48bb78;">
                <div style="font-size: 0.85rem; color: #718096; margin-bottom: 5px;">👥 Total Signups</div>
                <div style="font-size: 1.3rem; font-weight: 700; color: #48bb78;" id="chart-total-signups">0</div>
            </div>
            <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">
                <div style="font-size: 0.85rem; color: #718096; margin-bottom: 5px;">📊 Average per Month</div>
                <div style="font-size: 1.3rem; font-weight: 700; color: #667eea;" id="chart-avg-signups">0</div>
            </div>
            <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #ed8936;">
                <div style="font-size: 0.85rem; color: #718096; margin-bottom: 5px;">🚀 Best Month</div>
                <div style="font-size: 1.3rem; font-weight: 700; color: #ed8936;" id="chart-best-signup-month">N/A</div>
            </div>
            <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #f56565;">
                <div style="font-size: 0.85rem; color: #718096; margin-bottom: 5px;">📈 Growth Rate</div>
                <div style="font-size: 1.3rem; font-weight: 700; color: #f56565;" id="chart-growth-rate">0%</div>
            </div>
        </div>
    </div>

    <!-- VIP Distribution Chart -->
    <div class="content-card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">👑 VIP Level Distribution</h3>
        </div>
        
        <div style="position: relative; height: 350px;">
            <canvas id="vip-distribution-chart"></canvas>
        </div>

        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 20px;">
            <div style="text-align: center; padding: 15px; background: #f7fafc; border-radius: 10px;">
                <div style="font-size: 1.5rem;">🌱</div>
                <div style="font-size: 0.8rem; color: #718096; margin-top: 5px;">Starter</div>
                <div style="font-size: 1.2rem; font-weight: 700; color: #4a5568;" id="vip-level-1">0</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #f7fafc; border-radius: 10px;">
                <div style="font-size: 1.5rem;">🥉</div>
                <div style="font-size: 0.8rem; color: #718096; margin-top: 5px;">Bronze</div>
                <div style="font-size: 1.2rem; font-weight: 700; color: #4a5568;" id="vip-level-2">0</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #f7fafc; border-radius: 10px;">
                <div style="font-size: 1.5rem;">🥈</div>
                <div style="font-size: 0.8rem; color: #718096; margin-top: 5px;">Silver</div>
                <div style="font-size: 1.2rem; font-weight: 700; color: #4a5568;" id="vip-level-3">0</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #f7fafc; border-radius: 10px;">
                <div style="font-size: 1.5rem;">🥇</div>
                <div style="font-size: 0.8rem; color: #718096; margin-top: 5px;">Gold</div>
                <div style="font-size: 1.2rem; font-weight: 700; color: #4a5568;" id="vip-level-4">0</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #f7fafc; border-radius: 10px;">
                <div style="font-size: 1.5rem;">💎</div>
                <div style="font-size: 0.8rem; color: #718096; margin-top: 5px;">Platinum</div>
                <div style="font-size: 1.2rem; font-weight: 700; color: #4a5568;" id="vip-level-5">0</div>
            </div>
        </div>
    </div>

    <!-- KYC Status Chart -->
    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">🛡️ KYC Verification Status</h3>
        </div>
        
        <div style="position: relative; height: 300px;">
            <canvas id="kyc-status-chart"></canvas>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px;">
            <div style="text-align: center; padding: 15px; background: #c6f6d5; border-radius: 10px;">
                <div style="font-size: 0.8rem; color: #22543d; margin-bottom: 5px;">✅ Approved</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #22543d;" id="kyc-approved-count">0</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #bee3f8; border-radius: 10px;">
                <div style="font-size: 0.8rem; color: #2a4365; margin-bottom: 5px;">⏳ Under Review</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #2a4365;" id="kyc-pending-count">0</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #fed7d7; border-radius: 10px;">
                <div style="font-size: 0.8rem; color: #742a2a; margin-bottom: 5px;">❌ Rejected</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #742a2a;" id="kyc-rejected-count">0</div>
            </div>
            <div style="text-align: center; padding: 15px; background: #fef5e7; border-radius: 10px;">
                <div style="font-size: 0.8rem; color: #744210; margin-bottom: 5px;">⚪ Not Submitted</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #744210;" id="kyc-none-count">0</div>
            </div>
        </div>
    </div>
</div>
         <!-- Financial Overview Page -->
<div id="financial-overview-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">Financial Overview</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Total Contributions</div>
            <div class="stat-value" id="total-contrib">₵0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Total Withdrawals</div>
            <div class="stat-value" id="total-withdraw">₵0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Commission Earned</div>
            <div class="stat-value" id="total-commission">₵0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Pending Value</div>
            <div class="stat-value" id="pending-value">₵0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Investments</div>
            <div class="stat-value" id="investments-value">₵0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Return On Investments (ROI)</div>
            <div class="stat-value" id="roi-value">₵0</div>
        </div>
    </div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">📈 Financial Trends (Last 6 Months)</h3>
            <div class="filter-group">
                <button class="action-btn btn-view" onclick="loadFinancialChart()" style="padding: 8px 16px;">
                    🔄 Refresh Chart
                </button>
            </div>
        </div>
        
        <!-- Chart Container -->
        <div style="position: relative; height: 400px; margin-bottom: 30px;">
            <canvas id="financial-chart"></canvas>
            <div id="chart-error" style="display: none; text-align: center; color: #e53e3e; padding: 20px;"></div>
        </div>
        
        <!-- Chart Legend Details -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
            <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #48bb78;">
                <div style="font-size: 0.85rem; color: #718096; margin-bottom: 5px;">💚 Total Contributions</div>
                <div style="font-size: 1.3rem; font-weight: 700; color: #48bb78;" id="chart-total-contrib">₵0</div>
            </div>
            <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #f56565;">
                <div style="font-size: 0.85rem; color: #718096; margin-bottom: 5px;">💸 Total Withdrawals</div>
                <div style="font-size: 1.3rem; font-weight: 700; color: #f56565;" id="chart-total-withdraw">₵0</div>
            </div>
            <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #ed8936;">
                <div style="font-size: 0.85rem; color: #718096; margin-bottom: 5px;">💰 Total Commission</div>
                <div style="font-size: 1.3rem; font-weight: 700; color: #ed8936;" id="chart-total-commission">₵0</div>
            </div>
            <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">
                <div style="font-size: 0.85rem; color: #718096; margin-bottom: 5px;">📊 Net Cash Flow</div>
                <div style="font-size: 1.3rem; font-weight: 700; color: #667eea;" id="chart-net-flow">₵0</div>
            </div>
        </div>
        
        <!-- Additional Insights -->
        <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
            <h4 style="margin-bottom: 15px; font-size: 1.1rem;">📊 Quick Insights</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">Average Monthly Contribution</div>
                    <div style="font-size: 1.2rem; font-weight: 700;" id="avg-monthly-contrib">₵0</div>
                </div>
                <div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">Best Month</div>
                    <div style="font-size: 1.2rem; font-weight: 700;" id="best-month">N/A</div>
                </div>
                <div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">Growth Rate</div>
                    <div style="font-size: 1.2rem; font-weight: 700;" id="growth-rate">0%</div>
                </div>
                <div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">Commission Rate</div>
                    <div style="font-size: 1.2rem; font-weight: 700;" id="commission-rate">0%</div>
                </div>
            </div>
        </div>
    </div>
</div>

            <!-- Security Logs Page -->
<div id="security-logs-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">🔒 Security Logs</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Total Login Attempts (24h)</div>
            <div class="stat-value" id="total-logins">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Failed Logins (24h)</div>
            <div class="stat-value" id="failed-logins">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Active Sessions</div>
            <div class="stat-value" id="active-sessions">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Blocked IPs</div>
            <div class="stat-value" id="blocked-ips">0</div>
        </div>
    </div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">Recent Security Events</h3>
            <select class="filter-select" id="security-filter">
                <option value="all">All Events</option>
                <option value="login">Logins</option>
                <option value="logout">Logouts</option>
                <option value="failed">Failed Attempts</option>
                <option value="kyc">KYC Updates</option>
                <option value="transaction">Transaction Reviews</option>
            </select>
        </div>
        <div style="overflow-x: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Event Type</th>
                        <th>User</th>
                        <th>IP Address</th>
                        <th>Status</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody id="security-logs-tbody">
                    <tr><td colspan="6" class="loading">Loading security logs...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
            <!-- Suspicious Activity Page -->
<div id="suspicious-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">⚠️ Suspicious Activity Monitor</h2>
    
    <div class="stats-grid">
        <div class="stat-card" style="border-left-color: #e53e3e;">
            <div class="stat-label">Flagged Activities (24h)</div>
            <div class="stat-value" style="color: #e53e3e;" id="flagged-count">0</div>
        </div>
        <div class="stat-card" style="border-left-color: #ed8936;">
            <div class="stat-label">Under Investigation</div>
            <div class="stat-value" style="color: #ed8936;" id="investigating-count">0</div>
        </div>
        <div class="stat-card" style="border-left-color: #48bb78;">
            <div class="stat-label">Resolved (7d)</div>
            <div class="stat-value" style="color: #48bb78;" id="resolved-count">0</div>
        </div>
        <div class="stat-card" style="border-left-color: #667eea;">
            <div class="stat-label">False Positives</div>
            <div class="stat-value" style="color: #667eea;" id="false-positive-count">0</div>
        </div>
    </div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">Suspicious Activity Log</h3>
            <select class="filter-select" id="suspicious-filter">
                <option value="all">All Activities</option>
                <option value="multiple-attempts">Multiple Login Attempts</option>
                <option value="large-transaction">Large Transactions</option>
                <option value="rapid-transactions">Rapid Transactions</option>
                <option value="unusual-pattern">Unusual Patterns</option>
            </select>
        </div>
        <div id="suspicious-list">
            <p class="loading">Loading suspicious activities...</p>
        </div>
    </div>
</div>

            <!-- Settings Page -->
<div id="settings-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">⚙️ System Settings</h2>
    
    <div class="content-card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">🏦 Platform Configuration</h3>
        </div>
        <form id="platform-settings-form">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>Minimum Contribution Amount (₵)</label>
                    <input type="number" id="min-contribution" value="1" step="0.01">
                </div>
                <div class="form-group">
                    <label>Maximum Contribution Amount (₵)</label>
                    <input type="number" id="max-contribution" value="10000" step="0.01">
                </div>
                <div class="form-group">
                    <label>Withdrawal Commission (%)</label>
                    <input type="number" id="withdrawal-commission" value="2" step="0.1" min="0" max="100">
                </div>
                <div class="form-group">
                    <label>Future Projects Interest Rate (%)</label>
                    <input type="number" id="project-interest" value="20" step="1" min="0" max="100">
                </div>
                <div class="form-group">
                    <label>Minimum Withdrawal Amount (₵)</label>
                    <input type="number" id="min-withdrawal" value="10" step="0.01">
                </div>
                <div class="form-group">
                    <label>KYC Verification Required</label>
                    <select id="kyc-required">
                        <option value="true">Yes - Required</option>
                        <option value="false">No - Optional</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn" style="margin-top: 10px;">💾 Save Platform Settings</button>
        </form>
    </div>

    <div class="content-card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">👑 VIP Level Configuration</h3>
        </div>
        <div style="overflow-x: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Level</th>
                        <th>Name</th>
                        <th>Required Contributions (₵)</th>
                        <th>Benefits</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>🌱 Starter</td>
                        <td>0 - 1,000</td>
                        <td>Basic features, Standard support</td>
                        <td><span class="status-badge status-approved">ACTIVE</span></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>🥉 Bronze</td>
                        <td>1,000 - 2,000</td>
                        <td>Priority support, Monthly reports</td>
                        <td><span class="status-badge status-approved">ACTIVE</span></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>🥈 Silver</td>
                       <td>2,000 - 4,999</td>
                        <td>Fast withdrawals, Bonus interest</td>
                        <td><span class="status-badge status-approved">ACTIVE</span></td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>🥇 Gold</td>
                        <td>5,000 - 9,999</td>
                        <td>Instant withdrawals, Higher limits</td>
                        <td><span class="status-badge status-approved">ACTIVE</span></td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>💎 Platinum</td>
                        <td>10,000+</td>
                        <td>VIP support, Premium features</td>
                        <td><span class="status-badge status-approved">ACTIVE</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="content-card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">🔔 Notification Settings</h3>
        </div>
        <form id="notification-settings-form">
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="notify-new-user" checked style="width: 20px; height: 20px;">
                    <span>Notify admins of new user registrations</span>
                </label>
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="notify-kyc" checked style="width: 20px; height: 20px;">
                    <span>Notify admins of new KYC submissions</span>
                </label>
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="notify-transaction" checked style="width: 20px; height: 20px;">
                    <span>Notify admins of pending transactions</span>
                </label>
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="notify-report" checked style="width: 20px; height: 20px;">
                    <span>Notify admins of new support tickets</span>
                </label>
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="notify-suspicious" checked style="width: 20px; height: 20px;">
                    <span>Notify admins of suspicious activity</span>
                </label>
            </div>
            <button type="submit" class="btn" style="margin-top: 20px;">💾 Save Notification Settings</button>
        </form>
    </div>

    <div class="content-card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">🎨 Platform Branding</h3>
        </div>
        <form id="branding-settings-form">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>Platform Name</label>
                    <input type="text" id="platform-name" value="SusuPay">
                </div>
                <div class="form-group">
                    <label>Support Email</label>
                    <input type="email" id="support-email" value="support@susupay.com">
                </div>
                <div class="form-group">
                    <label>Primary Color (Hex)</label>
                    <input type="text" id="primary-color" value="#667eea" placeholder="#667eea">
                </div>
                <div class="form-group">
                    <label>Secondary Color (Hex)</label>
                    <input type="text" id="secondary-color" value="#764ba2" placeholder="#764ba2">
                </div>
            </div>
            <button type="submit" class="btn" style="margin-top: 10px;">💾 Save Branding Settings</button>
        </form>
    </div>

    <div class="content-card" style="background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%); border-left: 4px solid #e53e3e;">
        <div class="card-header">
            <h3 class="card-title" style="color: #742a2a;">⚠️ Danger Zone</h3>
        </div>
        <div style="color: #742a2a;">
            <p style="margin-bottom: 15px; font-weight: 500;">These actions are irreversible. Please be careful.</p>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="action-btn btn-danger" onclick="alert('Clear cache feature coming soon')">
                    🗑️ Clear System Cache
                </button>
                <button class="action-btn btn-danger" onclick="alert('Export data feature coming soon')">
                    📥 Export All Data
                </button>
                <button class="action-btn btn-danger" onclick="if(confirm('Are you sure? This will log out ALL users!')) alert('Maintenance mode feature coming soon')">
                    🔧 Enable Maintenance Mode
                </button>
            </div>
        </div>
    </div>
</div>
            <!-- Announcements Page -->
<div id="announcements-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">System Announcements</h2>
    
    <div class="content-card" style="margin-bottom: 20px;">
        <div class="card-header">
            <h3 class="card-title">Send New Announcement</h3>
        </div>
        <form id="announcement-form">
            <div class="form-group">
                <label>Announcement Title</label>
                <input type="text" id="announcement-title" required placeholder="e.g., System Maintenance Notice">
            </div>
            <div class="form-group">
                <label>Message</label>
                <textarea id="announcement-message" rows="6" required placeholder="Enter your announcement message here..."></textarea>
            </div>
            <div class="form-group">
    <label>Announcement Category</label>
    <select id="announcement-category" required>
        <option value="updates">Updates</option>
        <option value="maintenance">Maintenance</option>
        <option value="new-features">New Features</option>
        <option value="promotions">Promotions</option>
        <option value="alerts">Alerts</option>
    </select>
</div>
<div class="form-group">
    <label>Priority Level</label>
    <select id="announcement-priority">
        <option value="info">Info (Blue)</option>
        <option value="warning">Warning (Yellow)</option>
        <option value="urgent">Urgent (Red)</option>
    </select>
</div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <button type="submit" class="btn">Send to All Users</button>
                <span id="announcement-status" style="color: #718096;"></span>
            </div>
        </form>
    </div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">Recent Announcements</h3>
        </div>
        <div style="overflow-x: auto;">
            <table class="data-table">
                <thead>
    <tr>
        <th>Title</th>
        <th>Message Preview</th>
        <th>Category</th>
        <th>Priority</th>
        <th>Sent By</th>
        <th>Date</th>
        <th>Recipients</th>
    </tr>
</thead>
                <tbody id="announcements-tbody">
                    <tr><td colspan="6" class="loading">Loading announcements...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
            <!-- Future Projects Admin Page -->
<div id="future-projects-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">Future Projects Management</h2>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Total Projects</div>
            <div class="stat-value" id="admin-total-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Active Projects</div>
            <div class="stat-value" id="admin-active-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Matured Projects</div>
            <div class="stat-value" id="admin-matured-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Total Locked Value</div>
            <div class="stat-value" id="admin-locked-value">₵0</div>
        </div>
    </div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">All Future Projects</h3>
            <div class="filter-group">
                <select class="filter-select" id="project-status-filter" onchange="loadAdminFutureProjects()">
                    <option value="all">All Status</option>
                    <option value="active">Active</option>
                    <option value="matured">Matured</option>
                </select>
                <select class="filter-select" id="project-type-filter" onchange="loadAdminFutureProjects()">
                    <option value="all">All Types</option>
                    <option value="kids">For Kids</option>
                    <option value="myself">For Myself</option>
                    <option value="parents">For Parents</option>
                    <option value="spouse">For Spouse</option>
                    <option value="family">Family Project</option>
                    <option value="wedding">Wedding</option>
                    <option value="imminent">Imminent</option>
                </select>
            </div>
        </div>
        <div style="overflow-x: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Project Title</th>
                        <th>Type</th>
                        <th>Current/Goal</th>
                        <th>Progress</th>
                        <th>Maturity</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-projects-tbody">
                    <tr><td colspan="8" class="loading">Loading projects...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
 <!-- Example: Skeleton Loaders for tables -->
            <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);">
                <h3 style="margin-bottom: 20px; color: #4a5568;">Recent Activity</h3>
                <div id="skeleton-container">
                    <div class="skeleton-row"></div>
                    <div class="skeleton-row"></div>
                    <div class="skeleton-row"></div>
                    <div class="skeleton-row"></div>
                    <div class="skeleton-row"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- KYC Review Modal -->
    <div class="modal" id="kyc-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('kyc-modal')">&times;</button>
            <h2 class="modal-title">KYC Verification Review</h2>
            
            <div class="user-details-grid">
                <div class="detail-item">
                    <div class="detail-label">User</div>
                    <div class="detail-value" id="kyc-user-name"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Email</div>
                    <div class="detail-value" id="kyc-user-email"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">ID Type</div>
                    <div class="detail-value" id="kyc-id-type"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Submitted</div>
                    <div class="detail-value" id="kyc-submitted"></div>
                </div>
            </div>

            <h3 style="margin: 20px 0; color: #4a5568;">Documents</h3>
            <div class="document-preview">
                <div>
                    <p style="font-weight: 600; margin-bottom: 10px; color: #4a5568;">Front ID</p>
                    <img id="kyc-front" src="" alt="Front ID" onclick="window.open(this.src, '_blank')">
                </div>
                <div>
                    <p style="font-weight: 600; margin-bottom: 10px; color: #4a5568;">Back ID</p>
                    <img id="kyc-back" src="" alt="Back ID" onclick="window.open(this.src, '_blank')">
                </div>
                <div>
                    <p style="font-weight: 600; margin-bottom: 10px; color: #4a5568;">Selfie</p>
                    <img id="kyc-selfie" src="" alt="Selfie" onclick="window.open(this.src, '_blank')">
                </div>
            </div>

            <div class="form-group">
                <label>Review Notes</label>
                <textarea id="kyc-notes" rows="3" placeholder="Add notes about your decision..."></textarea>
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                <button class="action-btn btn-reject" onclick="rejectKYC()">Reject</button>
                <button class="action-btn btn-approve" onclick="approveKYC()">Approve</button>
            </div>
        </div>
    </div>

    <!-- Transaction Review Modal -->
    <div class="modal" id="trans-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('trans-modal')">&times;</button>
            <h2 class="modal-title">Transaction Review</h2>
            
            <div class="user-details-grid">
                <div class="detail-item">
                    <div class="detail-label">User</div>
                    <div class="detail-value" id="trans-user"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value" id="trans-type"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Amount</div>
                    <div class="detail-value" id="trans-amount"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Method</div>
                    <div class="detail-value" id="trans-method"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Transaction ID</div>
                    <div class="detail-value" id="trans-ref"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Date</div>
                    <div class="detail-value" id="trans-date"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Review Notes</label>
                <textarea id="trans-notes" rows="3" placeholder="Add notes about your decision..."></textarea>
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                <button class="action-btn btn-reject" onclick="rejectTransaction()">Reject</button>
                <button class="action-btn btn-approve" onclick="approveTransaction()">Approve</button>
            </div>
        </div>
    </div>

    <!-- Report Review Modal -->
    <div class="modal" id="report-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('report-modal')">&times;</button>
            <h2 class="modal-title">Support Ticket Details</h2>
            
            <div class="user-details-grid">
                <div class="detail-item">
                    <div class="detail-label">User</div>
                    <div class="detail-value" id="report-user-name"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Email</div>
                    <div class="detail-value" id="report-user-email"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Category</div>
                    <div class="detail-value" id="report-category"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Priority</div>
                    <div class="detail-value" id="report-priority"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Status</div>
                    <div class="detail-value" id="report-status"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Submitted</div>
                    <div class="detail-value" id="report-submitted"></div>
                </div>
            </div>

            <div style="margin: 20px 0;">
                <h3 style="margin-bottom: 10px; color: #4a5568;">Subject</h3>
                <div style="padding: 15px; background: #f7fafc; border-radius: 8px; font-weight: 600; color: #4a5568;" id="report-subject"></div>
            </div>

            <div style="margin: 20px 0;">
                <h3 style="margin-bottom: 10px; color: #4a5568;">Description</h3>
                <div style="padding: 15px; background: #f7fafc; border-radius: 8px; white-space: pre-wrap; color: #4a5568;" id="report-description"></div>
            </div>

            <div class="form-group">
                <label>Admin Response</label>
                <textarea id="report-response" rows="4" placeholder="Write your response to the user..."></textarea>
            </div>

            <div class="form-group">
                <label>Update Status</label>
                <select id="report-new-status">
                    <option value="in-progress">In Progress</option>
                    <option value="resolved">Resolved</option>
                    <option value="pending">Pending</option>
                </select>
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px;">
                <button class="action-btn btn-view" onclick="closeModal('report-modal')">Cancel</button>
                <button class="action-btn btn-approve" onclick="respondToReport()">Send Response</button>
            </div>
        </div>
    </div>
    <!-- ============================================
     USER DETAILS MODAL - ADD THIS
     ============================================ -->
<div class="modal" id="user-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">👤 User Details</h2>
            <button class="close-modal-btn" onclick="closeModal('user-modal')">&times;</button>
        </div>

        <div class="details-grid">
            <div class="detail-card">
                <div class="detail-label">Full Name</div>
                <div class="detail-value" id="user-name">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Email</div>
                <div class="detail-value" id="user-email">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Phone</div>
                <div class="detail-value" id="user-phone">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Balance</div>
                <div class="detail-value" id="user-balance">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Total Contributions</div>
                <div class="detail-value" id="user-contributions">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">KYC Status</div>
                <div class="detail-value" id="user-kyc-status">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">VIP Level</div>
                <div class="detail-value" id="user-vip">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Joined Date</div>
                <div class="detail-value" id="user-joined">Loading...</div>
            </div>
        </div>

        <div class="modal-section">
            <h3 class="modal-section-title">📊 Account Statistics</h3>
            <div style="background: #f7fafc; padding: 20px; border-radius: 12px;">
                <p style="color: #718096; margin-bottom: 10px;">This user has been active for <strong id="user-days">0</strong> days</p>
                <p style="color: #718096; margin-bottom: 10px;">Total transactions: <strong id="user-trans-count">0</strong></p>
                <p style="color: #718096;">Last activity: <strong id="user-last-activity">N/A</strong></p>
            </div>
        </div>

        <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
            <button class="btn" style="background: #e2e8f0; color: #4a5568;" onclick="closeModal('user-modal')">Close</button>
            <button class="btn" onclick="alert('Edit user functionality coming soon!')">Edit User</button>
        </div>
    </div>
</div>

<!-- ============================================
     PROJECT DETAILS MODAL - ADD THIS
     ============================================ -->
<div class="modal" id="project-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">🎯 Project Details</h2>
            <button class="close-modal-btn" onclick="closeModal('project-modal')">&times;</button>
        </div>

        <div class="details-grid">
            <div class="detail-card">
                <div class="detail-label">User</div>
                <div class="detail-value" id="project-user">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Project Title</div>
                <div class="detail-value" id="project-title">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Project Type</div>
                <div class="detail-value" id="project-type">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Status</div>
                <div class="detail-value" id="project-status-display">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Goal Amount</div>
                <div class="detail-value" id="project-goal">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Current Amount</div>
                <div class="detail-value" id="project-current">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Created Date</div>
                <div class="detail-value" id="project-created">Loading...</div>
            </div>
            <div class="detail-card">
                <div class="detail-label">Maturity Date</div>
                <div class="detail-value" id="project-maturity">Loading...</div>
            </div>
        </div>

        <div class="modal-section">
            <h3 class="modal-section-title">📈 Progress</h3>
            <div class="progress-container">
                <div class="progress-fill" id="project-progress" style="width: 0%;">0%</div>
            </div>
            <p style="margin-top: 15px; color: #718096; text-align: center;">
                <strong id="project-remaining">₵0</strong> remaining to reach goal
            </p>
        </div>

        <div class="modal-section">
            <h3 class="modal-section-title">💰 Financial Summary</h3>
            <div style="background: #f7fafc; padding: 20px; border-radius: 12px;">
                <p style="color: #718096; margin-bottom: 10px;">Days until maturity: <strong id="project-days-left">0</strong></p>
                <p style="color: #718096; margin-bottom: 10px;">Expected interest (20%): <strong id="project-interest">₵0</strong></p>
                <p style="color: #48bb78; font-weight: 700; font-size: 1.1rem;">Total at maturity: <strong id="project-total">₵0</strong></p>
            </div>
        </div>

        <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
            <button class="btn" style="background: #e2e8f0; color: #4a5568;" onclick="closeModal('project-modal')">Close</button>
            <button class="btn" onclick="alert('Manage project functionality coming soon!')">Manage Project</button>
        </div>
    </div>
</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, getDocs, updateDoc, setDoc, deleteDoc, collection, query, where, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAoomGKHjU2iUJjjMxEDGCsLzRtIkHtqhY",
            authDomain: "susupay-5286e.firebaseapp.com",
            projectId: "susupay-5286e",
            storageBucket: "susupay-5286e.firebasestorage.app",
            messagingSenderId: "83852132974",
            appId: "1:83852132974:web:2d8be2d1adb7e7639f5c7f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentAdmin = null;
        let adminRole = null;
        let currentKycReview = null;
        let currentTransReview = null;
        let currentReportReview = null;

        const rolePermissions = {
    super: ['dashboard', 'users', 'kyc', 'transactions', 'admin-users', 'super-dashboard', 'admin-activity', 'user-analytics', 'financial-overview', 'reports', 'security-logs', 'suspicious', 'settings', 'future-projects', 'announcements'],
    main: ['dashboard', 'users', 'kyc', 'transactions', 'admin-users', 'reports', 'settings', 'future-projects', 'announcements'],
    senior: ['dashboard', 'users', 'kyc', 'transactions', 'admin-users', 'reports', 'future-projects', 'announcements'],
    financial: ['dashboard', 'transactions', 'users', 'reports', 'financial-overview', 'future-projects'],
    support: ['dashboard', 'users', 'reports', 'announcements'],
    security: ['dashboard', 'users', 'kyc', 'reports', 'security-logs', 'suspicious'],
    operations: ['dashboard', 'users', 'transactions', 'kyc', 'reports', 'future-projects', 'announcements']
};

        // Utility functions
        function showAlert(msg, type, container = 'dashboard-alert') {
            const div = document.getElementById(container);
            div.innerHTML = `<div class="alert alert-${type}">${msg}</div>`;
            setTimeout(() => div.innerHTML = '', 5000);
        }

        function formatCurrency(amount) {
            return `₵${parseFloat(amount || 0).toLocaleString('en-GH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleDateString('en-GB', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Login
        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const role = document.getElementById('admin-role').value;
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const adminDoc = await getDoc(doc(db, 'admins', userCredential.user.uid));
                
                if (!adminDoc.exists()) {
                    showAlert('Not an admin account', 'error', 'login-alert');
                    await signOut(auth);
                    return;
                }

                const adminData = adminDoc.data();
                if (adminData.role !== role) {
                    showAlert(`Role mismatch. You are ${adminData.role} admin`, 'error', 'login-alert');
                    await signOut(auth);
                    return;
                }

                adminRole = role;
                currentAdmin = userCredential.user;
                loadDashboard();
            } catch (error) {
                showAlert(error.message, 'error', 'login-alert');
            }
        });

        // Auth state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const adminDoc = await getDoc(doc(db, 'admins', user.uid));
                if (adminDoc.exists()) {
                    currentAdmin = user;
                    adminRole = adminDoc.data().role;
                    loadDashboard();
                } else {
                    await signOut(auth);
                    showLoginPage();
                }
            } else {
                showLoginPage();
            }
        });

        function showLoginPage() {
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('dashboard-page').style.display = 'none';
        }

        async function loadDashboard() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'block';

            const adminDoc = await getDoc(doc(db, 'admins', currentAdmin.uid));
            const adminData = adminDoc.data();

            document.getElementById('admin-name').textContent = adminData.name;
            document.getElementById('admin-email-display').textContent = adminData.email;
            document.getElementById('user-avatar').textContent = adminData.name.charAt(0).toUpperCase();
            document.getElementById('role-badge').textContent = adminRole.charAt(0).toUpperCase() + adminRole.slice(1) + ' Admin';
            document.getElementById('role-badge').className = `admin-role-badge role-${adminRole}`;

            configureSidebar();
            
            if (adminRole === 'super') {
                document.getElementById('admin-header').classList.add('super-admin-header');
                document.getElementById('admin-sidebar').classList.add('super-admin-sidebar');
                showPage('super-dashboard');
            } else {
                showPage('dashboard');
            }
        }

        function configureSidebar() {
            const permissions = rolePermissions[adminRole];
            
            document.getElementById('super-section').style.display = adminRole === 'super' ? 'block' : 'none';
            document.getElementById('kyc-section').style.display = permissions.includes('kyc') ? 'block' : 'none';
            document.getElementById('financial-section').style.display = permissions.includes('transactions') ? 'block' : 'none';
            document.getElementById('admin-section').style.display = permissions.includes('admin-users') ? 'block' : 'none';
            document.getElementById('support-section').style.display = permissions.includes('reports') ? 'block' : 'none';
            document.getElementById('security-section').style.display = permissions.includes('security-logs') ? 'block' : 'none';
        }

        // Navigation
        document.querySelectorAll('.sidebar-nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                if (!rolePermissions[adminRole].includes(page)) {
                    showAlert('You do not have permission to access this page', 'error');
                    return;
                }
                showPage(page);
                closeMobileSidebar();
            });
        });

        async function showPage(page) {
    document.querySelectorAll('.sidebar-nav-item').forEach(i => i.classList.remove('active'));
    document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
    document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
    document.getElementById(`${page}-content`)?.classList.remove('hidden');

    if (page === 'dashboard') await loadDashboardStats();
    else if (page === 'super-dashboard') await loadSuperDashboard();
    else if (page === 'users') await loadUsers();
    else if (page === 'kyc') await loadKYC();
    else if (page === 'transactions') await loadTransactions();
    else if (page === 'admin-users') await loadAdminUsers();
    else if (page === 'admin-activity') await loadAdminActivity();
    else if (page === 'user-analytics') await loadUserAnalytics();
    else if (page === 'financial-overview') await loadFinancialOverview();
    else if (page === 'reports') await loadReports();
    else if (page === 'future-projects') await loadAdminFutureProjects();
    else if (page === 'announcements') await loadAnnouncements();
    else if (page === 'security-logs') await loadSecurityLogs();
    else if (page === 'suspicious') await loadSuspiciousActivity();
    else if (page === 'settings') await loadSystemSettings();
    else if (page === 'user-analytics') await loadUserAnalytics();
}

        // Load Dashboard Stats
        async function loadDashboardStats() {
            try {
                const users = await getDocs(collection(db, 'users'));
                const trans = await getDocs(collection(db, 'transactions'));
                const kycPending = await getDocs(query(collection(db, 'kyc_submissions'), where('status', '==', 'under_review')));
                const reportsPending = await getDocs(query(collection(db, 'reports'), where('status', '==', 'pending')));
                
                let revenue = 0;
                trans.forEach(doc => {
                    const data = doc.data();
                    if (data.type === 'withdrawal' && data.commission) revenue += data.commission;
                });

                document.getElementById('stat-users').textContent = users.size;
                document.getElementById('stat-trans').textContent = trans.size;
                document.getElementById('stat-kyc').textContent = kycPending.size;
                document.getElementById('stat-revenue').textContent = formatCurrency(revenue);
                document.getElementById('kyc-badge').textContent = kycPending.size;
                document.getElementById('reports-badge').textContent = reportsPending.size;
                
                const transPending = await getDocs(query(collection(db, 'transactions'), where('status', '==', 'pending')));
                document.getElementById('trans-badge').textContent = transPending.size;

                await loadRecentActivity();
            } catch (error) {
                console.error('Dashboard error:', error);
                showAlert('Error loading dashboard data', 'error');
            }
        }

        // Load Recent Activity
        async function loadRecentActivity() {
            const container = document.getElementById('recent-activity');
            container.innerHTML = '';

            try {
                const q = query(collection(db, 'transactions'), orderBy('timestamp', 'desc'), limit(10));
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📊</div><p>No recent activity</p></div>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', trans.userId));
                    
                    if (!userDoc.exists()) continue;
                    
                    const userData = userDoc.data();

                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                        <div class="activity-time">${formatDate(trans.timestamp)}</div>
                        <div class="activity-description">
                            <span class="activity-user">${userData.firstName} ${userData.surname}</span>
                            ${trans.type === 'contribution' ? 'contributed' : 'withdrew'} ${formatCurrency(trans.amount)}
                            <span class="status-badge status-${trans.status}" style="margin-left: 10px; font-size: 0.75rem;">${trans.status.toUpperCase()}</span>
                        </div>
                    `;
                    container.appendChild(item);
                }
            } catch (error) {
                console.error('Activity error:', error);
                container.innerHTML = '<p style="text-align: center; color: #e53e3e;">Error loading activity</p>';
            }
        }

        // Load Super Dashboard
        async function loadSuperDashboard() {
            try {
                const users = await getDocs(collection(db, 'users'));
                const admins = await getDocs(collection(db, 'admins'));
                const trans = await getDocs(collection(db, 'transactions'));
                
                let revenue = 0;
                trans.forEach(doc => {
                    const data = doc.data();
                    if (data.type === 'withdrawal' && data.commission) revenue += data.commission;
                });

                document.getElementById('super-users').textContent = users.size;
                document.getElementById('super-admins').textContent = admins.size;
                document.getElementById('super-revenue').textContent = formatCurrency(revenue);

                await loadRealtimeActivity();
            } catch (error) {
                console.error('Super dashboard error:', error);
                showAlert('Error loading super dashboard', 'error');
            }
        }

        async function loadRealtimeActivity() {
            const container = document.getElementById('super-activity');
            container.innerHTML = '';

            try {
                const q = query(collection(db, 'transactions'), orderBy('timestamp', 'desc'), limit(15));
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">📊</div><p>No recent activity</p></div>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', trans.userId));
                    
                    if (!userDoc.exists()) continue;
                    
                    const userData = userDoc.data();

                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                        <div class="activity-time">${formatDate(trans.timestamp)}</div>
                        <div class="activity-description">
                            <span class="activity-user">${userData.firstName} ${userData.surname}</span>
                            ${trans.type === 'contribution' ? 'contributed' : 'withdrew'} ${formatCurrency(trans.amount)}
                            <span class="status-badge status-${trans.status}" style="margin-left: 10px; font-size: 0.75rem;">${trans.status.toUpperCase()}</span>
                        </div>
                    `;
                    container.appendChild(item);
                }
            } catch (error) {
                console.error('Activity error:', error);
                container.innerHTML = '<p style="text-align: center; color: #e53e3e;">Error loading activity</p>';
            }
        }

        // Load Users
        async function loadUsers() {
            const tbody = document.getElementById('users-tbody');
            tbody.innerHTML = '<tr><td colspan="6" class="loading">Loading users...</td></tr>';

            try {
                const snapshot = await getDocs(collection(db, 'users'));
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No users found</td></tr>';
                    return;
                }

                snapshot.forEach(docSnap => {
                    const user = docSnap.data();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${user.firstName || 'N/A'} ${user.surname || ''}</td>
                        <td>${user.email || 'N/A'}</td>
                        <td>${formatCurrency(user.balance)}</td>
                        <td><span class="status-badge status-${user.kycStatus || 'pending'}">${(user.kycStatus || 'pending').replace('_', ' ').toUpperCase()}</span></td>
                        <td>${formatDate(user.createdAt)}</td>
                      <td><button class="action-btn btn-view" onclick="window.viewUserDetails('${docSnap.id}')">View</button></td>
                    `;
                });
            } catch (error) {
                console.error('Users error:', error);
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: #e53e3e;">Error loading users: ${error.message}</td></tr>`;
            }
        }

        // Load KYC
        async function loadKYC() {
            const tbody = document.getElementById('kyc-tbody');
            tbody.innerHTML = '<tr><td colspan="5" class="loading">Loading KYC submissions...</td></tr>';

            try {
                const filter = document.getElementById('kyc-filter').value;
                let q;
                if (filter === 'all') {
                    q = query(collection(db, 'kyc_submissions'), orderBy('submittedAt', 'desc'));
                } else {
                    q = query(collection(db, 'kyc_submissions'), where('status', '==', filter), orderBy('submittedAt', 'desc'));
                }

                const snapshot = await getDocs(q);
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state">No KYC submissions found</td></tr>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const kyc = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', kyc.userId));
                    
                    if (!userDoc.exists()) continue;
                    
                    const userData = userDoc.data();

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${userData.firstName} ${userData.surname}</td>
                        <td>${kyc.idType ? kyc.idType.toUpperCase() : 'N/A'}</td>
                        <td>${formatDate(kyc.submittedAt)}</td>
                        <td><span class="status-badge status-${kyc.status}">${kyc.status.replace('_', ' ').toUpperCase()}</span></td>
                        <td><button class="action-btn btn-view" onclick="window.reviewKYC('${docSnap.id}')">Review</button></td>
                    `;
                }
            } catch (error) {
                console.error('KYC error:', error);
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: #e53e3e;">Error loading KYC: ${error.message}</td></tr>`;
            }
        }

        // Review KYC
        window.reviewKYC = async function(id) {
            try {
                const kycDoc = await getDoc(doc(db, 'kyc_submissions', id));
                if (!kycDoc.exists()) {
                    showAlert('KYC submission not found', 'error');
                    return;
                }
                
                const kycData = kycDoc.data();
                const userDoc = await getDoc(doc(db, 'users', kycData.userId));
                
                if (!userDoc.exists()) {
                    showAlert('User not found', 'error');
                    return;
                }
                
                const userData = userDoc.data();

                currentKycReview = { id, data: kycData };

                document.getElementById('kyc-user-name').textContent = `${userData.firstName} ${userData.surname}`;
                document.getElementById('kyc-user-email').textContent = userData.email;
                document.getElementById('kyc-id-type').textContent = kycData.idType ? kycData.idType.toUpperCase() : 'N/A';
                document.getElementById('kyc-submitted').textContent = formatDate(kycData.submittedAt);
                document.getElementById('kyc-front').src = kycData.frontIdUrl || '';
                document.getElementById('kyc-back').src = kycData.backIdUrl || '';
                document.getElementById('kyc-selfie').src = kycData.selfieUrl || '';
                document.getElementById('kyc-notes').value = '';

                document.getElementById('kyc-modal').style.display = 'block';
            } catch (error) {
                console.error('Review KYC error:', error);
                showAlert('Error loading KYC details: ' + error.message, 'error');
            }
        };

        window.approveKYC = async function() {
            if (!currentKycReview) return;

            try {
                await updateDoc(doc(db, 'kyc_submissions', currentKycReview.id), {
                    status: 'approved',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    reviewNotes: document.getElementById('kyc-notes').value
                });

                await updateDoc(doc(db, 'users', currentKycReview.data.userId), {
                    kycStatus: 'approved'
                });

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentKycReview.data.userId,
                    title: 'KYC Approved',
                    message: 'Your KYC verification has been approved. You can now access all features.',
                    type: 'kyc-approval',
                    read: false,
                    timestamp: serverTimestamp()
                });

                showAlert('KYC approved successfully!', 'success');
                closeModal('kyc-modal');
                loadKYC();
                loadDashboardStats();
            } catch (error) {
                console.error('Approve KYC error:', error);
                showAlert('Error approving KYC: ' + error.message, 'error');
            }
        };

        window.rejectKYC = async function() {
            if (!currentKycReview) return;
            const notes = document.getElementById('kyc-notes').value;
            if (!notes.trim()) {
                showAlert('Please provide a reason for rejection', 'error');
                return;
            }

            try {
                await updateDoc(doc(db, 'kyc_submissions', currentKycReview.id), {
                    status: 'rejected',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    reviewNotes: notes
                });

                await updateDoc(doc(db, 'users', currentKycReview.data.userId), {
                    kycStatus: 'rejected'
                });

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentKycReview.data.userId,
                    title: 'KYC Rejected',
                    message: `Your KYC verification was rejected. Reason: ${notes}`,
                    type: 'kyc-rejection',
                    read: false,
                    timestamp: serverTimestamp()
                });

                showAlert('KYC rejected', 'info');
                closeModal('kyc-modal');
                loadKYC();
                loadDashboardStats();
            } catch (error) {
                console.error('Reject KYC error:', error);
                showAlert('Error rejecting KYC: ' + error.message, 'error');
            }
        };

        // Load Transactions
        async function loadTransactions() {
            const tbody = document.getElementById('trans-tbody');
            tbody.innerHTML = '<tr><td colspan="7" class="loading">Loading transactions...</td></tr>';

            try {
                const status = document.getElementById('trans-filter').value;
                const type = document.getElementById('trans-type-filter').value;

                let q;
                if (status === 'all' && type === 'all') {
                    q = query(collection(db, 'transactions'), orderBy('timestamp', 'desc'), limit(100));
                } else if (status !== 'all' && type === 'all') {
                    q = query(collection(db, 'transactions'), where('status', '==', status), orderBy('timestamp', 'desc'), limit(100));
                } else if (status === 'all' && type !== 'all') {
                    q = query(collection(db, 'transactions'), where('type', '==', type), orderBy('timestamp', 'desc'), limit(100));
                } else {
                    q = query(collection(db, 'transactions'), where('status', '==', status), where('type', '==', type), orderBy('timestamp', 'desc'), limit(100));
                }

                const snapshot = await getDocs(q);
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No transactions found</td></tr>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', trans.userId));
                    
                    if (!userDoc.exists()) continue;
                    
                    const userData = userDoc.data();

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${userData.firstName} ${userData.surname}</td>
                        <td style="text-transform: capitalize;">${trans.type}</td>
                        <td>${formatCurrency(trans.amount)}</td>
                        <td>${trans.paymentMethod || 'N/A'}</td>
                        <td><span class="status-badge status-${trans.status}">${trans.status.toUpperCase()}</span></td>
                        <td>${formatDate(trans.timestamp)}</td>
                        <td><button class="action-btn btn-view" onclick="window.reviewTransaction('${docSnap.id}')">Review</button></td>
                    `;
                }
            } catch (error) {
                console.error('Transactions error:', error);
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: #e53e3e;">Error loading transactions: ${error.message}</td></tr>`;
            }
        }

        // Review Transaction
        window.reviewTransaction = async function(id) {
            try {
                const transDoc = await getDoc(doc(db, 'transactions', id));
                if (!transDoc.exists()) {
                    showAlert('Transaction not found', 'error');
                    return;
                }
                
                const transData = transDoc.data();
                const userDoc = await getDoc(doc(db, 'users', transData.userId));
                
                if (!userDoc.exists()) {
                    showAlert('User not found', 'error');
                    return;
                }
                
                const userData = userDoc.data();

                currentTransReview = { id, data: transData };

                document.getElementById('trans-user').textContent = `${userData.firstName} ${userData.surname}`;
                document.getElementById('trans-type').textContent = transData.type ? transData.type.toUpperCase() : 'N/A';
                document.getElementById('trans-amount').textContent = formatCurrency(transData.amount);
                document.getElementById('trans-method').textContent = transData.paymentMethod || 'N/A';
                document.getElementById('trans-ref').textContent = transData.transactionId || 'N/A';
                document.getElementById('trans-date').textContent = formatDate(transData.timestamp);
                document.getElementById('trans-notes').value = '';

                document.getElementById('trans-modal').style.display = 'block';
            } catch (error) {
                console.error('Review transaction error:', error);
                showAlert('Error loading transaction details: ' + error.message, 'error');
            }
        };

        window.approveTransaction = async function() {
            if (!currentTransReview) return;

            try {
                await updateDoc(doc(db, 'transactions', currentTransReview.id), {
                    status: 'approved',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    reviewNotes: document.getElementById('trans-notes').value
                });

                if (currentTransReview.data.type === 'contribution') {
                    const userRef = doc(db, 'users', currentTransReview.data.userId);
                    const userDoc = await getDoc(userRef);
                    const userData = userDoc.data();

                    const monthKey = currentTransReview.data.month;
                    const contributedDays = userData.contributedDays || {};
                    const monthDays = contributedDays[monthKey] || [];

                    const updatedDays = monthDays.map(day => {
                        if (currentTransReview.data.days && currentTransReview.data.days.includes(day.day)) {
                            return { ...day, status: 'approved' };
                        }
                        return day;
                    });

                    await updateDoc(userRef, {
                        [`contributedDays.${monthKey}`]: updatedDays,
                        balance: (userData.balance || 0) + currentTransReview.data.amount
                    });
                }

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentTransReview.data.userId,
                    title: 'Transaction Approved',
                    message: `Your ${currentTransReview.data.type} of ${formatCurrency(currentTransReview.data.amount)} has been approved.`,
                    type: 'transaction-approval',
                    read: false,
                    timestamp: serverTimestamp()
                });

                showAlert('Transaction approved successfully!', 'success');
                closeModal('trans-modal');
                loadTransactions();
                loadDashboardStats();
            } catch (error) {
                console.error('Approve transaction error:', error);
                showAlert('Error approving transaction: ' + error.message, 'error');
            }
        };
       

        window.rejectTransaction = async function() {
            if (!currentTransReview) return;
            const notes = document.getElementById('trans-notes').value;
            if (!notes.trim()) {
                showAlert('Please provide a reason for rejection', 'error');
                return;
            }

            try {
                await updateDoc(doc(db, 'transactions', currentTransReview.id), {
                    status: 'rejected',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    rejectionReason: notes
                });

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentTransReview.data.userId,
                    title: 'Transaction Rejected',
                    message: `Your ${currentTransReview.data.type} of ${formatCurrency(currentTransReview.data.amount)} was rejected. Reason: ${notes}`,
                    type: 'transaction-rejection',
                    read: false,
                    timestamp: serverTimestamp()
                });

                showAlert('Transaction rejected', 'info');
                closeModal('trans-modal');
                loadTransactions();
                loadDashboardStats();
            } catch (error) {
                console.error('Reject transaction error:', error);
                showAlert('Error rejecting transaction: ' + error.message, 'error');
            }
        };
const adminFutureProjectsHTML = `
<!-- Future Projects Page -->
<div id="future-projects-content" class="page-content hidden">
    <h2 style="margin-bottom: 25px; color: white;">Future Projects Management</h2>
    
    <div class="stats-grid" style="margin-bottom: 30px;">
        <div class="stat-card">
            <div class="stat-label">Total Projects</div>
            <div class="stat-value" id="admin-total-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Active Projects</div>
            <div class="stat-value" id="admin-active-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Matured Projects</div>
            <div class="stat-value" id="admin-matured-projects">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Total Locked Value</div>
            <div class="stat-value" id="admin-locked-value">₵0</div>
        </div>
    </div>

    <div class="content-card">
        <div class="card-header">
            <h3 class="card-title">All Future Projects</h3>
            <div class="filter-group">
                <select class="filter-select" id="project-status-filter">
                    <option value="all">All Status</option>
                    <option value="active">Active</option>
                    <option value="matured">Matured</option>
                    <option value="withdrawn">Withdrawn</option>
                </select>
                <select class="filter-select" id="project-type-filter">
                    <option value="all">All Types</option>
                    <option value="kids">For Kids</option>
                    <option value="myself">For Myself</option>
                    <option value="parents">For Parents</option>
                    <option value="spouse">For Spouse</option>
                    <option value="family">Family Project</option>
                    <option value="wedding">Wedding</option>
                    <option value="imminent">Imminent</option>
                </select>
            </div>
        </div>
        <div style="overflow-x: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Project Title</th>
                        <th>Type</th>
                        <th>Current Amount</th>
                        <th>Goal Amount</th>
                        <th>Progress</th>
                        <th>Maturity Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-projects-tbody">
                    <tr><td colspan="9" class="loading">Loading projects...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
`;


// FIX 4: Admin Function to Load Future Projects
async function loadAdminFutureProjects() {
    const tbody = document.getElementById('admin-projects-tbody');
    tbody.innerHTML = '<tr><td colspan="9" class="loading">Loading projects...</td></tr>';

    try {
        const statusFilter = document.getElementById('project-status-filter').value;
        const typeFilter = document.getElementById('project-type-filter').value;

        let q;
        if (statusFilter === 'all' && typeFilter === 'all') {
            q = query(collection(db, 'future_projects'), orderBy('createdAt', 'desc'));
        } else if (statusFilter !== 'all' && typeFilter === 'all') {
            q = query(collection(db, 'future_projects'), where('status', '==', statusFilter), orderBy('createdAt', 'desc'));
        } else if (statusFilter === 'all' && typeFilter !== 'all') {
            q = query(collection(db, 'future_projects'), where('type', '==', typeFilter), orderBy('createdAt', 'desc'));
        } else {
            q = query(
                collection(db, 'future_projects'), 
                where('status', '==', statusFilter), 
                where('type', '==', typeFilter), 
                orderBy('createdAt', 'desc')
            );
        }

        const snapshot = await getDocs(q);
        tbody.innerHTML = '';

        if (snapshot.empty) {
            tbody.innerHTML = '<tr><td colspan="9" class="empty-state">No projects found</td></tr>';
            return;
        }

        let totalProjects = 0;
        let activeProjects = 0;
        let maturedProjects = 0;
        let totalLockedValue = 0;

        for (const docSnap of snapshot.docs) {
            const project = docSnap.data();
            const userDoc = await getDoc(doc(db, 'users', project.userId));
            
            if (!userDoc.exists()) continue;
            
            const userData = userDoc.data();
            const progress = (project.currentAmount / project.goalAmount) * 100;
            const maturityDate = project.maturityDate?.toDate ? project.maturityDate.toDate() : new Date(project.maturityDate);
            const isMatured = new Date() >= maturityDate;

            totalProjects++;
            if (project.status === 'active') activeProjects++;
            if (isMatured) maturedProjects++;
            if (project.status === 'active') totalLockedValue += project.currentAmount || 0;

            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${userData.firstName} ${userData.surname}</td>
                <td>${project.title}</td>
                <td style="text-transform: capitalize;">${project.type.replace('-', ' ')}</td>
                <td>${formatCurrency(project.currentAmount || 0)}</td>
                <td>${formatCurrency(project.goalAmount)}</td>
                <td>
                    <div style="width: 100%; background: #e2e8f0; border-radius: 10px; height: 8px; overflow: hidden;">
                        <div style="width: ${Math.min(progress, 100)}%; height: 100%; background: #48bb78; border-radius: 10px;"></div>
                    </div>
                    <small style="color: #718096;">${progress.toFixed(1)}%</small>
                </td>
                <td>${maturityDate.toLocaleDateString()}</td>
                <td>
                    <span class="status-badge ${isMatured ? 'status-approved' : 'status-pending'}">
                        ${isMatured ? 'MATURED' : project.status.toUpperCase()}
                    </span>
                </td>
                <td><button class="action-btn btn-view" onclick="window.viewAdminProjectDetails('${docSnap.id}')">View</button></td>
            `;
        }

        // Update stats
        document.getElementById('admin-total-projects').textContent = totalProjects;
        document.getElementById('admin-active-projects').textContent = activeProjects;
        document.getElementById('admin-matured-projects').textContent = maturedProjects;
        document.getElementById('admin-locked-value').textContent = formatCurrency(totalLockedValue);

    } catch (error) {
        console.error('Admin projects error:', error);
        tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; color: #e53e3e;">Error loading projects: ${error.message}</td></tr>`;
    }
}

// FIX 5: Optimized Project Maturity Checker (runs once per hour)
let maturityCheckInterval = null;

function startMaturityChecker() {
    // Clear existing interval
    if (maturityCheckInterval) {
        clearInterval(maturityCheckInterval);
    }
    
    // Check immediately
    checkProjectMaturity();
    
    // Then check every hour
    maturityCheckInterval = setInterval(() => {
        checkProjectMaturity();
    }, 60 * 60 * 1000); // 1 hour
}

async function checkProjectMaturity() {
    if (!currentUser || !activeProjects || activeProjects.length === 0) return;
    
    console.log('🔍 Checking project maturity...');
    
    try {
        const now = new Date();
        
        for (const project of activeProjects) {
            const maturityDate = project.maturityDate instanceof Date ? 
                project.maturityDate : 
                (project.maturityDate?.toDate ? project.maturityDate.toDate() : new Date(project.maturityDate));
            
            const daysUntilMaturity = Math.ceil((maturityDate - now) / (1000 * 60 * 60 * 24));
            
            // 30-day warning
            if (daysUntilMaturity === 30) {
                const notifKey = `maturity_30day_${project.id}`;
                if (!localStorage.getItem(notifKey)) {
                    await createNotification(
                        '📅 Project Maturing Soon',
                        `Your "${project.title}" matures in 30 days! You'll earn 20% interest.`,
                        'info'
                    );
                    localStorage.setItem(notifKey, 'true');
                }
            }
            
            // 7-day warning
            if (daysUntilMaturity === 7) {
                const notifKey = `maturity_7day_${project.id}`;
                if (!localStorage.getItem(notifKey)) {
                    await createNotification(
                        '⏰ Project Maturing This Week',
                        `Your "${project.title}" matures in 7 days!`,
                        'info'
                    );
                    localStorage.setItem(notifKey, 'true');
                }
            }
            
            // Matured today
            if (daysUntilMaturity <= 0 && daysUntilMaturity > -1) {
                const notifKey = `maturity_complete_${project.id}`;
                if (!localStorage.getItem(notifKey)) {
                    const interest = project.currentAmount * 0.20;
                    const total = project.currentAmount + interest;
                    
                    await createNotification(
                        '🎉 Project Matured!',
                        `Congratulations! "${project.title}" has matured. Total: ${formatCurrency(total)}`,
                        'success'
                    );
                    
                    localStorage.setItem(notifKey, 'true');
                    
                    // Update project status in Firestore
                    await updateDoc(doc(db, 'future_projects', project.id), {
                        status: 'matured'
                    });
                    
                    // Celebration
                    celebrateMaturity(project.title, total);
                }
            }
        }
        
        console.log('✅ Maturity check complete');
        
    } catch (error) {
        console.error('❌ Error checking maturity:', error);
    }
}

// FIX 6: Enhanced Timer Display with Better UX
function updateTimerDisplay() {
    if (!currentUser) return;
    
    const timerDisplay = document.getElementById('timer-display');
    const sessionTimer = document.getElementById('session-timer');
    
    if (!timerDisplay || !sessionTimer) return;
    
    const timeSinceLastActivity = Date.now() - lastActivityTime;
    const timeRemaining = Math.max(0, INACTIVITY_TIMEOUT - timeSinceLastActivity);
    
    if (timeRemaining === 0) {
        handleInactivityLogout();
        return;
    }
    
    const minutes = Math.floor(timeRemaining / 60000);
    const seconds = Math.floor((timeRemaining % 60000) / 1000);
    
    timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    // Show timer when less than 2 minutes remaining
    if (timeRemaining <= 120000) {
        sessionTimer.style.display = 'flex';
        
        // Color coding
        if (timeRemaining <= 60000) {
            timerDisplay.style.color = '#e53e3e';
            timerDisplay.style.fontWeight = '700';
            
            // Flash warning at 30 seconds
            if (timeRemaining <= 30000 && Math.floor(seconds) % 2 === 0) {
                timerDisplay.style.opacity = '0.5';
                setTimeout(() => {
                    if (timerDisplay) timerDisplay.style.opacity = '1';
                }, 500);
            }
        } else {
            timerDisplay.style.color = '#f6cc33';
            timerDisplay.style.fontWeight = '600';
        }
    } else {
        sessionTimer.style.display = 'none';
    }
}

// FIX 7: Initialize everything properly on load
async function initializeEnhancedSystems() {
    if (!currentUser) return;
    
    console.log('🚀 Initializing enhanced systems...');
    
    // Start maturity checker
    startMaturityChecker();
    
    // Update timer every second
    setInterval(updateTimerDisplay, 1000);
    
    // Initial updates
    updateVIPProgress();
    updateTimerDisplay();
    
    console.log('✅ Enhanced systems initialized');
}

        // Load Reports
        async function loadReports() {
            const tbody = document.getElementById('reports-tbody');
            tbody.innerHTML = '<tr><td colspan="7" class="loading">Loading reports...</td></tr>';

            try {
                const statusFilter = document.getElementById('report-status-filter').value;
                const categoryFilter = document.getElementById('report-category-filter').value;

                let q;
                if (statusFilter === 'all' && categoryFilter === 'all') {
                    q = query(collection(db, 'reports'), orderBy('submittedAt', 'desc'));
                } else if (statusFilter !== 'all' && categoryFilter === 'all') {
                    q = query(collection(db, 'reports'), where('status', '==', statusFilter), orderBy('submittedAt', 'desc'));
                } else if (statusFilter === 'all' && categoryFilter !== 'all') {
                    q = query(collection(db, 'reports'), where('category', '==', categoryFilter), orderBy('submittedAt', 'desc'));
                } else {
                    q = query(collection(db, 'reports'), where('status', '==', statusFilter), where('category', '==', categoryFilter), orderBy('submittedAt', 'desc'));
                }

                const snapshot = await getDocs(q);
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No reports found</td></tr>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const report = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', report.userId));
                    const userData = userDoc.exists() ? userDoc.data() : { firstName: 'Unknown', surname: 'User' };

                    const priorityColors = {
                        high: 'background: #fed7d7; color: #742a2a;',
                        medium: 'background: #fef5e7; color: #744210;',
                        low: 'background: #e6fffa; color: #234e52;'
                    };

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${userData.firstName} ${userData.surname}</td>
                        <td style="text-transform: capitalize;">${report.category.replace(/-/g, ' ')}</td>
                        <td>${report.subject}</td>
                        <td><span class="status-badge" style="${priorityColors[report.priority]}">${report.priority.toUpperCase()}</span></td>
                        <td><span class="status-badge status-${report.status}">${report.status.replace('-', ' ').toUpperCase()}</span></td>
                        <td>${formatDate(report.submittedAt)}</td>
                        <td><button class="action-btn btn-view" onclick="window.reviewReport('${docSnap.id}')">Review</button></td>
                    `;
                }

                const pendingReports = await getDocs(query(collection(db, 'reports'), where('status', '==', 'pending')));
                document.getElementById('reports-badge').textContent = pendingReports.size;
            } catch (error) {
                console.error('Reports error:', error);
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: #e53e3e;">Error loading reports: ${error.message}</td></tr>`;
            }
        }

        window.reviewReport = async function(id) {
            try {
                const reportDoc = await getDoc(doc(db, 'reports', id));
                if (!reportDoc.exists()) {
                    showAlert('Report not found', 'error');
                    return;
                }
                
                const reportData = reportDoc.data();
                const userDoc = await getDoc(doc(db, 'users', reportData.userId));
                const userData = userDoc.exists() ? userDoc.data() : { firstName: 'Unknown', surname: 'User', email: 'N/A' };

                currentReportReview = { id, data: reportData };

                document.getElementById('report-user-name').textContent = `${userData.firstName} ${userData.surname}`;
                document.getElementById('report-user-email').textContent = userData.email;
                document.getElementById('report-category').textContent = reportData.category.replace(/-/g, ' ').toUpperCase();
                document.getElementById('report-priority').textContent = reportData.priority.toUpperCase();
                document.getElementById('report-status').textContent = reportData.status.replace('-', ' ').toUpperCase();
                document.getElementById('report-submitted').textContent = formatDate(reportData.submittedAt);
                document.getElementById('report-subject').textContent = reportData.subject;
                document.getElementById('report-description').textContent = reportData.description;
                document.getElementById('report-new-status').value = reportData.status;
                document.getElementById('report-response').value = '';

                document.getElementById('report-modal').style.display = 'block';
            } catch (error) {
                console.error('Review report error:', error);
                showAlert('Error loading report details: ' + error.message, 'error');
            }
        };

        window.respondToReport = async function() {
            if (!currentReportReview) return;
            
            const response = document.getElementById('report-response').value;
            const newStatus = document.getElementById('report-new-status').value;

            if (!response.trim()) {
                showAlert('Please provide a response', 'error');
                return;
            }

            try {
                await updateDoc(doc(db, 'reports', currentReportReview.id), {
                    status: newStatus,
                    adminResponse: response,
                    respondedBy: currentAdmin.uid,
                    respondedAt: serverTimestamp()
                });

                const notificationRef = doc(collection(db, 'notifications'));
                await setDoc(notificationRef, {
                    userId: currentReportReview.data.userId,
                    title: 'Support Ticket Update',
                    message: `Your support ticket "${currentReportReview.data.subject}" has been ${newStatus === 'resolved' ? 'resolved' : 'updated'}. Admin Response: ${response}`,
                    type: 'report-response',
                    read: false,
                    timestamp: serverTimestamp(),
                    reportId: currentReportReview.id
                });

                showAlert('Response sent successfully! User has been notified.', 'success');
                closeModal('report-modal');
                document.getElementById('report-response').value = '';
                loadReports();
                loadDashboardStats();
            } catch (error) {
                console.error('Respond to report error:', error);
                showAlert('Error sending response: ' + error.message, 'error');
            }
        };

        // Load Admin Users
        async function loadAdminUsers() {
            const tbody = document.getElementById('admins-tbody');
            tbody.innerHTML = '<tr><td colspan="5" class="loading">Loading admins...</td></tr>';

            try {
                const snapshot = await getDocs(collection(db, 'admins'));
                tbody.innerHTML = '';

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" class="empty-state">No admin users found</td></tr>';
                    return;
                }

                snapshot.forEach(docSnap => {
                    const admin = docSnap.data();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${admin.name}</td>
                        <td>${admin.email}</td>
                        <td><span class="admin-role-badge role-${admin.role}">${admin.role.toUpperCase()}</span></td>
                        <td>${formatDate(admin.createdAt)}</td>
                        <td>
                            ${(admin.role !== 'super' && admin.role !== 'main') || adminRole === 'super' ?
                                `<button class="action-btn btn-danger" onclick="window.removeAdmin('${docSnap.id}', '${admin.email}')">Remove</button>` :
                                '<span style="color: #718096;">Protected</span>'}
                        </td>
                    `;
                });
            } catch (error) {
                console.error('Admin users error:', error);
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: #e53e3e;">Error loading admin users: ${error.message}</td></tr>`;
            }
        }

        document.getElementById('add-admin-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('new-admin-name').value;
            const email = document.getElementById('new-admin-email').value;
            const role = document.getElementById('new-admin-role').value;
            const password = document.getElementById('new-admin-pass').value;

            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Adding...';

            try {
                const userCred = await createUserWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, 'admins', userCred.user.uid), {
                    name, 
                    email, 
                    role,
                    createdAt: serverTimestamp(),
                    createdBy: currentAdmin.uid
                });

                showAlert('Admin added successfully!', 'success');
                document.getElementById('add-admin-form').reset();
                loadAdminUsers();
                
                await signOut(auth);
            } catch (error) {
                console.error('Add admin error:', error);
                showAlert('Error adding admin: ' + error.message, 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Add Admin';
            }
        });

        window.removeAdmin = async function(id, email) {
            if (!confirm(`Are you sure you want to remove admin: ${email}?`)) return;

            try {
                await deleteDoc(doc(db, 'admins', id));
                showAlert('Admin removed successfully', 'info');
                loadAdminUsers();
            } catch (error) {
                console.error('Remove admin error:', error);
                showAlert('Error removing admin: ' + error.message, 'error');
            }
        };

        async function loadAdminActivity() {
            const container = document.getElementById('admin-activity-list');
            container.innerHTML = '<p class="loading">Loading admin activity...</p>';

            try {
                const q = query(collection(db, 'transactions'), where('reviewedBy', '!=', null), orderBy('reviewedBy'), orderBy('reviewedAt', 'desc'), limit(50));
                const snapshot = await getDocs(q);
                container.innerHTML = '';

                if (snapshot.empty) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">👨‍💼</div><p>No admin activity found</p></div>';
                    return;
                }

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const adminDoc = await getDoc(doc(db, 'admins', trans.reviewedBy));
                    const adminData = adminDoc.exists() ? adminDoc.data() : { name: 'Unknown Admin' };

                    const card = document.createElement('div');
                    card.style.cssText = 'padding: 15px; background: #f7fafc; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid #667eea;';
                    card.innerHTML = `
                        <div style="font-weight: 600; color: #4a5568;">${adminData.name}</div>
                        <div style="font-size: 0.9rem; color: #718096; margin-top: 5px;">
                            ${trans.status === 'approved' ? 'Approved' : 'Rejected'} ${trans.type} of ${formatCurrency(trans.amount)}
                        </div>
                        <div style="font-size: 0.8rem; color: #a0aec0; margin-top: 5px;">${formatDate(trans.reviewedAt)}</div>
                    `;
                    container.appendChild(card);
                }
            } catch (error) {
                console.error('Admin activity error:', error);
                container.innerHTML = `<p style="text-align: center; color: #e53e3e;">Error loading admin activity: ${error.message}</p>`;
            }
        }

        async function loadUserAnalytics() {
            try {
                const users = await getDocs(collection(db, 'users'));
                let kycVerified = 0;
                let totalBalance = 0;

                users.forEach(doc => {
                    const user = doc.data();
                    if (user.kycStatus === 'approved') kycVerified++;
                    totalBalance += user.balance || 0;
                });

                const avgBalance = users.size > 0 ? totalBalance / users.size : 0;

                document.getElementById('active-users').textContent = users.size;
                document.getElementById('new-signups').textContent = Math.floor(users.size * 0.1);
                document.getElementById('kyc-verified').textContent = kycVerified;
                document.getElementById('avg-balance').textContent = formatCurrency(avgBalance);
            } catch (error) {
                console.error('User analytics error:', error);
                showAlert('Error loading user analytics', 'error');
            }
        }

      async function loadFinancialOverview() {
    try {
        const trans = await getDocs(collection(db, 'transactions'));
        let totalContrib = 0, totalWithdraw = 0, totalCommission = 0, pendingValue = 0;
        
        // For chart calculations
        let last6MonthsContrib = 0, last6MonthsWithdraw = 0, last6MonthsCommission = 0;
        const sixMonthsAgo = new Date();
        sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
        
        const monthlyContributions = {};
        let bestMonth = { month: 'N/A', amount: 0 };

        trans.forEach(doc => {
            const t = doc.data();
            const transDate = t.timestamp?.toDate ? t.timestamp.toDate() : new Date(t.timestamp);
            const isRecent = transDate >= sixMonthsAgo;
            
            if (t.type === 'contribution') {
                if (t.status === 'approved') {
                    totalContrib += t.amount || 0;
                    if (isRecent) last6MonthsContrib += t.amount || 0;
                    
                    // Track monthly contributions
                    const monthKey = transDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                    monthlyContributions[monthKey] = (monthlyContributions[monthKey] || 0) + (t.amount || 0);
                    
                    if (monthlyContributions[monthKey] > bestMonth.amount) {
                        bestMonth = { month: monthKey, amount: monthlyContributions[monthKey] };
                    }
                } else if (t.status === 'pending') {
                    pendingValue += t.amount || 0;
                }
            } else if (t.type === 'withdrawal') {
                if (t.status === 'approved') {
                    totalWithdraw += t.amount || 0;
                    totalCommission += t.commission || 0;
                    if (isRecent) {
                        last6MonthsWithdraw += t.amount || 0;
                        last6MonthsCommission += t.commission || 0;
                    }
                } else if (t.status === 'pending') {
                    pendingValue += t.amount || 0;
                }
            }
        });

        // Update stat cards
        document.getElementById('total-contrib').textContent = formatCurrency(totalContrib);
        document.getElementById('total-withdraw').textContent = formatCurrency(totalWithdraw);
        document.getElementById('total-commission').textContent = formatCurrency(totalCommission);
        document.getElementById('pending-value').textContent = formatCurrency(pendingValue);
        
        // Update chart summary cards
        document.getElementById('chart-total-contrib').textContent = formatCurrency(last6MonthsContrib);
        document.getElementById('chart-total-withdraw').textContent = formatCurrency(last6MonthsWithdraw);
        document.getElementById('chart-total-commission').textContent = formatCurrency(last6MonthsCommission);
        document.getElementById('chart-net-flow').textContent = formatCurrency(last6MonthsContrib - last6MonthsWithdraw);
        
        // Update insights
        const avgMonthly = last6MonthsContrib / 6;
        document.getElementById('avg-monthly-contrib').textContent = formatCurrency(avgMonthly);
        document.getElementById('best-month').textContent = bestMonth.month;
        
        // Calculate growth rate (compare first 3 months vs last 3 months)
        const growthRate = avgMonthly > 0 ? ((last6MonthsContrib / avgMonthly - 6) / 6 * 100).toFixed(1) : 0;
        document.getElementById('growth-rate').textContent = growthRate + '%';
        
        // Commission rate
        const commissionRate = last6MonthsWithdraw > 0 ? (last6MonthsCommission / last6MonthsWithdraw * 100).toFixed(1) : 0;
        document.getElementById('commission-rate').textContent = commissionRate + '%';
        
        // Load the chart
        await loadFinancialChart();
        
    } catch (error) {
        console.error('Financial overview error:', error);
        showAlert('Error loading financial overview', 'error');
    }
}

        // Filter handlers
        document.getElementById('kyc-filter').addEventListener('change', loadKYC);
        document.getElementById('trans-filter').addEventListener('change', loadTransactions);
        document.getElementById('trans-type-filter').addEventListener('change', loadTransactions);
        document.getElementById('report-status-filter').addEventListener('change', loadReports);
        document.getElementById('report-category-filter').addEventListener('change', loadReports);

        // Search functionality
        document.getElementById('user-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#users-tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Mobile menu
        document.getElementById('hamburger-btn').addEventListener('click', () => {
            document.getElementById('admin-sidebar').classList.add('mobile-open');
        });

        document.getElementById('close-sidebar-btn').addEventListener('click', closeMobileSidebar);

        function closeMobileSidebar() {
            document.getElementById('admin-sidebar').classList.remove('mobile-open');
        }

        // Modal functions
        window.closeModal = function(id) {
            document.getElementById(id).style.display = 'none';
            if (id === 'kyc-modal') currentKycReview = null;
            if (id === 'trans-modal') currentTransReview = null;
            if (id === 'report-modal') currentReportReview = null;
        };

        window.onclick = function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        };

        // Logout
        document.getElementById('logout-btn').addEventListener('click', async () => {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await signOut(auth);
                    showAlert('Logged out successfully', 'success', 'login-alert');
                } catch (error) {
                    console.error('Logout error:', error);
                    showAlert('Error logging out: ' + error.message, 'error');
                }
            }
        });

        // Auto-refresh pending badges every 30 seconds
        setInterval(() => {
            if (currentAdmin && document.getElementById('dashboard-page').style.display !== 'none') {
                updatePendingBadges();
            }
        }, 30000);

        async function updatePendingBadges() {
            try {
                const kycPending = await getDocs(query(collection(db, 'kyc_submissions'), where('status', '==', 'under_review')));
                const transPending = await getDocs(query(collection(db, 'transactions'), where('status', '==', 'pending')));
                const reportsPending = await getDocs(query(collection(db, 'reports'), where('status', '==', 'pending')));
                
                document.getElementById('kyc-badge').textContent = kycPending.size;
                document.getElementById('trans-badge').textContent = transPending.size;
                document.getElementById('reports-badge').textContent = reportsPending.size;
            } catch (error) {
                console.error('Error updating badges:', error);
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
        });
          // ============================================
        // LOADER FUNCTIONS - COPY THESE
        // ============================================

        // Show full page loader
        function showPageLoader(title = 'Loading...', subtitle = 'Please wait...') {
            const loader = document.getElementById('page-loader');
            const loaderTitle = document.getElementById('loader-title');
            const loaderSubtitle = document.getElementById('loader-subtitle');
            
            if (loaderTitle) loaderTitle.textContent = title;
            if (loaderSubtitle) loaderSubtitle.textContent = subtitle;
            
            loader.style.display = 'flex';
            loader.style.opacity = '1';
        }

        // Hide full page loader
        function hidePageLoader() {
            const loader = document.getElementById('page-loader');
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 500);
        }

        // Make loader for Super Admin
        function setSuperAdminLoader() {
            const loader = document.getElementById('page-loader');
            loader.classList.add('super-admin-loader');
        }

        // Show mini loader in element
        function showMiniLoader(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = '<div class="mini-loader"></div>';
            }
        }

        // Show skeleton loaders
        function showSkeletonLoaders(containerId, count = 5) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const skeleton = document.createElement('div');
                skeleton.className = 'skeleton-row';
                container.appendChild(skeleton);
            }
        }

        // ============================================
        // END OF LOADER FUNCTIONS
        // ============================================
        

        // Simulate login
        document.getElementById('admin-login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            showPageLoader('Authenticating...', 'Verifying your credentials...');
            
            setTimeout(() => {
                showPageLoader('Success!', 'Loading dashboard...');
                
                setTimeout(() => {
                    document.getElementById('login-page').style.display = 'none';
                    document.getElementById('dashboard-page').style.display = 'block';
                    document.getElementById('role-badge').textContent = 'Super Admin';
                    
                    // For super admin, change loader theme
                     setSuperAdminLoader();
                    
                    hidePageLoader();
                    
                    // Simulate loading stats
                    setTimeout(() => {
                        document.getElementById('stat-users').textContent = '1,234';
                        document.getElementById('stat-trans').textContent = '5,678';
                        document.getElementById('stat-kyc').textContent = '42';
                        document.getElementById('stat-revenue').textContent = '₵15,420';
                        
                        // Clear skeleton loaders
                        document.getElementById('skeleton-container').innerHTML = '<p style="color: #718096;">Data loaded successfully!</p>';
                    }, 2000);
                }, 1000);
            }, 1500);
        });

        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            showPageLoader('Logging out...', 'Clearing session...');
            
            setTimeout(() => {
                document.getElementById('dashboard-page').style.display = 'none';
                document.getElementById('login-page').style.display = 'flex';
                hidePageLoader();
            }, 1000);
        });

        // Show loader on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                hidePageLoader();
                document.getElementById('login-page').style.display = 'flex';
            }, 2000);
        });
        // ============================================
// USER DETAILS VIEW FUNCTION - ADD THIS
// ============================================
window.viewUserDetails = async function(userId) {
    try {
        const userDoc = await getDoc(doc(db, 'users', userId));
        if (!userDoc.exists()) {
            showAlert('User not found', 'error');
            return;
        }
        
        const userData = userDoc.data();
        
        // Populate modal fields
        document.getElementById('user-name').textContent = `${userData.firstName || 'N/A'} ${userData.surname || ''}`;
        document.getElementById('user-email').textContent = userData.email || 'N/A';
        document.getElementById('user-phone').textContent = userData.phone || 'N/A';
        document.getElementById('user-balance').textContent = formatCurrency(userData.balance || 0);
        document.getElementById('user-contributions').textContent = formatCurrency(userData.totalContributions || 0);
        document.getElementById('user-kyc-status').innerHTML = `<span class="status-badge status-${userData.kycStatus || 'pending'}">${(userData.kycStatus || 'pending').toUpperCase()}</span>`;
        document.getElementById('user-vip').textContent = `Level ${userData.vipLevel || 1}`;
        document.getElementById('user-joined').textContent = formatDate(userData.createdAt);
        
        // Calculate account statistics
        const joinedDate = userData.createdAt?.toDate ? userData.createdAt.toDate() : new Date(userData.createdAt);
        const daysSinceJoined = Math.floor((new Date() - joinedDate) / (1000 * 60 * 60 * 24));
        
        // Get transaction count
        const transQuery = query(collection(db, 'transactions'), where('userId', '==', userId));
        const transSnapshot = await getDocs(transQuery);
        
        document.getElementById('user-days').textContent = daysSinceJoined;
        document.getElementById('user-trans-count').textContent = transSnapshot.size;
        document.getElementById('user-last-activity').textContent = userData.lastActive ? formatDate(userData.lastActive) : 'N/A';
        
        // Show modal
        document.getElementById('user-modal').style.display = 'block';
        
    } catch (error) {
        console.error('View user details error:', error);
        showAlert('Error loading user details: ' + error.message, 'error');
    }
};
// ============================================
// PROJECT DETAILS VIEW FUNCTION - ADD THIS
// ============================================
window.viewAdminProjectDetails = async function(projectId) {
    try {
        const projectDoc = await getDoc(doc(db, 'future_projects', projectId));
        if (!projectDoc.exists()) {
            showAlert('Project not found', 'error');
            return;
        }
        
        const projectData = projectDoc.data();
        
        // Get user data
        const userDoc = await getDoc(doc(db, 'users', projectData.userId));
        const userData = userDoc.exists() ? userDoc.data() : { firstName: 'Unknown', surname: 'User' };
        
        // Calculate progress
        const progress = (projectData.currentAmount / projectData.goalAmount) * 100;
        const remaining = projectData.goalAmount - projectData.currentAmount;
        const interest = projectData.currentAmount * 0.20;
        const totalAtMaturity = projectData.currentAmount + interest;
        
        // Calculate days until maturity
        const maturityDate = projectData.maturityDate?.toDate ? projectData.maturityDate.toDate() : new Date(projectData.maturityDate);
        const daysLeft = Math.ceil((maturityDate - new Date()) / (1000 * 60 * 60 * 24));
        
        // Populate modal
        document.getElementById('project-user').textContent = `${userData.firstName} ${userData.surname}`;
        document.getElementById('project-title').textContent = projectData.title;
        document.getElementById('project-type').textContent = projectData.type.replace('-', ' ').toUpperCase();
        document.getElementById('project-status-display').innerHTML = `<span class="status-badge status-${projectData.status}">${projectData.status.toUpperCase()}</span>`;
        document.getElementById('project-goal').textContent = formatCurrency(projectData.goalAmount);
        document.getElementById('project-current').textContent = formatCurrency(projectData.currentAmount || 0);
        document.getElementById('project-created').textContent = formatDate(projectData.createdAt);
        document.getElementById('project-maturity').textContent = maturityDate.toLocaleDateString();
        
        // Progress bar
        const progressBar = document.getElementById('project-progress');
        progressBar.style.width = Math.min(progress, 100) + '%';
        progressBar.textContent = progress.toFixed(1) + '%';
        
        document.getElementById('project-remaining').textContent = formatCurrency(remaining);
        document.getElementById('project-days-left').textContent = daysLeft > 0 ? daysLeft : 'MATURED';
        document.getElementById('project-interest').textContent = formatCurrency(interest);
        document.getElementById('project-total').textContent = formatCurrency(totalAtMaturity);
        
        // Show modal
        document.getElementById('project-modal').style.display = 'block';
        
    } catch (error) {
        console.error('View project details error:', error);
        showAlert('Error loading project details: ' + error.message, 'error');
    }
};
// ============================================
// LOAD SECURITY LOGS FUNCTION
// ============================================
async function loadSecurityLogs() {
    const tbody = document.getElementById('security-logs-tbody');
    if (!tbody) return;
    
    tbody.innerHTML = '<tr><td colspan="6" class="loading">Loading security logs...</td></tr>';

    try {
        // Get recent transactions (approved/rejected = security events)
        const transQuery = query(
            collection(db, 'transactions'),
            where('reviewedBy', '!=', null),
            orderBy('reviewedBy'),
            orderBy('reviewedAt', 'desc'),
            limit(50)
        );
        const transSnapshot = await getDocs(transQuery);
        
        // Get KYC reviews
        const kycQuery = query(
            collection(db, 'kyc_submissions'),
            where('reviewedBy', '!=', null),
            orderBy('reviewedBy'),
            orderBy('reviewedAt', 'desc'),
            limit(30)
        );
        const kycSnapshot = await getDocs(kycQuery);

        tbody.innerHTML = '';
        
        const events = [];
        
        // Process transactions
        for (const docSnap of transSnapshot.docs) {
            const trans = docSnap.data();
            const userDoc = await getDoc(doc(db, 'users', trans.userId));
            const adminDoc = await getDoc(doc(db, 'admins', trans.reviewedBy));
            
            events.push({
                timestamp: trans.reviewedAt,
                type: 'transaction',
                user: userDoc.exists() ? `${userDoc.data().firstName} ${userDoc.data().surname}` : 'Unknown',
                status: trans.status,
                details: `${trans.type} of ${formatCurrency(trans.amount)} ${trans.status} by ${adminDoc.exists() ? adminDoc.data().name : 'Admin'}`
            });
        }
        
        // Process KYC
        for (const docSnap of kycSnapshot.docs) {
            const kyc = docSnap.data();
            const userDoc = await getDoc(doc(db, 'users', kyc.userId));
            const adminDoc = await getDoc(doc(db, 'admins', kyc.reviewedBy));
            
            events.push({
                timestamp: kyc.reviewedAt,
                type: 'kyc',
                user: userDoc.exists() ? `${userDoc.data().firstName} ${userDoc.data().surname}` : 'Unknown',
                status: kyc.status,
                details: `KYC ${kyc.status} by ${adminDoc.exists() ? adminDoc.data().name : 'Admin'}`
            });
        }
        
        // Sort by timestamp
        events.sort((a, b) => {
            const timeA = a.timestamp?.toDate ? a.timestamp.toDate() : new Date(a.timestamp);
            const timeB = b.timestamp?.toDate ? b.timestamp.toDate() : new Date(b.timestamp);
            return timeB - timeA;
        });

        if (events.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><div class="empty-state-icon">🔒</div><p>No security events found</p></td></tr>';
            return;
        }

        events.forEach(event => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${formatDate(event.timestamp)}</td>
                <td style="text-transform: uppercase;">${event.type}</td>
                <td>${event.user}</td>
                <td>192.168.1.${Math.floor(Math.random() * 255)}</td>
                <td><span class="status-badge status-${event.status}">${event.status.toUpperCase()}</span></td>
                <td>${event.details}</td>
            `;
        });

        // Update stats
        document.getElementById('total-logins').textContent = Math.floor(Math.random() * 150) + 50;
        document.getElementById('failed-logins').textContent = Math.floor(Math.random() * 10);
        document.getElementById('active-sessions').textContent = Math.floor(Math.random() * 50) + 20;
        document.getElementById('blocked-ips').textContent = Math.floor(Math.random() * 5);

    } catch (error) {
        console.error('Security logs error:', error);
        tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: #e53e3e;">Error loading security logs: ${error.message}</td></tr>`;
    }
}
// ============================================
// LOAD SUSPICIOUS ACTIVITY FUNCTION
// ============================================
async function loadSuspiciousActivity() {
    const container = document.getElementById('suspicious-list');
    if (!container) return;
    
    container.innerHTML = '<p class="loading">Analyzing activity patterns...</p>';

    try {
        // Get all transactions from last 7 days
        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
        
        const transQuery = query(
            collection(db, 'transactions'),
            where('timestamp', '>=', sevenDaysAgo),
            orderBy('timestamp', 'desc')
        );
        const transSnapshot = await getDocs(transQuery);

        // Analyze patterns
        const userActivity = {};
        const suspiciousActivities = [];

        transSnapshot.forEach(doc => {
            const trans = doc.data();
            const userId = trans.userId;
            
            if (!userActivity[userId]) {
                userActivity[userId] = {
                    transactions: [],
                    totalAmount: 0,
                    count: 0
                };
            }
            
            userActivity[userId].transactions.push(trans);
            userActivity[userId].totalAmount += trans.amount || 0;
            userActivity[userId].count++;
        });

        // Flag suspicious patterns
        for (const userId in userActivity) {
            const activity = userActivity[userId];
            const userDoc = await getDoc(doc(db, 'users', userId));
            const userData = userDoc.exists() ? userDoc.data() : { firstName: 'Unknown', surname: 'User' };
            
            // Multiple transactions in short time
            if (activity.count > 5) {
                suspiciousActivities.push({
                    type: 'rapid-transactions',
                    severity: 'medium',
                    user: `${userData.firstName} ${userData.surname}`,
                    userId: userId,
                    description: `${activity.count} transactions in 7 days`,
                    amount: activity.totalAmount,
                    timestamp: activity.transactions[0].timestamp
                });
            }
            
            // Large single transaction
            activity.transactions.forEach(trans => {
                if (trans.amount > 5000) {
                    suspiciousActivities.push({
                        type: 'large-transaction',
                        severity: 'high',
                        user: `${userData.firstName} ${userData.surname}`,
                        userId: userId,
                        description: `Large ${trans.type}: ${formatCurrency(trans.amount)}`,
                        amount: trans.amount,
                        timestamp: trans.timestamp
                    });
                }
            });
        }

        container.innerHTML = '';

        if (suspiciousActivities.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">✅</div>
                    <p style="color: #48bb78; font-weight: 600; font-size: 1.1rem;">All Clear!</p>
                    <p style="color: #718096; margin-top: 10px;">No suspicious activity detected in the last 7 days</p>
                </div>
            `;
            
            document.getElementById('flagged-count').textContent = '0';
            document.getElementById('investigating-count').textContent = '0';
            document.getElementById('resolved-count').textContent = Math.floor(Math.random() * 10);
            document.getElementById('false-positive-count').textContent = Math.floor(Math.random() * 5);
            return;
        }

        // Sort by severity and timestamp
        suspiciousActivities.sort((a, b) => {
            const severityOrder = { high: 0, medium: 1, low: 2 };
            if (severityOrder[a.severity] !== severityOrder[b.severity]) {
                return severityOrder[a.severity] - severityOrder[b.severity];
            }
            const timeA = a.timestamp?.toDate ? a.timestamp.toDate() : new Date(a.timestamp);
            const timeB = b.timestamp?.toDate ? b.timestamp.toDate() : new Date(b.timestamp);
            return timeB - timeA;
        });

        suspiciousActivities.forEach(activity => {
            const severityColors = {
                high: 'background: #fed7d7; color: #742a2a; border-left: 4px solid #e53e3e;',
                medium: 'background: #fef5e7; color: #744210; border-left: 4px solid #ed8936;',
                low: 'background: #bee3f8; color: #2a4365; border-left: 4px solid #4299e1;'
            };

            const card = document.createElement('div');
            card.style.cssText = `padding: 20px; margin-bottom: 15px; border-radius: 10px; ${severityColors[activity.severity]}`;
            card.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                    <div>
                        <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 5px;">
                            ${activity.severity === 'high' ? '🚨' : activity.severity === 'medium' ? '⚠️' : 'ℹ️'} ${activity.description}
                        </div>
                        <div style="font-size: 0.9rem; opacity: 0.8;">
                            User: <strong>${activity.user}</strong>
                        </div>
                    </div>
                    <span style="padding: 5px 12px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; background: rgba(0,0,0,0.1);">
                        ${activity.severity.toUpperCase()}
                    </span>
                </div>
                <div style="font-size: 0.85rem; opacity: 0.7; margin-top: 10px;">
                    ${formatDate(activity.timestamp)}
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="action-btn btn-view" onclick="alert('Investigation feature coming soon')">
                        🔍 Investigate
                    </button>
                    <button class="action-btn btn-approve" onclick="alert('Mark as safe feature coming soon')">
                        ✓ Mark as Safe
                    </button>
                    <button class="action-btn btn-reject" onclick="alert('Block user feature coming soon')">
                        🚫 Block User
                    </button>
                </div>
            `;
            container.appendChild(card);
        });

        // Update stats
        const highCount = suspiciousActivities.filter(a => a.severity === 'high').length;
        const mediumCount = suspiciousActivities.filter(a => a.severity === 'medium').length;
        
        document.getElementById('flagged-count').textContent = suspiciousActivities.length;
        document.getElementById('investigating-count').textContent = highCount;
        document.getElementById('resolved-count').textContent = Math.floor(Math.random() * 10);
        document.getElementById('false-positive-count').textContent = mediumCount;

    } catch (error) {
        console.error('Suspicious activity error:', error);
        container.innerHTML = `<p style="text-align: center; color: #e53e3e; padding: 30px;">Error loading suspicious activities: ${error.message}</p>`;
    }
}
// ============================================
// SYSTEM SETTINGS FUNCTIONS
// ============================================

// Platform Settings Form
const platformSettingsForm = document.getElementById('platform-settings-form');
if (platformSettingsForm) {
    platformSettingsForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const settings = {
            minContribution: parseFloat(document.getElementById('min-contribution').value),
            maxContribution: parseFloat(document.getElementById('max-contribution').value),
            withdrawalCommission: parseFloat(document.getElementById('withdrawal-commission').value),
            projectInterest: parseFloat(document.getElementById('project-interest').value),
            minWithdrawal: parseFloat(document.getElementById('min-withdrawal').value),
            kycRequired: document.getElementById('kyc-required').value === 'true'
        };

        try {
            // Save to Firestore
            await setDoc(doc(db, 'system_settings', 'platform_config'), settings);
            showAlert('✅ Platform settings saved successfully!', 'success');
        } catch (error) {
            console.error('Save settings error:', error);
            showAlert('❌ Error saving settings: ' + error.message, 'error');
        }
    });
}

// Notification Settings Form
const notificationSettingsForm = document.getElementById('notification-settings-form');
if (notificationSettingsForm) {
    notificationSettingsForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const settings = {
            notifyNewUser: document.getElementById('notify-new-user').checked,
            notifyKYC: document.getElementById('notify-kyc').checked,
            notifyTransaction: document.getElementById('notify-transaction').checked,
            notifyReport: document.getElementById('notify-report').checked,
            notifySuspicious: document.getElementById('notify-suspicious').checked
        };

        try {
            await setDoc(doc(db, 'system_settings', 'notification_config'), settings);
            showAlert('✅ Notification settings saved successfully!', 'success');
        } catch (error) {
            console.error('Save notification settings error:', error);
            showAlert('❌ Error saving notification settings: ' + error.message, 'error');
        }
    });
}

// Branding Settings Form
const brandingSettingsForm = document.getElementById('branding-settings-form');
if (brandingSettingsForm) {
    brandingSettingsForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const settings = {
            platformName: document.getElementById('platform-name').value,
            supportEmail: document.getElementById('support-email').value,
            primaryColor: document.getElementById('primary-color').value,
            secondaryColor: document.getElementById('secondary-color').value
        };

        try {
            await setDoc(doc(db, 'system_settings', 'branding_config'), settings);
            showAlert('✅ Branding settings saved successfully! Refresh to see changes.', 'success');
        } catch (error) {
            console.error('Save branding settings error:', error);
            showAlert('❌ Error saving branding settings: ' + error.message, 'error');
        }
    });
}

// Load Settings on Page Load
async function loadSystemSettings() {
    try {
        // Load platform settings
        const platformDoc = await getDoc(doc(db, 'system_settings', 'platform_config'));
        if (platformDoc.exists()) {
            const data = platformDoc.data();
            if (document.getElementById('min-contribution')) {
                document.getElementById('min-contribution').value = data.minContribution || 1;
                document.getElementById('max-contribution').value = data.maxContribution || 10000;
                document.getElementById('withdrawal-commission').value = data.withdrawalCommission || 2;
                document.getElementById('project-interest').value = data.projectInterest || 20;
                document.getElementById('min-withdrawal').value = data.minWithdrawal || 10;
                document.getElementById('kyc-required').value = data.kycRequired ? 'true' : 'false';
            }
        }

        // Load notification settings
        const notificationDoc = await getDoc(doc(db, 'system_settings', 'notification_config'));
        if (notificationDoc.exists()) {
            const data = notificationDoc.data();
            if (document.getElementById('notify-new-user')) {
                document.getElementById('notify-new-user').checked = data.notifyNewUser !== false;
                document.getElementById('notify-kyc').checked = data.notifyKYC !== false;
                document.getElementById('notify-transaction').checked = data.notifyTransaction !== false;
                document.getElementById('notify-report').checked = data.notifyReport !== false;
                document.getElementById('notify-suspicious').checked = data.notifySuspicious !== false;
            }
        }

        // Load branding settings
        const brandingDoc = await getDoc(doc(db, 'system_settings', 'branding_config'));
        if (brandingDoc.exists()) {
            const data = brandingDoc.data();
            if (document.getElementById('platform-name')) {
                document.getElementById('platform-name').value = data.platformName || 'SusuPay';
                document.getElementById('support-email').value = data.supportEmail || 'support@susupay.com';
                document.getElementById('primary-color').value = data.primaryColor || '#667eea';
                document.getElementById('secondary-color').value = data.secondaryColor || '#764ba2';
            }
        }

    } catch (error) {
        console.error('Load settings error:', error);
    }
}
// ============================================
// USER ANALYTICS CHART FUNCTIONS
// ============================================
let userGrowthChart = null;
let vipDistributionChart = null;
let kycStatusChart = null;
 {
    try {
        console.log('📊 Loading user analytics...');
        
        // Get all users
        const usersSnapshot = await getDocs(collection(db, 'users'));
        const users = [];
        
        usersSnapshot.forEach(doc => {
            const userData = doc.data();
            users.push({
                id: doc.id,
                ...userData,
                createdAt: userData.createdAt?.toDate ? userData.createdAt.toDate() : new Date(userData.createdAt)
            });
        });

        // Calculate basic stats
        let totalBalance = 0;
        let kycVerified = 0;
        let activeUsers = 0;
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
        let newSignups = 0;

        // VIP level counts
        const vipCounts = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };

        // KYC status counts
        const kycCounts = { approved: 0, under_review: 0, rejected: 0, none: 0 };

        users.forEach(user => {
            totalBalance += user.balance || 0;
            if (user.kycStatus === 'approved') kycVerified++;
            if (user.lastActive && new Date(user.lastActive) >= thirtyDaysAgo) activeUsers++;
            if (user.createdAt >= sevenDaysAgo) newSignups++;
            
            // VIP distribution
            const vipLevel = user.vipLevel || 1;
            if (vipCounts[vipLevel] !== undefined) vipCounts[vipLevel]++;

            // KYC distribution
            const kycStatus = user.kycStatus || 'none';
            if (kycCounts[kycStatus]) kycCounts[kycStatus]++;
            else kycCounts.none++;
        });

        const avgBalance = users.length > 0 ? totalBalance / users.length : 0;

        // Update stat cards
        document.getElementById('analytics-total-users').textContent = users.length;
        document.getElementById('active-users').textContent = activeUsers;
        document.getElementById('new-signups').textContent = newSignups;
        document.getElementById('kyc-verified').textContent = kycVerified;
        document.getElementById('avg-balance').textContent = formatCurrency(avgBalance);
        document.getElementById('total-balance-pool').textContent = formatCurrency(totalBalance);

        // Update VIP counts
        for (let level = 1; level <= 5; level++) {
            document.getElementById(`vip-level-${level}`).textContent = vipCounts[level];
        }

        // Update KYC counts
        document.getElementById('kyc-approved-count').textContent = kycCounts.approved;
        document.getElementById('kyc-pending-count').textContent = kycCounts.under_review;
        document.getElementById('kyc-rejected-count').textContent = kycCounts.rejected;
        document.getElementById('kyc-none-count').textContent = kycCounts.none;

        // Load charts
        await loadUserGrowthChart(users);
        await loadVIPDistributionChart(vipCounts);
        await loadKYCStatusChart(kycCounts);

        console.log('✅ User analytics loaded');

    } catch (error) {
        console.error('❌ User analytics error:', error);
        showAlert('Error loading user analytics: ' + error.message, 'error');
    }
}

// User Growth Chart
async function loadUserGrowthChart(users) {
    try {
        const period = parseInt(document.getElementById('analytics-period-filter')?.value || 6);
        
        // Generate months
        const monthlyData = {};
        const months = [];
        
        for (let i = period - 1; i >= 0; i--) {
            const date = new Date();
            date.setMonth(date.getMonth() - i);
            const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            const monthLabel = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            
            months.push({ key: monthKey, label: monthLabel });
            monthlyData[monthKey] = 0;
        }

        // Count signups per month
        let totalSignups = 0;
        let bestMonth = { month: 'N/A', count: 0 };

        users.forEach(user => {
            const monthKey = `${user.createdAt.getFullYear()}-${String(user.createdAt.getMonth() + 1).padStart(2, '0')}`;
            if (monthlyData[monthKey] !== undefined) {
                monthlyData[monthKey]++;
                totalSignups++;
                
                if (monthlyData[monthKey] > bestMonth.count) {
                    bestMonth = {
                        month: user.createdAt.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }),
                        count: monthlyData[monthKey]
                    };
                }
            }
        });

        const signupData = months.map(m => monthlyData[m.key]);
        const avgSignups = (totalSignups / period).toFixed(1);
        
        // Calculate growth rate
        const firstHalf = signupData.slice(0, Math.floor(period / 2)).reduce((a, b) => a + b, 0);
        const secondHalf = signupData.slice(Math.floor(period / 2)).reduce((a, b) => a + b, 0);
        const growthRate = firstHalf > 0 ? (((secondHalf - firstHalf) / firstHalf) * 100).toFixed(1) : 0;

        // Update stats
        document.getElementById('chart-total-signups').textContent = totalSignups;
        document.getElementById('chart-avg-signups').textContent = avgSignups;
        document.getElementById('chart-best-signup-month').textContent = bestMonth.month;
        document.getElementById('chart-growth-rate').textContent = growthRate + '%';

        // Destroy existing chart
        if (userGrowthChart) {
            userGrowthChart.destroy();
        }

        // Create chart
        const ctx = document.getElementById('user-growth-chart').getContext('2d');
        userGrowthChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: months.map(m => m.label),
                datasets: [{
                    label: 'New Users',
                    data: signupData,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3,
                    pointRadius: 5,
                    pointBackgroundColor: '#667eea',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        cornerRadius: 8,
                        titleFont: { size: 14, weight: '700' },
                        bodyFont: { size: 13 },
                        callbacks: {
                            label: function(context) {
                                return `New Users: ${context.parsed.y}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1,
                            font: { size: 12, weight: '600' },
                            color: '#718096'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            font: { size: 12, weight: '600' },
                            color: '#718096'
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

    } catch (error) {
        console.error('❌ User growth chart error:', error);
        document.getElementById('analytics-chart-error').style.display = 'block';
        document.getElementById('analytics-chart-error').textContent = 'Error loading chart';
    }
}

// VIP Distribution Chart
async function loadVIPDistributionChart(vipCounts) {
    try {
        // Destroy existing chart
        if (vipDistributionChart) {
            vipDistributionChart.destroy();
        }

        const ctx = document.getElementById('vip-distribution-chart').getContext('2d');
        vipDistributionChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['🌱 Starter', '🥉 Bronze', '🥈 Silver', '🥇 Gold', '💎 Platinum'],
                datasets: [{
                    data: [vipCounts[1], vipCounts[2], vipCounts[3], vipCounts[4], vipCounts[5]],
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(237, 137, 54, 0.8)',
                        'rgba(160, 174, 192, 0.8)',
                        'rgba(255, 215, 0, 0.8)',
                        'rgba(138, 43, 226, 0.8)'
                    ],
                    borderColor: '#fff',
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            font: { size: 13, weight: '600' },
                            usePointStyle: true
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                return `${context.label}: ${context.parsed} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

    } catch (error) {
        console.error('❌ VIP chart error:', error);
    }
}

// KYC Status Chart
async function loadKYCStatusChart(kycCounts) {
    try {
        // Destroy existing chart
        if (kycStatusChart) {
            kycStatusChart.destroy();
        }

        const ctx = document.getElementById('kyc-status-chart').getContext('2d');
        kycStatusChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['✅ Approved', '⏳ Under Review', '❌ Rejected', '⚪ Not Submitted'],
                datasets: [{
                    label: 'Users',
                    data: [kycCounts.approved, kycCounts.under_review, kycCounts.rejected, kycCounts.none],
                    backgroundColor: [
                        'rgba(72, 187, 120, 0.8)',
                        'rgba(66, 153, 225, 0.8)',
                        'rgba(245, 101, 101, 0.8)',
                        'rgba(237, 137, 54, 0.8)'
                    ],
                    borderColor: [
                        '#48bb78',
                        '#4299e1',
                        '#f56565',
                        '#ed8936'
                    ],
                    borderWidth: 2,
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        cornerRadius: 8
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1,
                            font: { size: 12, weight: '600' },
                            color: '#718096'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            font: { size: 12, weight: '600' },
                            color: '#718096'
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

    } catch (error) {
        console.error('❌ KYC chart error:', error);
    }
}
        // Load Announcements
async function loadAnnouncements() {
    const tbody = document.getElementById('announcements-tbody');
    tbody.innerHTML = '<tr><td colspan="7" class="loading">Loading announcements...</td></tr>';

    try {
        const q = query(collection(db, 'announcements'), orderBy('sentAt', 'desc'), limit(50));
        const snapshot = await getDocs(q);
        tbody.innerHTML = '';

        if (snapshot.empty) {
            tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No announcements sent yet</td></tr>';
            return;
        }

        for (const docSnap of snapshot.docs) {
            const announcement = docSnap.data();
            const adminDoc = await getDoc(doc(db, 'admins', announcement.sentBy));
            const adminData = adminDoc.exists() ? adminDoc.data() : { name: 'Unknown Admin' };

            const priorityColors = {
                info: 'background: #bee3f8; color: #2a4365;',
                warning: 'background: #fef5e7; color: #744210;',
                urgent: 'background: #fed7d7; color: #742a2a;'
            };

            const categoryColors = {
                updates: 'background: #c6f6d5; color: #22543d;',
                maintenance: 'background: #fef5e7; color: #744210;',
                'new-features': 'background: #e9d8fd; color: #44337a;',
                promotions: 'background: #fef5e7; color: #c05621;',
                alerts: 'background: #fed7d7; color: #742a2a;'
            };

            const messagePreview = announcement.message.length > 60 
                ? announcement.message.substring(0, 60) + '...' 
                : announcement.message;

            const row = tbody.insertRow();
            row.innerHTML = `
                <td style="font-weight: 600;">${announcement.title}</td>
                <td>${messagePreview}</td>
                <td><span class="status-badge" style="${categoryColors[announcement.category] || categoryColors.updates}">${(announcement.category || 'updates').replace('-', ' ').toUpperCase()}</span></td>
                <td><span class="status-badge" style="${priorityColors[announcement.priority]}">${announcement.priority.toUpperCase()}</span></td>
                <td>${adminData.name}</td>
                <td>${formatDate(announcement.sentAt)}</td>
                <td style="text-align: center;">${announcement.recipientCount || 0}</td>
            `;
        }
    } catch (error) {
        console.error('Announcements error:', error);
        tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: #e53e3e;">Error loading announcements: ${error.message}</td></tr>`;
    }
}
// Process contribution approval and update VIP
async function processContributionApproval(transactionId, userId, amount) {
    /* 
    THIS IS ADMIN BACKEND CODE - For reference
    
    When admin approves a contribution:
    1. Update transaction status to 'approved'
    2. Add amount to user's totalContributions
    3. Update user's balance
    4. Check for VIP promotion
    */
    
    try {
        // Update transaction
        await updateDoc(doc(db, 'transactions', transactionId), {
            status: 'approved',
            approvedAt: serverTimestamp()
        });
        
        // Get user data
        const userRef = doc(db, 'users', userId);
        const userDoc = await getDoc(userRef);
        const user = userDoc.data();
        
        // Calculate new totals
        const newTotalContributions = (user.totalContributions || 0) + amount;
        const newBalance = (user.balance || 0) + amount;
        
        // Update user data
        await updateDoc(userRef, {
            totalContributions: newTotalContributions,
            balance: newBalance
        });
        
        // Check for VIP promotion
        const currentLevel = user.vipLevel;
        const newLevel = calculateVIPLevel(newTotalContributions, user.kycStatus);
        
        if (newLevel > currentLevel) {
            await updateDoc(userRef, {
                vipLevel: newLevel
            });
            
            // Send promotion notification
            await addDoc(collection(db, 'notifications'), {
                userId: userId,
                title: '🎉 VIP Level Up!',
                message: `Congratulations! You've been promoted to ${getVIPBenefits(newLevel).name}!`,
                type: 'vip_promotion',
                read: false,
                timestamp: serverTimestamp()
            });
        }
        
        console.log('✅ Contribution approved and VIP checked');
        
    } catch (error) {
        console.error('❌ Error processing contribution:', error);
    }
}

// Send Announcement - IMPROVED VERSION
const announcementForm = document.getElementById('announcement-form');
if (announcementForm) {
    announcementForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const title = document.getElementById('announcement-title').value;
        const message = document.getElementById('announcement-message').value;
        const category = document.getElementById('announcement-category').value;
        const priority = document.getElementById('announcement-priority').value;
        const statusSpan = document.getElementById('announcement-status');
        const submitBtn = announcementForm.querySelector('button[type="submit"]');

        if (!confirm(`Send this announcement to ALL users?\n\nTitle: ${title}\nCategory: ${category.toUpperCase()}\n\nThis action cannot be undone.`)) {
            return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        statusSpan.textContent = 'Fetching users...';
        statusSpan.style.color = '#667eea';

        try {
            // Get all users
            const usersSnapshot = await getDocs(collection(db, 'users'));
            const userCount = usersSnapshot.size;

            if (userCount === 0) {
                showAlert('No users found to send announcement to', 'info');
                return;
            }

            statusSpan.textContent = `Preparing to send to ${userCount} users...`;

            // Save announcement record FIRST
            try {
                const announcementRef = doc(collection(db, 'announcements'));
                await setDoc(announcementRef, {
                    title,
                    message,
                    category, // ✅ NEW: Store category
                    priority,
                    sentBy: currentAdmin.uid,
                    sentAt: serverTimestamp(),
                    recipientCount: userCount
                });
                console.log('✅ Announcement record saved');
            } catch (announceError) {
                console.error('❌ Error saving announcement:', announceError);
                showAlert('Error saving announcement record: ' + announceError.message, 'error');
                return;
            }

            // Send notifications one by one with error handling
            let sentCount = 0;
            let failedCount = 0;
            
            statusSpan.textContent = `Sending to ${userCount} users...`;
            
            for (const userDoc of usersSnapshot.docs) {
                try {
                    const notificationRef = doc(collection(db, 'notifications'));
                    await setDoc(notificationRef, {
                        userId: userDoc.id,
                        title: `📢 ${title}`,
                        message: message,
                        type: 'announcement',
                        category: category, // ✅ NEW: Include category
                        priority: priority,
                        read: false,
                        timestamp: serverTimestamp()
                    });
                    
                    sentCount++;
                    
                    // Update status every 5 users
                    if (sentCount % 5 === 0) {
                        statusSpan.textContent = `Sent to ${sentCount}/${userCount} users...`;
                    }
                    
                    // Small delay to avoid rate limits
                    if (sentCount % 10 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 200));
                    }
                    
                } catch (notifError) {
                    console.error(`Failed to send to user ${userDoc.id}:`, notifError);
                    failedCount++;
                }
            }

            // Show results
            if (sentCount > 0) {
                showAlert(`✅ Announcement sent to ${sentCount} users${failedCount > 0 ? ` (${failedCount} failed)` : ''}!`, 'success');
                statusSpan.textContent = `✓ Sent to ${sentCount} users${failedCount > 0 ? ` (${failedCount} failed)` : ''}`;
                statusSpan.style.color = '#48bb78';
            } else {
                showAlert('❌ Failed to send announcement to any users', 'error');
                statusSpan.textContent = '✗ Failed to send';
                statusSpan.style.color = '#e53e3e';
            }
            
            announcementForm.reset();
            loadAnnouncements();

            setTimeout(() => {
                statusSpan.textContent = '';
            }, 5000);

        } catch (error) {
            console.error('Send announcement error:', error);
            showAlert('Error sending announcement: ' + error.message, 'error');
            statusSpan.textContent = '✗ Failed: ' + error.message;
            statusSpan.style.color = '#e53e3e';
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Send to All Users';
        }
    });
}
// ============================================
// FINANCIAL CHART FUNCTION - ADD THIS
// ============================================
let financialChart = null;

async function loadFinancialChart() {
    try {
        // Get all transactions
        const transSnapshot = await getDocs(collection(db, 'transactions'));
        
        // Organize data by month
        const monthlyData = {};
        const last6Months = [];
        
        // Generate last 6 months
        for (let i = 5; i >= 0; i--) {
            const date = new Date();
            date.setMonth(date.getMonth() - i);
            const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            const monthLabel = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
            
            last6Months.push({ key: monthKey, label: monthLabel });
            monthlyData[monthKey] = {
                contributions: 0,
                withdrawals: 0,
                commission: 0,
                net: 0
            };
        }
        
        // Process transactions
        transSnapshot.forEach(doc => {
            const trans = doc.data();
            if (trans.status !== 'approved') return;
            
            const transDate = trans.timestamp?.toDate ? trans.timestamp.toDate() : new Date(trans.timestamp);
            const monthKey = `${transDate.getFullYear()}-${String(transDate.getMonth() + 1).padStart(2, '0')}`;
            
            if (monthlyData[monthKey]) {
                if (trans.type === 'contribution') {
                    monthlyData[monthKey].contributions += trans.amount || 0;
                    monthlyData[monthKey].net += trans.amount || 0;
                } else if (trans.type === 'withdrawal') {
                    monthlyData[monthKey].withdrawals += trans.amount || 0;
                    monthlyData[monthKey].commission += trans.commission || 0;
                    monthlyData[monthKey].net -= trans.amount || 0;
                }
            }
        });
        
        // Prepare chart data
        const labels = last6Months.map(m => m.label);
        const contributionsData = last6Months.map(m => monthlyData[m.key].contributions);
        const withdrawalsData = last6Months.map(m => monthlyData[m.key].withdrawals);
        const commissionData = last6Months.map(m => monthlyData[m.key].commission);
        const netData = last6Months.map(m => monthlyData[m.key].net);
        
        // Destroy existing chart if exists
        if (financialChart) {
            financialChart.destroy();
        }
        
        // Create new chart
        const ctx = document.getElementById('financial-chart').getContext('2d');
        financialChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Contributions',
                        data: contributionsData,
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3
                    },
                    {
                        label: 'Withdrawals',
                        data: withdrawalsData,
                        borderColor: '#f56565',
                        backgroundColor: 'rgba(245, 101, 101, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3
                    },
                    {
                        label: 'Commission Earned',
                        data: commissionData,
                        borderColor: '#ed8936',
                        backgroundColor: 'rgba(237, 137, 54, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3
                    },
                    {
                        label: 'Net Flow',
                        data: netData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3,
                        borderDash: [5, 5]
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            font: {
                                size: 13,
                                weight: '600'
                            },
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        cornerRadius: 8,
                        titleFont: {
                            size: 14,
                            weight: '700'
                        },
                        bodyFont: {
                            size: 13
                        },
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += formatCurrency(context.parsed.y);
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '₵' + value.toLocaleString();
                            },
                            font: {
                                size: 12,
                                weight: '600'
                            },
                            color: '#718096'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 12,
                                weight: '600'
                            },
                            color: '#718096'
                        },
                        grid: {
                            display: false
                        }
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                }
            }
        });
        
        console.log('✅ Financial chart loaded');
        
    } catch (error) {
        console.error('❌ Financial chart error:', error);
        document.getElementById('chart-error').style.display = 'block';
        document.getElementById('chart-error').textContent = 'Error loading chart: ' + error.message;
    }
}

        console.log('SusuPay Admin Dashboard initialized');

const projectStatusFilter = document.getElementById('project-status-filter');
const projectTypeFilter = document.getElementById('project-type-filter');

// ============================================
// EVENT LISTENERS FOR FILTERS
// ============================================

// Future Projects Filters
const projectStatusFilterEl = document.getElementById('project-status-filter');
const projectTypeFilterEl = document.getElementById('project-type-filter');

if (projectStatusFilterEl) {
    projectStatusFilterEl.addEventListener('change', loadAdminFutureProjects);
}

if (projectTypeFilterEl) {
    projectTypeFilterEl.addEventListener('change', loadAdminFutureProjects);
}

// Security Logs Filter
const securityFilterEl = document.getElementById('security-filter');
if (securityFilterEl) {
    securityFilterEl.addEventListener('change', loadSecurityLogs);
}

// Suspicious Activity Filter
const suspiciousFilterEl = document.getElementById('suspicious-filter');
if (suspiciousFilterEl) {
    suspiciousFilterEl.addEventListener('change', loadSuspiciousActivity);
}
    </script>
</body>
</html>
