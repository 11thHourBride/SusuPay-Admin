<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SusuPay Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Login Page */
        .login-page {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
        }

        .admin-logo {
            text-align: center;
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .login-title {
            color: #4a5568;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .login-subtitle {
            color: #718096;
            margin-bottom: 40px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Dashboard Layout */
        .dashboard-page {
            display: none;
        }

        .admin-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .hamburger-btn {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .hamburger-btn:hover {
            background: #f7fafc;
        }

        .hamburger-btn svg {
            width: 24px;
            height: 24px;
            stroke: #4a5568;
        }

        .admin-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a5568;
        }

        .admin-role-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .role-super {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .role-main {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .role-senior {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .role-financial {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .role-support {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .role-security {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .role-operations {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #4a5568;
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .logout-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c53030;
        }

        /* Sidebar */
        .admin-sidebar {
            position: fixed;
            left: 0;
            top: 70px;
            bottom: 0;
            width: 280px;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            z-index: 900;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            display: none;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            align-items: center;
            justify-content: space-between;
        }

        .close-sidebar-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .close-sidebar-btn:hover {
            background: #f7fafc;
        }

        .close-sidebar-btn svg {
            width: 24px;
            height: 24px;
            stroke: #4a5568;
        }

        .sidebar-section {
            padding: 20px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .sidebar-section-title {
            padding: 10px 25px;
            font-size: 0.75rem;
            font-weight: 700;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sidebar-nav-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            color: #4a5568;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-weight: 500;
        }

        .sidebar-nav-item:hover {
            background: #f7fafc;
            border-left-color: #667eea;
            color: #667eea;
        }

        .sidebar-nav-item.active {
            background: #ebf8ff;
            border-left-color: #667eea;
            color: #667eea;
        }

        .nav-icon {
            font-size: 1.3rem;
        }

        .pending-badge {
            margin-left: auto;
            background: #e53e3e;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Super Admin Theme */
        .super-admin-sidebar {
            background: linear-gradient(180deg, #2d3748 0%, #1a202c 100%);
        }

        .super-admin-sidebar .sidebar-section-title {
            color: #ffd700;
        }

        .super-admin-sidebar .sidebar-nav-item {
            color: #e2e8f0;
        }

        .super-admin-sidebar .sidebar-nav-item:hover {
            background: rgba(255, 215, 0, 0.1);
            border-left-color: #ffd700;
            color: #ffd700;
        }

        .super-admin-sidebar .sidebar-nav-item.active {
            background: rgba(255, 215, 0, 0.2);
            border-left-color: #ffd700;
            color: #ffd700;
        }

        .super-admin-header {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
        }

        /* Main Content */
        .admin-main {
            margin-left: 280px;
            margin-top: 70px;
            padding: 30px;
            min-height: calc(100vh - 70px);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #667eea;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #4a5568;
        }

        .stat-change {
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .stat-change.positive {
            color: #48bb78;
        }

        /* Content Card */
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f7fafc;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4a5568;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-select, .search-input {
            padding: 8px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #4a5568;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: #f7fafc;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f7fafc;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: #fef5e7;
            color: #744210;
        }

        .status-approved {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-rejected {
            background: #fed7d7;
            color: #742a2a;
        }

        .status-under-review, .status-under_review {
            background: #bee3f8;
            color: #2a4365;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 5px;
        }

        .btn-view {
            background: #ebf8ff;
            color: #2b6cb0;
        }

        .btn-approve {
            background: #c6f6d5;
            color: #22543d;
        }

        .btn-reject {
            background: #fed7d7;
            color: #742a2a;
        }

        .btn-danger {
            background: #fed7d7;
            color: #742a2a;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            color: #4a5568;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 20px;
        }

        .document-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .document-preview img {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .user-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .detail-item {
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .detail-label {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1rem;
            font-weight: 600;
            color: #4a5568;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .alert-error {
            background: #fed7d7;
            color: #742a2a;
        }

        .alert-info {
            background: #bee3f8;
            color: #2a4365;
        }

        .hidden {
            display: none;
        }

        /* Activity Timeline */
        .activity-timeline {
            position: relative;
            padding-left: 30px;
        }

        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e2e8f0;
        }

        .activity-item {
            position: relative;
            margin-bottom: 25px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 3px solid #667eea;
        }

        .activity-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #718096;
            margin-bottom: 5px;
        }

        .activity-description {
            color: #4a5568;
            font-weight: 500;
        }

        .activity-user {
            color: #667eea;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hamburger-btn {
                display: block;
            }

            .admin-sidebar {
                transform: translateX(-100%);
            }

            .admin-sidebar.mobile-open {
                transform: translateX(0);
            }

            .sidebar-header {
                display: flex;
            }

            .admin-main {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .user-details-grid {
                grid-template-columns: 1fr;
            }

            .header-user span {
                display: none;
            }

            .login-container {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="login-page">
        <div class="login-container">
            <div class="admin-logo">🛡️</div>
            <h1 class="login-title">Admin Portal</h1>
            <p class="login-subtitle">SusuPay Management System</p>

            <div id="login-alert"></div>

            <form id="admin-login-form">
                <div class="form-group">
                    <label for="admin-role">Admin Role</label>
                    <select id="admin-role" required>
                        <option value="">Select your role...</option>
                        <option value="super">👑 Super Admin</option>
                        <option value="main">Main Admin</option>
                        <option value="senior">Senior Admin</option>
                        <option value="financial">Financial Admin</option>
                        <option value="support">Support Admin</option>
                        <option value="security">Security Admin</option>
                        <option value="operations">Operations Admin</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="admin-email">Email Address</label>
                    <input type="email" id="admin-email" required placeholder="admin@susupay.com">
                </div>

                <div class="form-group">
                    <label for="admin-password">Password</label>
                    <input type="password" id="admin-password" required>
                </div>

                <button type="submit" class="btn" style="width: 100%;">
                    Sign In to Admin Portal
                </button>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div class="dashboard-page" id="dashboard-page">
        <!-- Header -->
        <header class="admin-header" id="admin-header">
            <div class="header-left">
                <button class="hamburger-btn" id="hamburger-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="admin-brand">
                    <span>🛡️</span>
                    <span>SusuPay Admin</span>
                    <span class="admin-role-badge" id="role-badge"></span>
                </div>
            </div>
            <div class="header-user">
                <span>
                    <div id="admin-name" style="font-weight: 600; color: #4a5568;"></div>
                    <div id="admin-email" style="font-size: 0.8rem; color: #718096;"></div>
                </span>
                <div class="user-avatar" id="user-avatar">A</div>
                <button class="logout-btn" id="logout-btn">Logout</button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="admin-sidebar" id="admin-sidebar">
            <div class="sidebar-header">
                <span style="font-weight: 600; color: #4a5568;">Menu</span>
                <button class="close-sidebar-btn" id="close-sidebar-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="sidebar-section" id="super-section" style="display: none;">
                <div class="sidebar-section-title">Super Admin</div>
                <div class="sidebar-nav-item" data-page="super-dashboard">
                    <span class="nav-icon">👑</span>
                    <span>Super Dashboard</span>
                </div>
                <div class="sidebar-nav-item" data-page="admin-activity">
                    <span class="nav-icon">👨‍💼</span>
                    <span>Admin Activity</span>
                </div>
                <div class="sidebar-nav-item" data-page="user-analytics">
                    <span class="nav-icon">📊</span>
                    <span>User Analytics</span>
                </div>
                <div class="sidebar-nav-item" data-page="financial-overview">
                    <span class="nav-icon">💎</span>
                    <span>Financial Overview</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Main</div>
                <div class="sidebar-nav-item active" data-page="dashboard">
                    <span class="nav-icon">📊</span>
                    <span>Dashboard</span>
                </div>
                <div class="sidebar-nav-item" data-page="users">
                    <span class="nav-icon">👥</span>
                    <span>Users</span>
                </div>
            </div>

            <div class="sidebar-section" id="kyc-section">
                <div class="sidebar-section-title">Verification</div>
                <div class="sidebar-nav-item" data-page="kyc">
                    <span class="nav-icon">🛡️</span>
                    <span>KYC</span>
                    <span class="pending-badge" id="kyc-badge">0</span>
                </div>
            </div>

            <div class="sidebar-section" id="financial-section">
                <div class="sidebar-section-title">Financial</div>
                <div class="sidebar-nav-item" data-page="transactions">
                    <span class="nav-icon">💳</span>
                    <span>Transactions</span>
                    <span class="pending-badge" id="trans-badge">0</span>
                </div>
            </div>

            <div class="sidebar-section" id="admin-section">
                <div class="sidebar-section-title">Administration</div>
                <div class="sidebar-nav-item" data-page="admin-users">
                    <span class="nav-icon">👨‍💼</span>
                    <span>Admin Users</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main" id="admin-main">
            <div id="dashboard-alert"></div>

            <!-- Dashboard Page -->
            <div id="dashboard-content" class="page-content">
                <h2 style="margin-bottom: 25px; color: #4a5568;">Dashboard Overview</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Users</div>
                        <div class="stat-value" id="stat-users">0</div>
                        <div class="stat-change positive">+12% this month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Transactions</div>
                        <div class="stat-value" id="stat-trans">0</div>
                        <div class="stat-change positive">+8% this month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending KYC</div>
                        <div class="stat-value" id="stat-kyc">0</div>
                        <div class="stat-change">Requires attention</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="stat-revenue">₵0</div>
                        <div class="stat-change positive">+15% this month</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Activity</h3>
                    </div>
                    <div id="recent-activity">
                        <p style="text-align: center; color: #718096; padding: 40px;">Loading...</p>
                    </div>
                </div>
            </div>

            <!-- Super Dashboard -->
            <div id="super-dashboard-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: #4a5568;">
                    👑 Super Admin Dashboard
                </h2>
                
                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <div class="stat-label" style="color: white;">Total Platform Users</div>
                        <div class="stat-value" style="color: white;" id="super-users">0</div>
                        <div class="stat-change" style="color: white;">Lifetime</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <div class="stat-label" style="color: white;">All-Time Revenue</div>
                        <div class="stat-value" style="color: white;" id="super-revenue">₵0</div>
                        <div class="stat-change" style="color: white;">Total Earnings</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <div class="stat-label" style="color: white;">Active Admins</div
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <div class="stat-label" style="color: white;">Active Admins</div>
                        <div class="stat-value" style="color: white;" id="super-admins">0</div>
                        <div class="stat-change" style="color: white;">Personnel</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <div class="stat-label" style="color: white;">System Health</div>
                        <div class="stat-value" style="color: white;">98%</div>
                        <div class="stat-change" style="color: white;">Operational</div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Real-Time Activity</h3>
                    </div>
                    <div class="activity-timeline" id="super-activity">
                        <p style="text-align: center; color: #718096; padding: 40px;">Loading...</p>
                    </div>
                </div>
            </div>

            <!-- Other pages will be added here -->
            <div id="users-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: #4a5568;">User Management</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">All Users</h3>
                        <input type="text" class="search-input" id="user-search" placeholder="Search users...">
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Balance</th>
                                <th>KYC Status</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                            <tr><td colspan="6" style="text-align: center; padding: 40px;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="kyc-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: #4a5568;">KYC Verification</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Pending Verifications</h3>
                        <select class="filter-select" id="kyc-filter">
                            <option value="under_review">Under Review</option>
                            <option value="all">All</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>ID Type</th>
                                <th>Submitted</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="kyc-tbody">
                            <tr><td colspan="5" style="text-align: center; padding: 40px;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="transactions-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: #4a5568;">Transaction Management</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">All Transactions</h3>
                        <div class="filter-group">
                            <select class="filter-select" id="trans-filter">
                                <option value="pending">Pending</option>
                                <option value="all">All</option>
                                <option value="approved">Approved</option>
                            </select>
                            <select class="filter-select" id="trans-type-filter">
                                <option value="all">All Types</option>
                                <option value="contribution">Contributions</option>
                                <option value="withdrawal">Withdrawals</option>
                            </select>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="trans-tbody">
                            <tr><td colspan="7" style="text-align: center; padding: 40px;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="admin-users-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: #4a5568;">Admin User Management</h2>
                
                <div class="content-card" style="margin-bottom: 20px;">
                    <div class="card-header">
                        <h3 class="card-title">Add New Admin</h3>
                    </div>
                    <form id="add-admin-form">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="new-admin-name" required>
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="new-admin-email" required>
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select id="new-admin-role" required>
                                    <option value="">Select role...</option>
                                    <option value="senior">Senior Admin</option>
                                    <option value="financial">Financial Admin</option>
                                    <option value="support">Support Admin</option>
                                    <option value="security">Security Admin</option>
                                    <option value="operations">Operations Admin</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="new-admin-pass" required minlength="8">
                            </div>
                        </div>
                        <button type="submit" class="btn">Add Admin</button>
                    </form>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Current Admins</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Added</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="admins-tbody">
                            <tr><td colspan="5" style="text-align: center; padding: 40px;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="admin-activity-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: #4a5568;">Admin Activity Log</h2>
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Admin Actions</h3>
                    </div>
                    <div id="admin-activity-list">
                        <p style="text-align: center; color: #718096; padding: 40px;">Loading...</p>
                    </div>
                </div>
            </div>

            <div id="user-analytics-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: #4a5568;">User Analytics</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Active Users (30d)</div>
                        <div class="stat-value" id="active-users">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">New Signups (7d)</div>
                        <div class="stat-value" id="new-signups">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">KYC Verified</div>
                        <div class="stat-value" id="kyc-verified">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Balance</div>
                        <div class="stat-value" id="avg-balance">₵0</div>
                    </div>
                </div>
            </div>

            <div id="financial-overview-content" class="page-content hidden">
                <h2 style="margin-bottom: 25px; color: #4a5568;">Financial Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Contributions</div>
                        <div class="stat-value" id="total-contrib">₵0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Withdrawals</div>
                        <div class="stat-value" id="total-withdraw">₵0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Commission Earned</div>
                        <div class="stat-value" id="total-commission">₵0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending Value</div>
                        <div class="stat-value" id="pending-value">₵0</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- KYC Review Modal -->
    <div class="modal" id="kyc-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('kyc-modal')">&times;</button>
            <h2 class="modal-title">KYC Verification Review</h2>
            
            <div class="user-details-grid">
                <div class="detail-item">
                    <div class="detail-label">User</div>
                    <div class="detail-value" id="kyc-user-name"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Email</div>
                    <div class="detail-value" id="kyc-user-email"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">ID Type</div>
                    <div class="detail-value" id="kyc-id-type"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Submitted</div>
                    <div class="detail-value" id="kyc-submitted"></div>
                </div>
            </div>

            <h3 style="margin: 20px 0;">Documents</h3>
            <div class="document-preview">
                <div>
                    <p style="font-weight: 600; margin-bottom: 10px;">Front ID</p>
                    <img id="kyc-front" src="" alt="Front ID">
                </div>
                <div>
                    <p style="font-weight: 600; margin-bottom: 10px;">Back ID</p>
                    <img id="kyc-back" src="" alt="Back ID">
                </div>
                <div>
                    <p style="font-weight: 600; margin-bottom: 10px;">Selfie</p>
                    <img id="kyc-selfie" src="" alt="Selfie">
                </div>
            </div>

            <div class="form-group">
                <label>Review Notes</label>
                <textarea id="kyc-notes" rows="3"></textarea>
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <button class="action-btn btn-reject" onclick="rejectKYC()">Reject</button>
                <button class="action-btn btn-approve" onclick="approveKYC()">Approve</button>
            </div>
        </div>
    </div>

    <!-- Transaction Review Modal -->
    <div class="modal" id="trans-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('trans-modal')">&times;</button>
            <h2 class="modal-title">Transaction Review</h2>
            
            <div class="user-details-grid">
                <div class="detail-item">
                    <div class="detail-label">User</div>
                    <div class="detail-value" id="trans-user"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value" id="trans-type"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Amount</div>
                    <div class="detail-value" id="trans-amount"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Method</div>
                    <div class="detail-value" id="trans-method"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Transaction ID</div>
                    <div class="detail-value" id="trans-ref"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Date</div>
                    <div class="detail-value" id="trans-date"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Review Notes</label>
                <textarea id="trans-notes" rows="3"></textarea>
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end;">
                <button class="action-btn btn-reject" onclick="rejectTransaction()">Reject</button>
                <button class="action-btn btn-approve" onclick="approveTransaction()">Approve</button>
            </div>
        </div>
    </div>
      <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, getDocs, updateDoc, setDoc, deleteDoc, collection, query, where, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAoomGKHjU2iUJjjMxEDGCsLzRtIkHtqhY",
            authDomain: "susupay-5286e.firebaseapp.com",
            projectId: "susupay-5286e",
            storageBucket: "susupay-5286e.firebasestorage.app",
            messagingSenderId: "83852132974",
            appId: "1:83852132974:web:2d8be2d1adb7e7639f5c7f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentAdmin = null;
        let adminRole = null;
        let currentKycReview = null;
        let currentTransReview = null;

        const rolePermissions = {
            super: ['dashboard', 'users', 'kyc', 'transactions', 'admin-users', 'super-dashboard', 'admin-activity', 'user-analytics', 'financial-overview'],
            main: ['dashboard', 'users', 'kyc', 'transactions', 'admin-users'],
            senior: ['dashboard', 'users', 'kyc', 'transactions', 'admin-users'],
            financial: ['dashboard', 'transactions', 'users'],
            support: ['dashboard', 'users'],
            security: ['dashboard', 'users', 'kyc'],
            operations: ['dashboard', 'users', 'transactions', 'kyc']
        };

        // Utility functions
        function showAlert(msg, type, container = 'dashboard-alert') {
            const div = document.getElementById(container);
            div.innerHTML = `<div class="alert alert-${type}">${msg}</div>`;
            setTimeout(() => div.innerHTML = '', 5000);
        }

        function formatCurrency(amount) {
            return `₵${parseFloat(amount || 0).toFixed(2)}`;
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        // Login
        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const role = document.getElementById('admin-role').value;
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const adminDoc = await getDoc(doc(db, 'admins', userCredential.user.uid));
                
                if (!adminDoc.exists()) {
                    showAlert('Not an admin account', 'error', 'login-alert');
                    await signOut(auth);
                    return;
                }

                const adminData = adminDoc.data();
                if (adminData.role !== role) {
                    showAlert(`Role mismatch. You are ${adminData.role} admin`, 'error', 'login-alert');
                    await signOut(auth);
                    return;
                }

                adminRole = role;
                currentAdmin = userCredential.user;
                loadDashboard();
            } catch (error) {
                showAlert(error.message, 'error', 'login-alert');
            }
        });

        // Auth state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const adminDoc = await getDoc(doc(db, 'admins', user.uid));
                if (adminDoc.exists()) {
                    currentAdmin = user;
                    adminRole = adminDoc.data().role;
                    loadDashboard();
                } else {
                    await signOut(auth);
                    showLoginPage();
                }
            } else {
                showLoginPage();
            }
        });

        function showLoginPage() {
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('dashboard-page').style.display = 'none';
        }

        async function loadDashboard() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'block';

            const adminDoc = await getDoc(doc(db, 'admins', currentAdmin.uid));
            const adminData = adminDoc.data();

            document.getElementById('admin-name').textContent = adminData.name;
            document.getElementById('admin-email').textContent = adminData.email;
            document.getElementById('user-avatar').textContent = adminData.name.charAt(0);
            document.getElementById('role-badge').textContent = adminRole.charAt(0).toUpperCase() + adminRole.slice(1) + ' Admin';
            document.getElementById('role-badge').className = `admin-role-badge role-${adminRole}`;

            configureSidebar();
            
            if (adminRole === 'super') {
                document.getElementById('admin-header').classList.add('super-admin-header');
                document.getElementById('admin-sidebar').classList.add('super-admin-sidebar');
                showPage('super-dashboard');
            } else {
                showPage('dashboard');
            }
        }

        function configureSidebar() {
            const permissions = rolePermissions[adminRole];
            
            // Show/hide sections
            document.getElementById('super-section').style.display = adminRole === 'super' ? 'block' : 'none';
            document.getElementById('kyc-section').style.display = permissions.includes('kyc') ? 'block' : 'none';
            document.getElementById('financial-section').style.display = permissions.includes('transactions') ? 'block' : 'none';
            document.getElementById('admin-section').style.display = permissions.includes('admin-users') ? 'block' : 'none';
        }

        // Navigation
        document.querySelectorAll('.sidebar-nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                if (!rolePermissions[adminRole].includes(page)) {
                    showAlert('No permission', 'error');
                    return;
                }
                showPage(page);
                closeMobileSidebar();
            });
        });

        async function showPage(page) {
            document.querySelectorAll('.sidebar-nav-item').forEach(i => i.classList.remove('active'));
            document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
            document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
            document.getElementById(`${page}-content`).classList.remove('hidden');

            if (page === 'dashboard') await loadDashboardStats();
            else if (page === 'super-dashboard') await loadSuperDashboard();
            else if (page === 'users') await loadUsers();
            else if (page === 'kyc') await loadKYC();
            else if (page === 'transactions') await loadTransactions();
            else if (page === 'admin-users') await loadAdminUsers();
            else if (page === 'admin-activity') await loadAdminActivity();
            else if (page === 'user-analytics') await loadUserAnalytics();
            else if (page === 'financial-overview') await loadFinancialOverview();
        }

        // Load Dashboard Stats
        async function loadDashboardStats() {
            try {
                const users = await getDocs(collection(db, 'users'));
                const trans = await getDocs(collection(db, 'transactions'));
                const kycPending = await getDocs(query(collection(db, 'kyc_submissions'), where('status', '==', 'under_review')));
                
                let revenue = 0;
                trans.forEach(doc => {
                    const data = doc.data();
                    if (data.type === 'withdrawal' && data.commission) revenue += data.commission;
                });

                document.getElementById('stat-users').textContent = users.size;
                document.getElementById('stat-trans').textContent = trans.size;
                document.getElementById('stat-kyc').textContent = kycPending.size;
                document.getElementById('stat-revenue').textContent = formatCurrency(revenue);
                document.getElementById('kyc-badge').textContent = kycPending.size;
                
                const transPending = await getDocs(query(collection(db, 'transactions'), where('status', '==', 'pending')));
                document.getElementById('trans-badge').textContent = transPending.size;
            } catch (error) {
                console.error(error);
            }
        }

        // Load Super Dashboard
        async function loadSuperDashboard() {
            try {
                const users = await getDocs(collection(db, 'users'));
                const admins = await getDocs(collection(db, 'admins'));
                const trans = await getDocs(collection(db, 'transactions'));
                
                let revenue = 0;
                trans.forEach(doc => {
                    const data = doc.data();
                    if (data.type === 'withdrawal' && data.commission) revenue += data.commission;
                });

                document.getElementById('super-users').textContent = users.size;
                document.getElementById('super-admins').textContent = admins.size;
                document.getElementById('super-revenue').textContent = formatCurrency(revenue);

                await loadRealtimeActivity();
            } catch (error) {
                console.error(error);
            }
        }

        async function loadRealtimeActivity() {
            const container = document.getElementById('super-activity');
            container.innerHTML = '';

            try {
                const q = query(collection(db, 'transactions'), orderBy('timestamp', 'desc'), limit(10));
                const snapshot = await getDocs(q);

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', trans.userId));
                    const userData = userDoc.data();

                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                        <div class="activity-time">${formatDate(trans.timestamp)}</div>
                        <div class="activity-description">
                            <span class="activity-user">${userData.firstName} ${userData.surname}</span>
                            ${trans.type === 'contribution' ? 'contributed' : 'withdrew'} ${formatCurrency(trans.amount)}
                        </div>
                    `;
                    container.appendChild(item);
                }
            } catch (error) {
                container.innerHTML = '<p style="text-align: center; color: #e53e3e;">Error loading</p>';
            }
        }

        // Load Users
        async function loadUsers() {
            const tbody = document.getElementById('users-tbody');
            tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Loading...</td></tr>';

            try {
                const snapshot = await getDocs(collection(db, 'users'));
                tbody.innerHTML = '';

                snapshot.forEach(docSnap => {
                    const user = docSnap.data();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${user.firstName} ${user.surname}</td>
                        <td>${user.email}</td>
                        <td>${formatCurrency(user.balance)}</td>
                        <td><span class="status-badge status-${user.kycStatus || 'pending'}">${(user.kycStatus || 'pending').toUpperCase()}</span></td>
                        <td>${formatDate(user.createdAt)}</td>
                        <td><button class="action-btn btn-view">View</button></td>
                    `;
                });
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: #e53e3e;">Error: ${error.message}</td></tr>`;
            }
        }

        // Load KYC
        async function loadKYC() {
            const tbody = document.getElementById('kyc-tbody');
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Loading...</td></tr>';

            try {
                const filter = document.getElementById('kyc-filter').value;
                let q;
                if (filter === 'all') {
                    q = query(collection(db, 'kyc_submissions'), orderBy('submittedAt', 'desc'));
                } else {
                    q = query(collection(db, 'kyc_submissions'), where('status', '==', filter), orderBy('submittedAt', 'desc'));
                }

                const snapshot = await getDocs(q);
                tbody.innerHTML = '';

                for (const docSnap of snapshot.docs) {
                    const kyc = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', kyc.userId));
                    const userData = userDoc.data();

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${userData.firstName} ${userData.surname}</td>
                        <td>${kyc.idType.toUpperCase()}</td>
                        <td>${formatDate(kyc.submittedAt)}</td>
                        <td><span class="status-badge status-${kyc.status}">${kyc.status.replace('_', ' ').toUpperCase()}</span></td>
                        <td><button class="action-btn btn-view" onclick="window.reviewKYC('${docSnap.id}')">Review</button></td>
                    `;
                }
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: #e53e3e;">Error: ${error.message}</td></tr>`;
            }
        }

        // Review KYC
        window.reviewKYC = async function(id) {
            try {
                const kycDoc = await getDoc(doc(db, 'kyc_submissions', id));
                const kycData = kycDoc.data();
                const userDoc = await getDoc(doc(db, 'users', kycData.userId));
                const userData = userDoc.data();

                currentKycReview = { id, data: kycData };

                document.getElementById('kyc-user-name').textContent = `${userData.firstName} ${userData.surname}`;
                document.getElementById('kyc-user-email').textContent = userData.email;
                document.getElementById('kyc-id-type').textContent = kycData.idType.toUpperCase();
                document.getElementById('kyc-submitted').textContent = formatDate(kycData.submittedAt);
                document.getElementById('kyc-front').src = kycData.frontIdUrl;
                document.getElementById('kyc-back').src = kycData.backIdUrl;
                document.getElementById('kyc-selfie').src = kycData.selfieUrl;

                document.getElementById('kyc-modal').style.display = 'block';
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        window.approveKYC = async function() {
            if (!currentKycReview) return;

            try {
                await updateDoc(doc(db, 'kyc_submissions', currentKycReview.id), {
                    status: 'approved',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    reviewNotes: document.getElementById('kyc-notes').value
                });

                await updateDoc(doc(db, 'users', currentKycReview.data.userId), {
                    kycStatus: 'approved'
                });

                showAlert('KYC approved successfully!', 'success');
                closeModal('kyc-modal');
                loadKYC();
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        window.rejectKYC = async function() {
            if (!currentKycReview) return;
            const notes = document.getElementById('kyc-notes').value;
            if (!notes) {
                showAlert('Please provide rejection reason', 'error');
                return;
            }

            try {
                await updateDoc(doc(db, 'kyc_submissions', currentKycReview.id), {
                    status: 'rejected',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    reviewNotes: notes
                });

                await updateDoc(doc(db, 'users', currentKycReview.data.userId), {
                    kycStatus: 'rejected'
                });

                showAlert('KYC rejected', 'info');
                closeModal('kyc-modal');
                loadKYC();
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        // Load Transactions
        async function loadTransactions() {
            const tbody = document.getElementById('trans-tbody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Loading...</td></tr>';

            try {
                const status = document.getElementById('trans-filter').value;
                const type = document.getElementById('trans-type-filter').value;

                let q;
                if (status === 'all' && type === 'all') {
                    q = query(collection(db, 'transactions'), orderBy('timestamp', 'desc'), limit(50));
                } else if (status !== 'all' && type === 'all') {
                    q = query(collection(db, 'transactions'), where('status', '==', status), orderBy('timestamp', 'desc'), limit(50));
                } else if (status === 'all' && type !== 'all') {
                    q = query(collection(db, 'transactions'), where('type', '==', type), orderBy('timestamp', 'desc'), limit(50));
                } else {
                    q = query(collection(db, 'transactions'), where('status', '==', status), where('type', '==', type), orderBy('timestamp', 'desc'), limit(50));
                }

                const snapshot = await getDocs(q);
                tbody.innerHTML = '';

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const userDoc = await getDoc(doc(db, 'users', trans.userId));
                    const userData = userDoc.data();

                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${userData.firstName} ${userData.surname}</td>
                        <td>${trans.type.toUpperCase()}</td>
                        <td>${formatCurrency(trans.amount)}</td>
                        <td>${trans.paymentMethod || 'N/A'}</td>
                        <td><span class="status-badge status-${trans.status}">${trans.status.toUpperCase()}</span></td>
                        <td>${formatDate(trans.timestamp)}</td>
                        <td><button class="action-btn btn-view" onclick="window.reviewTransaction('${docSnap.id}')">Review</button></td>
                    `;
                }
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; color: #e53e3e;">Error: ${error.message}</td></tr>`;
            }
        }

        // Review Transaction
        window.reviewTransaction = async function(id) {
            try {
                const transDoc = await getDoc(doc(db, 'transactions', id));
                const transData = transDoc.data();
                const userDoc = await getDoc(doc(db, 'users', transData.userId));
                const userData = userDoc.data();

                currentTransReview = { id, data: transData };

                document.getElementById('trans-user').textContent = `${userData.firstName} ${userData.surname}`;
                document.getElementById('trans-type').textContent = transData.type.toUpperCase();
                document.getElementById('trans-amount').textContent = formatCurrency(transData.amount);
                document.getElementById('trans-method').textContent = transData.paymentMethod || 'N/A';
                document.getElementById('trans-ref').textContent = transData.transactionId || 'N/A';
                document.getElementById('trans-date').textContent = formatDate(transData.timestamp);

                document.getElementById('trans-modal').style.display = 'block';
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        window.approveTransaction = async function() {
            if (!currentTransReview) return;

            try {
                await updateDoc(doc(db, 'transactions', currentTransReview.id), {
                    status: 'approved',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp()
                });

                if (currentTransReview.data.type === 'contribution') {
                    const userRef = doc(db, 'users', currentTransReview.data.userId);
                    const userDoc = await getDoc(userRef);
                    const userData = userDoc.data();

                    const monthKey = currentTransReview.data.month;
                    const contributedDays = userData.contributedDays || {};
                    const monthDays = contributedDays[monthKey] || [];

                    const updatedDays = monthDays.map(day => {
                        if (currentTransReview.data.days.includes(day.day)) {
                            return { ...day, status: 'approved' };
                        }
                        return day;
                    });

                    await updateDoc(userRef, {
                        [`contributedDays.${monthKey}`]: updatedDays,
                        balance: (userData.balance || 0) + currentTransReview.data.amount
                    });
                }

                showAlert('Transaction approved!', 'success');
                closeModal('trans-modal');
                loadTransactions();
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        window.rejectTransaction = async function() {
            if (!currentTransReview) return;
            const notes = document.getElementById('trans-notes').value;
            if (!notes) {
                showAlert('Please provide rejection reason', 'error');
                return;
            }

            try {
                await updateDoc(doc(db, 'transactions', currentTransReview.id), {
                    status: 'rejected',
                    reviewedBy: currentAdmin.uid,
                    reviewedAt: serverTimestamp(),
                    rejectionReason: notes
                });

                showAlert('Transaction rejected', 'info');
                closeModal('trans-modal');
                loadTransactions();
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        // Load Admin Users
        async function loadAdminUsers() {
            const tbody = document.getElementById('admins-tbody');
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Loading...</td></tr>';

            try {
                const snapshot = await getDocs(collection(db, 'admins'));
                tbody.innerHTML = '';

                snapshot.forEach(docSnap => {
                    const admin = docSnap.data();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${admin.name}</td>
                        <td>${admin.email}</td>
                        <td><span class="admin-role-badge role-${admin.role}">${admin.role.toUpperCase()}</span></td>
                        <td>${formatDate(admin.createdAt)}</td>
                        <td>
                            ${(admin.role !== 'super' && admin.role !== 'main') || adminRole === 'super' ?
                                `<button class="action-btn btn-danger" onclick="window.removeAdmin('${docSnap.id}', '${admin.email}')">Remove</button>` :
                                '<span style="color: #718096;">Protected</span>'}
                        </td>
                    `;
                });
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align: center; color: #e53e3e;">Error: ${error.message}</td></tr>`;
            }
        }

        // Add Admin
        document.getElementById('add-admin-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('new-admin-name').value;
            const email = document.getElementById('new-admin-email').value;
            const role = document.getElementById('new-admin-role').value;
            const password = document.getElementById('new-admin-pass').value;

            try {
                const userCred = await createUserWithEmailAndPassword(auth, email, password);
                await setDoc(doc(db, 'admins', userCred.user.uid), {
                    name, email, role,
                    createdAt: serverTimestamp(),
                    createdBy: currentAdmin.uid
                });

                showAlert('Admin added successfully!', 'success');
                document.getElementById('add-admin-form').reset();
                await signOut(auth);
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        });

        window.removeAdmin = async function(id, email) {
            if (!confirm(`Remove admin: ${email}?`)) return;

            try {
                await deleteDoc(doc(db, 'admins', id));
                showAlert('Admin removed', 'info');
                loadAdminUsers();
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        // Load other analytics pages
        async function loadAdminActivity() {
            const container = document.getElementById('admin-activity-list');
            container.innerHTML = '<p style="text-align: center; padding: 40px;">Loading...</p>';

            try {
                const q = query(collection(db, 'transactions'), where('reviewedBy', '!=', null), orderBy('reviewedBy'), orderBy('reviewedAt', 'desc'), limit(50));
                const snapshot = await getDocs(q);
                container.innerHTML = '';

                for (const docSnap of snapshot.docs) {
                    const trans = docSnap.data();
                    const adminDoc = await getDoc(doc(db, 'admins', trans.reviewedBy));
                    const adminData = adminDoc.exists() ? adminDoc.data() : { name: 'Unknown' };

                    const card = document.createElement('div');
                    card.style.cssText = 'padding: 15px; background: #f7fafc; border-radius: 8px; margin-bottom: 10px;';
                    card.innerHTML = `
                        <div style="font-weight: 600; color: #4a5568;">${adminData.name}</div>
                        <div style="font-size: 0.9rem; color: #718096; margin-top: 5px;">
                            ${trans.status === 'approved' ? 'Approved' : 'Rejected'} ${trans.type} of ${formatCurrency(trans.amount)}
                        </div>
                        <div style="font-size: 0.8rem; color: #a0aec0; margin-top: 5px;">${formatDate(trans.reviewedAt)}</div>
                    `;
                    container.appendChild(card);
                }
            } catch (error) {
                container.innerHTML = `<p style="text-align: center; color: #e53e3e;">Error: ${error.message}</p>`;
            }
        }

        async function loadUserAnalytics() {
            try {
                const users = await getDocs(collection(db, 'users'));
                let kycVerified = 0;
                let totalBalance = 0;

                users.forEach(doc => {
                    const user = doc.data();
                    if (user.kycStatus === 'approved') kycVerified++;
                    totalBalance += user.balance || 0;
                });

                document.getElementById('active-users').textContent = users.size;
                document.getElementById('new-signups').textContent = Math.floor(users.size * 0.1);
                document.getElementById('kyc-verified').textContent = kycVerified;
                document.getElementById('avg-balance').textContent = formatCurrency(users.size > 0 ? totalBalance / users.size : 0);
            } catch (error) {
                console.error(error);
            }
        }

        async function loadFinancialOverview() {
            try {
                const trans = await getDocs(collection(db, 'transactions'));
                let totalContrib = 0, totalWithdraw = 0, totalCommission = 0, pendingValue = 0;

                trans.forEach(doc => {
                    const t = doc.data();
                    if (t.type === 'contribution') {
                        if (t.status === 'approved') totalContrib += t.amount;
                        else if (t.status === 'pending') pendingValue += t.amount;
                    } else if (t.type === 'withdrawal') {
                        if (t.status === 'approved') {
                            totalWithdraw += t.amount;
                            totalCommission += t.commission || 0;
                        } else if (t.status === 'pending') pendingValue += t.amount;
                    }
                });

                document.getElementById('total-contrib').textContent = formatCurrency(totalContrib);
                document.getElementById('total-withdraw').textContent = formatCurrency(totalWithdraw);
                document.getElementById('total-commission').textContent = formatCurrency(totalCommission);
                document.getElementById('pending-value').textContent = formatCurrency(pendingValue);
            } catch (error) {
                console.error(error);
            }
        }

        // Filter handlers
        document.getElementById('kyc-filter').addEventListener('change', loadKYC);
        document.getElementById('trans-filter').addEventListener('change', loadTransactions);
        document.getElementById('trans-type-filter').addEventListener('change', loadTransactions);

        // Mobile menu
        document.getElementById('hamburger-btn').addEventListener('click', () => {
            document.getElementById('admin-sidebar').classList.add('mobile-open');
        });

        document.getElementById('close-sidebar-btn').addEventListener('click', closeMobileSidebar);

        function closeMobileSidebar() {
            document.getElementById('admin-sidebar').classList.remove('mobile-open');
        }

        // Modal functions
        window.closeModal = function(id) {
            document.getElementById(id).style.display = 'none';
        };

        window.onclick = function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        };

        // Logout
        document.getElementById('logout-btn').addEventListener('click', async () => {
            await signOut(auth);
            showAlert('Logged out successfully', 'success', 'login-alert');
        });
    </script>
</body>
